/*

 @author Angiemakes www.angiemakes.com
 @license GPLv2
 @package Image Editor
 @version 1.0.12
*/
var config={apiExportURL:"save.php",assetsURL:"assets/",assetsThumbURL:"assets/{0}",presets:[{src:"background/bg.png",type:"background"}],width:500,height:600,container:"editor"},imageEditor={COLORS:"#000000 #434242 #888787 #cbcbca #7f6b5b #c3bea8 #ef5a36 #fb9646 #fabe4a #e1b54a #fdae87 #fd9887 #fcada0 #eb6566 #d64471 #fc4d93 #d2eada #59c5a4 #b5e1de #91dfd7 #528be9 #114577 #403ba2 #4d1177 #c57ade #f0cfee".split(" "),TEMPLATE:[{name:"Test",presets:[{src:"background/bg.png",zindex:0,type:"background",
properties:[]},{title:"An actor must interpret life, and in order to do so must be willing to accept all the experiences life has to offer.",x:45,y:59,width:390,height:486,scale:1,deg:0.6,zindex:2,type:"text",properties:[{type:"ShadowColor",value:"#000000"},{type:"ShadowOffset",value:{x:0,y:0}},{type:"ShadowBlur"},{type:"ShadowOpacity"},{type:"TextFill",value:"#ffffff"},{type:"FontSize",value:38},{type:"FontFamily",value:"Sacramento"},{type:"LineHeight",value:1.6},{type:"TextAlign",value:"left"},
{type:"StrokeColor"},{type:"StrokeWidth",value:3}]},{src:"clipart/poppy.png",x:100,y:100,width:600,height:600,scale:0.5,deg:-0.0090,zindex:1,type:"clipart",properties:[]}]},{name:"Test 2",presets:[{src:"background/paper.jpg",zindex:0,type:"background",properties:[]},{title:"Hey! Hope you're liking our About me Image Editor!",x:35,y:100,width:390,height:486,scale:1,deg:3.6,zindex:2,type:"text",properties:[{type:"TextFill",value:"#5f9ea0"},{type:"FontSize",value:37},{type:"FontFamily",value:"Shadows Into Light"},
{type:"LineHeight",value:1.4},{type:"TextAlign",value:"left"},{type:"StrokeColor"},{type:"StrokeWidth"}]},{src:"clipart/photoedge.png",x:5,y:5,width:600,height:600,scale:0.9,deg:-0.0090,zindex:1,type:"clipart",properties:[]}]},{name:"Test 3",presets:[{src:"background/bg.png",zindex:0,type:"background",properties:[]},{src:"clipart/poppy.png",x:100,y:100,width:600,height:600,scale:0.5,deg:-0.0090,zindex:1,type:"clipart",properties:[{type:"Opacity",value:1}]},{title:"An actor must interpret life, and in order to do so must be willing to accept all the experiences life has to offer.",
x:57,y:227,width:390,height:243.20000000000002,scale:1,deg:0.6,zindex:2,type:"text",properties:[{type:"ShadowColor",value:"#000000"},{type:"ShadowOffset",value:{x:0,y:0}},{type:"ShadowBlur"},{type:"ShadowOpacity"},{type:"Opacity",value:1},{type:"TextFill",value:"#ffffff"},{type:"FontSize",value:38},{type:"FontFamily",value:"Sacramento"},{type:"LineHeight",value:1.6},{type:"TextAlign",value:"left"},{type:"StrokeColor",value:"#000000"},{type:"StrokeWidth",value:3}]}]},{},{},{},{},{},{},{},{},{},{},
{},{}],CLIPART_CATEGORIES:"all;banners;ribbons;words;washi tapes;frames".split(";"),SHAPES:[{id:1,type:"clipart",tags:"banners",width:600,height:600,scale:0.5,src:"clipart/banner.png"},{id:2,type:"clipart",tags:"ribbons",width:600,height:600,scale:0.5,src:"clipart/blueribbon.png"},{id:3,type:"clipart",tags:"banners",width:600,height:600,scale:0.5,src:"clipart/graylace2.png"},{id:4,type:"clipart",tags:"ribbons",width:600,height:600,scale:0.5,src:"clipart/graywashitape.png"},{id:5,type:"clipart",tags:"banners",
width:600,height:600,scale:0.5,src:"clipart/lace.png"},{id:6,type:"clipart",tags:"banners",width:600,height:600,scale:0.5,src:"clipart/photoedge.png"},{id:7,type:"clipart",tags:"banners",width:600,height:600,scale:0.5,src:"clipart/poppy.png"},{id:8,type:"clipart",tags:"ribbons",width:600,height:600,scale:0.5,src:"clipart/purplewatercolor.png"},{id:9,type:"clipart",tags:"ribbons",width:600,height:600,scale:0.5,src:"clipart/ribbonwatercolor.png"},{id:10,type:"clipart",tags:"banners",width:600,height:600,
scale:0.5,src:"clipart/washitape.png"},{id:11,type:"clipart",tags:"banners",width:600,height:600,scale:0.5,src:"clipart/watercolorfeathers.png"},{id:12,type:"clipart",tags:"banners",width:600,height:600,scale:0.5,src:"clipart/watercolorlace.png"},{id:13,type:"clipart",tags:"ribbons",width:600,height:600,scale:0.5,src:"clipart/whiteribbon.png"},{id:14,type:"clipart",tags:"ribbons",width:600,height:275,scale:0.5,src:"clipart/grayribbon.png"},{id:15,type:"clipart",tags:"ribbons",width:600,height:209,
scale:0.5,src:"clipart/line.png"},{id:16,type:"clipart",tags:"ribbons",width:600,height:209,scale:0.5,src:"clipart/ornament.png"},{id:17,type:"clipart",tags:"ribbons",width:600,height:209,scale:0.5,src:"clipart/swirl.png"},{id:18,type:"clipart",tags:"ribbons",width:600,height:246,scale:0.5,src:"clipart/textured.png"},{id:19,type:"clipart",tags:"ribbons",width:600,height:209,scale:0.5,src:"clipart/textured2.png"},{id:20,type:"clipart",tags:"ribbons",width:600,height:209,scale:0.5,src:"clipart/white.png"},
{id:21,type:"clipart",tags:"ribbons",width:600,height:209,scale:0.5,src:"clipart/Untitled1-3.png"},{id:22,type:"clipart",tags:"ribbons",width:600,height:177,scale:0.5,src:"clipart/Untitled-3.png"},{id:23,type:"clipart",tags:"words",width:600,height:184,scale:0.5,src:"clipart/aboutme.png"},{id:24,type:"clipart",tags:"words",width:600,height:184,scale:0.5,src:"clipart/blackhello.png"},{id:25,type:"clipart",tags:"words",width:600,height:184,scale:0.5,src:"clipart/grayaboutme.png"},{id:26,type:"clipart",
tags:"words",width:600,height:184,scale:0.5,src:"clipart/graywelcome.png"},{id:27,type:"clipart",tags:"words",width:600,height:184,scale:0.5,src:"clipart/hellograycallig.png"},{id:28,type:"clipart",tags:"words",width:600,height:184,scale:0.5,src:"clipart/welcomeblack.png"},{id:29,type:"clipart",tags:"words",width:600,height:205,scale:0.5,src:"clipart/whitewelcome.png"},{id:30,type:"clipart",tags:"washi tapes",width:600,height:156,scale:0.5,src:"clipart/graybottompaint.png"},{id:31,type:"clipart",
tags:"washi tapes",width:446,height:103,scale:0.5,src:"clipart/brown.png"},{id:32,type:"clipart",tags:"washi tapes",width:445,height:104,scale:0.5,src:"clipart/coralbluescrapbookpaper.png"},{id:33,type:"clipart",tags:"washi tapes",width:448,height:105,scale:0.5,src:"clipart/dots.png"},{id:34,type:"clipart",tags:"washi tapes",width:446,height:103,scale:0.5,src:"clipart/graystripes.png"},{id:35,type:"clipart",tags:"washi tapes",width:600,height:138,scale:0.5,src:"clipart/paint.png"},{id:36,type:"clipart",
tags:"washi tapes",width:446,height:103,scale:0.5,src:"clipart/plainwhite.png"},{id:37,type:"clipart",tags:"washi tapes",width:600,height:162,scale:0.5,src:"clipart/Untitled-1.png"},{id:38,type:"clipart",tags:"washi tapes",width:600,height:162,scale:0.5,src:"clipart/Untitled-2.png"},{id:39,type:"clipart",tags:"washi tapes",width:600,height:162,scale:0.5,src:"clipart/Untitled-3-.png"},{id:40,type:"clipart",tags:"washi tapes",width:600,height:162,scale:0.5,src:"clipart/Untitled-4.png"},{id:41,type:"clipart",
tags:"washi tapes",width:600,height:133,scale:0.5,src:"clipart/Untitled-5.png"},{id:42,type:"clipart",tags:"washi tapes",width:600,height:133,scale:0.5,src:"clipart/Untitled-6.png"},{id:43,type:"clipart",tags:"washi tapes",width:600,height:133,scale:0.5,src:"clipart/Untitled-7.png"},{id:44,type:"clipart",tags:"washi tapes",width:600,height:162,scale:0.5,src:"clipart/Untitled-8.png"},{id:45,type:"clipart",tags:"washi tapes",width:600,height:162,scale:0.5,src:"clipart/Untitled-9.png"},{id:46,type:"clipart",
tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-10.png"},{id:47,type:"clipart",tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-11.png"},{id:48,type:"clipart",tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-12.png"},{id:49,type:"clipart",tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-13.png"},{id:50,type:"clipart",tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-14.png"},{id:51,type:"clipart",
tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-15.png"},{id:52,type:"clipart",tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-16.png"},{id:53,type:"clipart",tags:"washi tapes",width:600,height:150,scale:0.5,src:"clipart/Untitled-17.png"},{id:54,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-basicsquare.png"},{id:55,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-black.png"},{id:56,type:"clipart",
tags:"frames",width:600,height:600,scale:1,src:"frame/frame-blackcircle.png"},{id:57,type:"clipart",tags:"frames",width:600,height:517,scale:1,src:"frame/frame-blacklineframe.png"},{id:58,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-blacksquare.png"},{id:59,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-circle.png"},{id:60,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-circleblack.png"},{id:61,type:"clipart",tags:"frames",
width:600,height:600,scale:1,src:"frame/frame-cutcornerframe.png"},{id:62,type:"clipart",tags:"frames",width:600,height:295,scale:1,src:"frame/frame-frame1.png"},{id:63,type:"clipart",tags:"frames",width:600,height:498,scale:1,src:"frame/frame-geoframe.png"},{id:64,type:"clipart",tags:"frames",width:600,height:498,scale:1,src:"frame/frame-geoframewhite.png"},{id:65,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-grayframe.png"},{id:66,type:"clipart",tags:"frames",width:600,
height:600,scale:1,src:"frame/frame-grayoval.png"},{id:67,type:"clipart",tags:"frames",width:600,height:517,scale:1,src:"frame/frame-lightwhitegrunge.png"},{id:68,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-oval.png"},{id:69,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-ovalwithgray.png"},{id:70,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-polaroidframe.png"},{id:71,type:"clipart",tags:"frames",width:600,height:517,
scale:1,src:"frame/frame-redlinegrunge.png"},{id:72,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-roundedrect.png"},{id:73,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-roundedrectlightgray.png"},{id:74,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-roundedrectwithgray.png"},{id:75,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-subtlegrungeframe.png"},{id:76,type:"clipart",tags:"frames",
width:600,height:600,scale:1,src:"frame/frame-subtlewhiteframe.png"},{id:77,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-tanframe.png"},{id:78,type:"clipart",tags:"frames",width:600,height:600,scale:1,src:"frame/frame-grayladygray.png"}],FONTS:[{type:"FontFamily",title:"Handwriting",data:[{id:19,title:"Abril Fatface"},{id:2,title:"Alef"},{id:127,title:"Alex Brush"},{id:98,title:"Allura"},{id:90,title:"Amatic SC"},{id:14,title:"Annie Use Your Telescope"},{id:101,title:"Anonymous Pro"},
{id:56,title:"Antic Didone"},{id:6,title:"Architects Daughter"},{id:138,title:"Arvo"},{id:115,title:"Bad Script"},{id:49,title:"Belgrano"},{id:28,title:"BenchNine"},{id:62,title:"Bentham"},{id:36,title:"Berkshire Swash"},{id:70,title:"Boogaloo"},{id:148,title:"Bubbler One"},{id:58,title:"Buda"},{id:72,title:"Butterfly Kids"},{id:99,title:"Cabin Condensed"},{id:84,title:"Cabin Sketch"},{id:20,title:"Cagliostro"},{id:10,title:"Carrois Gothic"},{id:41,title:"Cedarville Cursive"},{id:134,title:"Clicker Script"},
{id:107,title:"Comfortaa"},{id:114,title:"Coming Soon"},{id:66,title:"Courgette"},{id:31,title:"Cousine"},{id:81,title:"Covered By Your Grace"},{id:103,title:"Crushed"},{id:85,title:"Cutive"},{id:60,title:"Cutive Mono"},{id:94,title:"Dancing Script"},{id:119,title:"Damion"},{id:105,title:"Dawning of a New Day"},{id:88,title:"Delius"},{id:38,title:"Devonshire"},{id:3,title:"Dr Sugiyama"},{id:24,title:"Elsie"},{id:9,title:"Engagement"},{id:77,title:"Euphoria Script"},{id:4,title:"Fauna One"},{id:44,
title:"Finger Paint"},{id:120,title:"Flamenco"},{id:43,title:"Gabriela"},{id:18,title:"Gilda Display"},{id:102,title:"Give You Glory"},{id:21,title:"Gloria Hallelujah"},{id:150,title:"Grand Hotel"},{id:25,title:"Great Vibes"},{id:59,title:"Gruppo"},{id:135,title:"Handlee"},{id:7,title:"Happy Monkey"},{id:17,title:"Herr Von Muellerhoff"},{id:82,title:"IM Fell DW Pica SC"},{id:104,title:"IM Fell English SC"},{id:35,title:"Indie Flower"},{id:139,title:"Josefin Sans"},{id:47,title:"Josefin Slab"},{id:116,
title:"Julius Sans One"},{id:75,title:"Jura"},{id:124,title:"Just Another Hand"},{id:144,title:"Just Me Again Down Here"},{id:15,title:"Kite One"},{id:111,title:"Kranky"},{id:113,title:"Kristi"},{id:108,title:"La Belle Aurore"},{id:140,title:"League Script"},{id:133,title:"Leckerli One"},{id:145,title:"Lekton"},{id:1,title:"Lily Script One"},{id:74,title:"Lobster"},{id:57,title:"Lobster Two"},{id:97,title:"Londrina Outline"},{id:46,title:"Londrina Sketch"},{id:5,title:"Loved by the King"},{id:123,
title:"Marck Script"},{id:65,title:"Meddon"},{id:95,title:"Megrim"},{id:50,title:"Merriweather"},{id:30,title:"Miniver"},{id:79,title:"Miltonian"},{id:93,title:"Miltonian Tattoo"},{id:130,title:"Monoton"},{id:122,title:"Montez"},{id:146,title:"Mr De Haviland"},{id:147,title:"Mr Bedfort"},{id:126,title:"Mrs Saint Delafield"},{id:42,title:"Muli"},{id:45,title:"Neucha"},{id:48,title:"Niconne"},{id:128,title:"Nixie One"},{id:100,title:"Nobile"},{id:23,title:"Noto Sans"},{id:125,title:"Nothing You Could Do"},
{id:137,title:"Old Standard TT"},{id:8,title:"Oregano"},{id:13,title:"Over the Rainbow"},{id:78,title:"Oleo Script"},{id:69,title:"Orienta"},{id:61,title:"Open Sans"},{id:53,title:"Open Sans Condensed"},{id:64,title:"Oswald"},{id:33,title:"Prata"},{id:32,title:"PT Sans"},{id:51,title:"Playball"},{id:80,title:"Playfair Display"},{id:76,title:"Patrick Hand"},{id:68,title:"Petit Formal Script"},{id:55,title:"PT Sans Narrow"},{id:83,title:"Pacifico"},{id:129,title:"Parisienne"},{id:118,title:"Poiret One"},
{id:149,title:"Pompiere"},{id:92,title:"PT Serif"},{id:86,title:"PT Serif Caption"},{id:143,title:"Princess Sofia"},{id:37,title:"Questrial"},{id:91,title:"Quicksand"},{id:16,title:"Ribeye"},{id:27,title:"Ribeye Marrow"},{id:52,title:"Roboto Slab"},{id:54,title:"Raleway"},{id:87,title:"Reenie Beanie"},{id:136,title:"Rochester"},{id:109,title:"Rouge Script"},{id:106,title:"Ruluko"},{id:12,title:"Stint Ultra Expanded"},{id:67,title:"Sarina"},{id:117,title:"Sacramento"},{id:112,title:"Sail"},{id:132,
title:"Satisfy"},{id:63,title:"Seaweed Script"},{id:142,title:"Shadows Into Light"},{id:34,title:"Shadows Into Light Two"},{id:141,title:"Snippet"},{id:131,title:"Sofia"},{id:73,title:"Sorts Mill Goudy"},{id:10,title:"Source Sans Pro"},{id:11,title:"Stalemate"},{id:40,title:"Sue Ellen Francisco"},{id:110,title:"Swanky and Moo Moo"},{id:26,title:"The Girl Next Door"},{id:29,title:"Vast Shadow"},{id:22,title:"Vibur"},{id:39,title:"Yeseva One"},{id:89,title:"Yesteryear"},{id:71,title:"Waiting for the Sunrise"},
{id:96,title:"Walter Turncoat"},{id:121,title:"Zeyada"}]}],EFFECTS:[{id:1,title:"None",value:{name:"none"}},{id:7,title:"Black & White",value:{name:"blackwhite"}},{id:4,title:"Clarity",value:{name:"clarity"}},{id:19,title:"Concentrate",value:{name:"concentrate"}},{id:7,title:"Cross Process",value:{name:"crossProcess"}},{id:14,title:"Glowing Sun",value:{name:"glowingSun"}},{id:10,title:"Grungy",value:{name:"grungy"}},{id:15,title:"Hazy Days",value:{name:"hazyDays"}},{id:18,title:"Hemingway",value:{name:"hemingway"}},
{id:16,title:"Her Majesty",value:{name:"herMajesty"}},{id:11,title:"Jarques",value:{name:"jarques"}},{id:3,title:"Lomo",value:{name:"lomo"}},{id:9,title:"Love",value:{name:"love"}},{id:17,title:"Nostalgia",value:{name:"nostalgia"}},{id:13,title:"Old Boot",value:{name:"oldBoot"}},{id:8,title:"Orange Peel",value:{name:"orangePeel"}},{id:12,title:"Pinhole",value:{name:"pinhole"}},{id:5,title:"Sepia",value:{name:"sepia"}},{id:5,title:"Sin City",value:{name:"sinCity"}},{id:6,title:"Sunrise",value:{name:"sunrise"}},
{id:2,title:"Vintage",value:{name:"vintage"}}],TOOLS:[{method:"back",type:"clipart text circle line rectangle triangle image",id:"back",tip:"Back",icon:"return"},{method:"delete",type:"clipart text circle line rectangle triangle image",id:"Delete",tip:"Delete Object",icon:"trash"},{method:"editText",type:"background",id:"text",tip:"Add Text",icon:"text"},{method:"showWindow",type:"background",id:"clipart",tip:"Add Clipart",icon:"clipart"},{method:"showProperty",type:"background",id:"shape",tip:"Add Shapes",
icon:"shapes"},{method:"changeBackground",type:"background",id:"upload",tip:"Change background",icon:"background"},{method:"showProperty",type:"background clipart image",id:"Brightness",tip:"Change Brightness",icon:"brightness"},{method:"showProperty",type:"background clipart image",id:"Contrast",tip:"Change Contrast",icon:"contrast"},{method:"showProperty",type:"background image",id:"Filter",tip:"Apply Image Effects",icon:"filter"},{method:"moveToTop",type:"clipart text circle line rectangle triangle image",
id:"ToTop",tip:"Move to Front",icon:"front"},{method:"moveToBottom",type:"clipart text circle line rectangle triangle image",id:"ToBottom",tip:"Move to Back",icon:"back"},{method:"flipHorizontal",type:"clipart image",id:"FlipH",tip:"Flip Horizontal",icon:"fliph"},{method:"flipVertical",type:"clipart image",id:"FlipV",tip:"Flip Vertical",icon:"flipv"},{method:"showProperty",type:"clipart text circle line rectangle triangle image",id:"Opacity",tip:"Change Opacity",icon:"opacity"},{method:"showProperty",
type:"clipart text circle line rectangle triangle image",id:"shadow",tip:"Add Shadow",icon:"shadow"},{method:"showProperty",type:"clipart circle line rectangle triangle",id:"FillColor",tip:"Color Fill",icon:"color"},{method:"editText",type:"text",id:"editText",tip:"Edit Text",icon:"text"},{method:"showProperty",type:"text",id:"fontFamilyGroup",tip:"Font Family",icon:"font"},{method:"showProperty",type:"text",id:"style",tip:"Font Style",icon:"text-style"},{method:"showProperty",type:"text circle line rectangle triangle",
id:"stroke",tip:"Stroke",icon:"text-stroke"}]};
imageEditor.SETTINGS=[{type:"shadow",grouped:!0,items:[{type:"ShadowColor",title:"Color",data:{type:"color",range:"basic",transparent:!0}},{type:"ShadowBlur",title:"Blur",data:{type:"range",min:0,max:40,step:1,start:4}},{type:"ShadowOffset",title:"Offset",data:{type:"double-range",min:-50,max:50,step:1,start:4}},{type:"ShadowOpacity",title:"Opacity",data:{type:"range",min:0,max:1,step:0.1,start:0.5}}]},{type:"Filter",data:imageEditor.EFFECTS},{type:"shape",data:[{id:1,title:"Line",value:{name:"line"}},
{id:2,title:"Circle",value:{name:"circle"}},{id:3,title:"Rectangle",value:{name:"rectangle"}},{id:4,title:"Triangle",value:{name:"triangle"}}]},{type:"style",items:[{type:"TextFill",title:"Text Fill",data:{type:"color"}},{type:"FontSize",title:"Text Size",data:{type:"range",min:8,max:120,step:1,start:28}},{type:"FontStyle",title:"Font Style",data:[{id:1,title:"Normal",value:"normal"},{id:2,title:"Italic",value:"italic"},{id:3,title:"Bold",value:"bold"}]},{type:"TextAlign",title:"Text Align",data:[{id:1,
title:"Left",value:"left"},{id:2,title:"Center",value:"center"},{id:3,title:"Right",value:"right"}]},{type:"LineHeight",title:"Line Height",data:{type:"range",min:0.6,max:4,step:0.1,start:2}}]},{type:"border",items:[{type:"BorderWidth",title:"Border Width",data:{type:"range",min:0,max:100,step:10,start:0}},{type:"BorderColor",title:"Border Color",data:{type:"color"}},{type:"CornerRadius",title:"Corner Radius",data:{type:"range",min:0,max:800,step:10,start:0}}]},{type:"stroke",items:[{type:"StrokeWidth",
title:"Stroke Width",data:{type:"range",min:1,max:40,step:1,start:1}},{type:"StrokeColor",title:"Stroke Color",data:{type:"color",transparent:!0}}]},{type:"fontFamilyGroup",items:imageEditor.FONTS},{type:"Brightness",title:"Brightness",data:{type:"range",min:-100,max:100,step:1,start:0,serialize:!1}},{type:"Contrast",title:"Contrast",data:{type:"range",min:-100,max:100,step:1,start:0,serialize:!1}},{type:"Opacity",title:"Opacity",data:{type:"range",min:0,max:1,step:0.01,start:1}},{type:"FillColor",
title:"Color",data:{type:"color",range:"basic",transparent:!0}}];
(function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b__superobject\b/:/.*/;this.Class=function(){};Class.extend=function(c){function d(){!a&&this.__constructor&&this.__constructor.apply(this,arguments)}var e=this.prototype,g,f;a=!0;g=new this;a=!1;for(f in c)g[f]="function"===typeof c[f]&&"function"===typeof e[f]&&b.test(c[f])?function(a,b){return function(){var c=this.__superobject,d;return this.__superobject=e[a],d=b.apply(this,arguments),this.__superobject=c,d}}(f,c[f]):c[f];return d.prototype=
g,d.prototype.constructor=d,d.extend=arguments.callee,d}})();imageEditor.coreObject=Class.extend({__constructor:function(a){for(var b in a)this[b]=a[b];this.eventListeners={}},on:function(a,b){this.eventListeners[a]||(this.eventListeners[a]=[]);this.eventListeners[a].push(b)},fire:function(a,b){var c=this.eventListeners[a],d,e;if(c){d=c.length;for(e=0;e<d;e++)c[e].apply(this,[b||{}])}}});
imageEditor.uiElement=imageEditor.coreObject.extend({__constructor:function(a){this.__superobject(a);this.propertyQueue=[]},loadImages:function(a,b){this.fire("progress-start","Loading image",this);var c=0,d={};$.each(a,function(e,g){var f=new Image;f.onload=function(){d[g]=f;c++;c==a.length&&(b(d),this.fire("progress-complete",this))}.bind(this);f.onerror=function(){this.fire("progress-complete",this);this.fire("error","The image could not be loaded",this)}.bind(this);f.src=g.toLowerCase().startsWith("http")||
g.toLowerCase().startsWith("data")?g:config.assetsURL+g}.bind(this))},draw:function(){},deselect:function(){},getProperties:function(){},select:function(){this.fire("select",this)},drawStage:function(){this.layer.getStage().draw()},setProperty:function(a,b,c){var d,e;if(0<this.propertyQueue.length||this.propertyInProgress){d=!1;for(e=0;e<this.propertyQueue.length;++e)this.propertyQueue[e].type===a&&(this.propertyQueue[e].value=b,this.propertyQueue[e].callback=c,d=!0);d||this.propertyQueue.push({type:a,
value:b,callback:c})}else this.propertyInProgress=!0,d=eval("this.set"+a),this._isAsyncProperty(a)?d.call(this,b,function(){if(c&&c.call(this),this.propertyInProgress=!1,0<this.propertyQueue.length){var a=this.propertyQueue.pop();this.setProperty(a.type,a.value,a.callback)}}.bind(this)):(d.call(this,b),c&&c.call(this),this.propertyInProgress=!1,0<this.propertyQueue.length&&(e=this.propertyQueue.pop(),this.setProperty(e.type,e.value,e.callback)))},getProperty:function(a){return(a=eval("this.get"+a))?
a.call(this):null},applyProperties:function(a){if(this.properties){var b=null,c=function(d){d===this.properties.length?a.call(this):(b=this.properties[d],d++,this.setProperty(b.type,b.value,function(){c(d)}.bind(this)))}.bind(this);c(0)}else a.call(this)},_isAsyncProperty:function(a){return"FontFamily"===a||"Frame"===a||"Filter"===a||"Contrast"==a||"Brightness"==a},_getPropertyConfig:function(a){var b,c;if(a instanceof Array){b=[];for(c=0;c<a.length;++c)b[b.length]=this._getPropertyConfig(a[c]);return b}return{type:a,
value:this.getProperty(a)}},getConfig:function(){return{type:this.type,properties:this.getProperties()}}});
imageEditor.uiShape=imageEditor.uiElement.extend({__constructor:function(a,b){this.__superobject(a,b);this.properties=this.properties||[];this.width=this.width||100;this.height=this.height||100;this.scale=this.scale||1;this.deg=this.deg||0;this.x||(this.layer.getCanvas().getWidth(),this.x=this.cornerOffset?this.getStageWidth()/2-this.width*this.scale/2:this.getStageWidth()/2);this.y||(this.layer.getCanvas().getHeight(),this.y=this.cornerOffset?this.getStageHeight()/2-this.height*this.scale/2:this.getStageHeight()/
2);this.group=new Kinetic.Group({x:this.x,y:this.y,width:this.width,height:this.height,draggable:!0,dragOnTop:!1,scale:{x:this.scale,y:this.scale},rotation:this.deg});void 0===this.cornerOffset&&this.group.offset(this.width/2,this.height/2);this.group.on("mousedown tap dragstart",function(){this.ready&&this.select()}.bind(this));this.group.on("dragmove",function(){var a=this.group.position();this.setPosition(a.x,a.y);this.updateAnchorPosition()}.bind(this));this.layer.add(this.group);this.zindex||
this.group.moveToTop()},getStageWidth:function(){return this.layer.getStage().getWidth()/this.layer.getStage().scale().x},getStageHeight:function(){return this.layer.getStage().getHeight()/this.layer.getStage().scale().y},dispose:function(){this.group.remove();this.anchor.remove();this.drawStage()},moveToTop:function(){this.group.moveToTop();this.anchor.moveToTop()},moveToBottom:function(){this.anchor.moveToBottom();this.group.moveToBottom()},setPosition:function(a,b){this.x=a;this.y=b},select:function(){this.selected=
!0;this.boundingBox||(this.boundingBox=new Kinetic.Rect({width:this.width,height:this.height,stroke:"#FC7488",strokeWidth:0.5,dash:[2,2]}),this.group.add(this.boundingBox),this.addAnchor());this.boundingBox.show();this.anchor.show();this.__superobject()},deselect:function(){this.selected=!1;this.boundingBox&&(this.boundingBox.hide(),this.anchor.hide())},updateAnchorPosition:function(){var a=this.group.position(),b=0;this.cornerOffset?(b=this._distance({x:0,y:0},{x:this.width*this.scale,y:0}),this.startAngle=
this._angle({x:a.x,y:a.y},{x:a.x+this.width,y:a.y})):(this.startAngle=this._angle({x:a.x,y:a.y},{x:a.x+this.width/2,y:a.y-this.height/2}),b=this._distance({x:0,y:0},{x:this.width*this.scale/2,y:this.height*this.scale/-2}));a=this._getPointAt(this.group.position(),b,this.group.rotation()+this.startAngle);this.anchor.position(a)},update:function(){var a=this.group.position(),b=this.anchor.position(),c=this.anchor.offset(),c={x:b.x-c.x,y:b.y-c.y};this.deg=this._angle(a,c)-this.startAngle-this.anchor.rotation();
this.group.rotation(this.deg);b=this.cornerOffset?this._distance(a,{x:a.x+this.width*this.scale,y:a.y}):this._distance(a,{x:a.x+this.width*this.scale/2,y:a.y-this.height*this.scale/2});a=this._distance(a,c);this.scale=this.scale*a/b;this.group.scale({x:this.scale,y:this.scale});this.layer.draw()},_angle:function(a,b){var c=a.x,d=a.y-Math.sqrt(Math.abs(b.x-a.x)*Math.abs(b.x-a.x)+Math.abs(b.y-a.y)*Math.abs(b.y-a.y));return 360*Math.atan2(b.y-d,b.x-c)/Math.PI},_getPointAt:function(a,b,c){return c*=Math.PI/
180,{x:a.x+Math.sin(Math.PI-c)*b,y:a.y+Math.cos(Math.PI-c)*b}},_distance:function(a,b){var c=b.x-a.x,d;return c*=c,d=b.y-a.y,d*=d,Math.sqrt(c+d)},addAnchor:function(){this.anchor=new Kinetic.Circle({stroke:"#FC7488",fill:"#FC7488",strokeWidth:0.5,radius:8,dragOnTop:!1,draggable:!0,name:"helper"});this.anchor.on("dragmove",function(){this.update(this)}.bind(this));this.anchor.on("mouseover",function(){this.anchor.stroke("#000");this.drawStage()}.bind(this));this.anchor.on("mouseout",function(){this.anchor.stroke("#FC7488");
this.drawStage()}.bind(this));this.updateAnchorPosition();this.layer.add(this.anchor)},setSize:function(a,b){this.width=a;this.height=b;this.group.setSize(a,b);void 0===this.cornerOffset&&this.group.offset(this.width/2,this.height/2);this.boundingBox&&(this.boundingBox.setSize(a,b),this.updateAnchorPosition())},setHeight:function(a){this.height=a;this.group.height(a);void 0===this.cornerOffset&&this.group.offset(this.width/2,this.height/2);this.boundingBox&&(this.boundingBox.height(a),this.updateAnchorPosition())},
setScale:function(a){this.scale=a;this.group.scale({x:a,y:a})},applyFilter:function(a,b,c){var d,e;"none"===b.name?(this.filterConfig=null,c(a)):(this.filterConfig=b,d=document.createElement("canvas"),d.width=a.width,d.height=a.height,e=this,this.fire("download-start",this),Caman(d,a.src,function(){this[b.name]();this.render(function(){var a=d.toDataURL("image/jpeg",0.84),b=new Image;b.onload=function(){d=null;c(b);e.fire("download-complete",this)};b.src=a})}))},setShadowColor:function(a){this._getShadowedShape().shadowColor(a)},
getShadowColor:function(){return this._getShadowedShape().shadowColor()},setShadowBlur:function(a){this._getShadowedShape().shadowBlur(a)},getShadowBlur:function(){return this._getShadowedShape().shadowBlur()},setShadowOffset:function(a){this._getShadowedShape().shadowOffset({x:a[0],y:a[1]})},getShadowOffset:function(){return this._getShadowedShape().shadowOffset()},setShadowOpacity:function(a){this._getShadowedShape().shadowOpacity(a)},getShadowOpacity:function(){return this._getShadowedShape().shadowOpacity()},
getShadowConfig:function(){return this._getShadowedShape().hasShadow()?this._getPropertyConfig(["ShadowColor","ShadowOffset","ShadowBlur","ShadowOpacity"]):[]},getConfig:function(){return jQuery.extend(!1,{x:Math.round(this.x),y:Math.round(this.y),width:this.width,height:this.height,scale:this.scale,deg:this.deg,zindex:this.group.getZIndex()},this.__superobject())}});
imageEditor.uiText=imageEditor.uiShape.extend({__constructor:function(a){this.localFonts=["Arial","Georgia"];this.cornerOffset=!0;this.strokeCol="#000000";a.width||(a.width=400);this.__superobject(a)},draw:function(){this.txt=new Kinetic.Text({width:this.width,text:this.title,fill:"black",fontSize:24,lineHeight:1.2,fontFamily:"Arial",lineJoin:"round"});this.group.add(this.txt);this.applyProperties(function(){this._updateHeight();this.redraw();this.ready=!0;this.fire("ready",this)})},redraw:function(){this.drawStage()},
update:function(){this.__superobject();this.stroke&&this.stroke.width(this.width)},setText:function(a){this.title=a;this.txt.setText(a);this.stroke&&this.stroke.setText(a);this._updateHeight();this.redraw()},getText:function(){return this.txt.getText()},setFontSize:function(a){this.txt.setFontSize(a);this.stroke&&this.stroke.fontSize(a);this._updateHeight()},getFontSize:function(){return this.txt.fontSize()},setLineHeight:function(a){this.txt.setLineHeight(a);this.stroke&&this.stroke.setLineHeight(a);
this._updateHeight()},getLineHeight:function(){return this.txt.getLineHeight()},setFontFamily:function(a,b){-1!==jQuery.inArray(a,this.localFonts)?(this._setFontFamily(a),b(this)):this._loadFont(a,function(){this._setFontFamily(a);b(this)}.bind(this))},getFontFamily:function(){return this.txt.fontFamily()},setTextAlign:function(a){this.txt.setAlign(a);this.stroke&&this.stroke.setAlign(a)},setFontStyle:function(a){this.txt.fontStyle(a);this.stroke&&this.stroke.fontStyle(a)},getFontStyle:function(){return this.txt.fontStyle()},
getTextAlign:function(){return this.txt.getAlign()},setTextFill:function(a){this.txt.setFill(a);this.stroke&&this.stroke.fill(a)},getTextFill:function(){return this.txt.getFill()},setStrokeColor:function(a){this._createStroke();this.stroke.stroke(a)},getStrokeColor:function(){if(this.stroke)return this.stroke.stroke()},setStrokeWidth:function(a){this.strokeWid=a;0===a?this._removeStroke():(this._createStroke(),this.stroke.strokeWidth(a))},getStrokeWidth:function(){if(this.stroke)return this.stroke.strokeWidth()},
setOpacity:function(a){this.txt.opacity(a);this.stroke&&this.stroke.opacity(a)},getOpacity:function(){return this.txt.getOpacity()},getProperties:function(){var a=this.getShadowConfig(),a=a.concat(this._getPropertyConfig("Opacity TextFill FontSize FontFamily LineHeight TextAlign FontStyle".split(" ")));this.stroke&&(a=a.concat(this._getPropertyConfig(["StrokeColor","StrokeWidth"])));return a},getConfig:function(){return jQuery.extend({title:this.title},this.__superobject())},_updateHeight:function(){this.setHeight(this.txt.getHeight())},
_setFontFamily:function(a){this.txt.fontFamily(a);this.stroke&&this.stroke.fontFamily(a);this._updateHeight()},_loadFont:function(a,b){this.fire("progress-start","Loading Font",this);this.ready=!1;var c=this,d=function(){b();c.ready=!0;c.fire("progress-complete",c)};WebFont.load({google:{families:[a]},active:function(){d()},inactive:function(){d();c.fire("error","The specified font could not be loaded",this)}})},_createStroke:function(){this.stroke||(this.stroke=this.txt.clone(),this.stroke.fillEnabled(),
this.stroke.opacity(this.txt.opacity()),this.group.add(this.stroke),this.stroke.moveToBottom(),this._transferShadow(this.txt,this.stroke))},_removeStroke:function(){this.stroke&&(this._transferShadow(this.stroke,this.txt),this.stroke.remove(),this.stroke=null)},_getShadowedShape:function(){return this.stroke||this.txt},_transferShadow:function(a,b){a.hasShadow()&&(b.setShadowColor(a.getShadowColor()),b.setShadowBlur(a.getShadowBlur()),b.setShadowOffset(a.getShadowOffset()),b.setShadowOpacity(a.getShadowOpacity()),
a.shadowEnabled(!1),b.shadowEnabled(!0))}});
imageEditor.uiBackground=imageEditor.uiElement.extend({__constructor:function(a){this.__superobject(a)},draw:function(){this.renderGroup=new Kinetic.Group({x:0,y:0,width:this.stageWidth,height:this.stageHeight});this.bg=new Kinetic.Image({width:this.stageWidth,height:this.stageHeight});this.layer.add(this.renderGroup);this.renderGroup.add(this.bg);this.loadImages([this.src],function(a){this.photoImage=this.photoImageOrig=a[this.src];this.renderGroup.on("mousedown tap",function(){this.select()}.bind(this));
this.updateOrder();this.applyProperties(function(){this._fill();this.redraw();this.ready=!0;this.fire("ready",this)})}.bind(this))},redraw:function(){this.drawStage()},select:function(){this.selected=!0;this.__superobject()},dispose:function(){this.bg.remove();this.drawStage()},getPhoto:function(){return this.src},setPhoto:function(a){this.loadImages([a],function(b){this.src=a;this.photoImage=this.photoImageOrig=b[a];this.setFilter(this.filter,function(){this.redraw()}.bind(this))}.bind(this))},setFilter:function(a,
b){var c=[];null==a||"none"===a.name?this.filter=null:(this.filter=a,c[c.length]=a);this._filter(this.photoImageOrig,c,function(a){this.photoImage=this.renderedImage=a;this._adjust(function(){this._fill();b(this)}.bind(this))}.bind(this))},getFilter:function(){return this.filter},_adjust:function(a){var b=[];this.contrast&&0!==this.contrast&&(b[b.length]={name:"contrast",params:this.contrast});this.brightness&&0!==this.brightness&&(b[b.length]={name:"brightness",params:this.brightness});this._filter(this.renderedImage||
this.photoImageOrig,b,function(b){this.photoImage=b;this._fill();a(this)}.bind(this))},setContrast:function(a,b){this.contrast=a;this._adjust(b)},getContrast:function(){return this.contrast||0},setBrightness:function(a,b){this.brightness=a;this._adjust(b)},getBrightness:function(){return this.brightness||0},setFrame:function(a,b){null==a?(this.frame&&(this.frame.remove(),this.frame=null,this.frameFillColor&&(this.frameFillColor=null),this.redraw()),b(this)):this.loadImages([a],function(c){this.frameSrc=
a;this.frame||(this.frame=new Kinetic.Image({width:this.stageWidth,height:this.stageHeight}),this.renderGroup.add(this.frame),this.updateOrder());this.frame.setImage(c[a]);this.frameFillColor&&this.setFrameFillColor(this.frameFillColor);b(this)}.bind(this))},getFrame:function(){return null!=this.frame?this.frameSrc:null},setFrameFillColor:function(a){this.frame&&("transparent"==a?this.frameFillColor=null:(this.frameFillColor=a,this.frame.cache(),this.frame.setFilterColorFill(a),this.frame.filters([Kinetic.Filters.ColorFill]),
this.layer.draw()))},getFrameFillColor:function(){return this.frameFillColor},updateOrder:function(){this.renderGroup.moveToBottom()},getProperties:function(){var a=[];return this.filter&&(a=a.concat(this._getPropertyConfig("Filter"))),this.frame&&(a=a.concat(this._getPropertyConfig("Frame"))),this.frameFillColor&&(a=a.concat(this._getPropertyConfig("FrameFillColor"))),this.contrast&&0!=this.contrast&&(a=a.concat(this._getPropertyConfig("Contrast"))),this.brightness&&0!=this.brightness&&(a=a.concat(this._getPropertyConfig("Brightness"))),
a},getConfig:function(){return jQuery.extend({src:this.src,zindex:0},this.__superobject())},_fill:function(){this.bg.setImage(this.photoImage)},_filter:function(a,b,c){var d,e;null==b||0==b.length?c(a):(d=document.createElement("canvas"),d.width=a.width,d.height=a.height,e=this,this.fire("progress-start","Applying Filters",this),Caman(d,a.src,function(){for(var a=0;a<b.length;++a)this[b[a].name](b[a].params);this.render(function(){var a=d.toDataURL(),b=new Image;b.onload=function(){d=null;c(b);e.fire("progress-complete",
this)};b.src=a})}))}});
imageEditor.uiClipart=imageEditor.uiShape.extend({__constructor:function(a){this.cornerOffset=!0;this.__superobject(a)},draw:function(){this.loadImages([this.src],function(a){this.imgObj=this.imgObjOrig=a[this.src];this.img=new Kinetic.Image({image:this.imgObj});this.resizeGroup();this.applyProperties(function(){this.group.add(this.img);this.redraw();this.ready=!0;this.fire("ready",this)})}.bind(this))},resizeGroup:function(){this.width=this.img.width();this.height=this.img.height()},redraw:function(){this.drawStage()},
setFillColor:function(a){"transparent"==a?this.fillColor=null:(this.fillColor=a,this.img.cache(),this.img.setFilterColorFill(a),this.img.filters([Kinetic.Filters.ColorFill]),this.img.draw())},getFillColor:function(){return this.fillColor},setOpacity:function(a){this.img.opacity(a);this.redraw()},getOpacity:function(){return this.img.getOpacity()},setFlipHorizontal:function(){this.flipHorizontal?(this.flipHorizontal=null,this.img.scaleX(1),this.img.setX(0)):(this.flipHorizontal=!0,this.img.scaleX(-1),
this.img.setX(this.width))},setFlipVertical:function(){this.flipVertical?(this.flipVertical=null,this.img.scaleY(1),this.img.setY(0)):(this.flipVertical=!0,this.img.scaleY(-1),this.img.setY(this.height))},getFlipVertical:function(){return this.flipVertical},getFlipHorizontal:function(){return this.flipHorizontal},getProperties:function(){var a=this.getShadowConfig(),a=a.concat(this._getPropertyConfig("Opacity"));this.filterConfig&&(a=a.concat(this._getPropertyConfig("Filter")));this.fillColor&&(a=
a.concat(this._getPropertyConfig("FillColor")));this.flipVertical&&(a=a.concat(this._getPropertyConfig("FlipVertical")));this.flipHorizontal&&(a=a.concat(this._getPropertyConfig("FlipHorizontal")));this.contrast&&0!=this.contrast&&(a=a.concat(this._getPropertyConfig("Contrast")));this.brightness&&0!=this.brightness&&(a=a.concat(this._getPropertyConfig("Brightness")));return a},getConfig:function(){return jQuery.extend({src:this.src},this.__superobject())},_getShadowedShape:function(){return this.img},
_adjust:function(a){var b=[];this.contrast&&0!==this.contrast&&(b[b.length]={name:"contrast",params:this.contrast});this.brightness&&0!==this.brightness&&(b[b.length]={name:"brightness",params:this.brightness});this._filter(this.renderedImage||this.imgObjOrig,b,function(b){this.imgObj=b;this._fill();a(this)}.bind(this))},_fill:function(){this.img.setImage(this.imgObj)},setContrast:function(a,b){this.contrast=a;this._adjust(b)},getContrast:function(){return this.contrast||0},setBrightness:function(a,
b){this.brightness=a;this._adjust(b)},getBrightness:function(){return this.brightness||0},_filter:function(a,b,c){var d,e;null==b||0==b.length?c(a):(d=document.createElement("canvas"),d.width=a.width,d.height=a.height,e=this,this.fire("progress-start","Applying Filters",this),Caman(d,a.src,function(){for(var a=0;a<b.length;++a)this[b[a].name](b[a].params);this.render(function(){var a=d.toDataURL(),b=new Image;b.onload=function(){d=null;c(b);e.fire("progress-complete",this)};b.src=a})}))}});
imageEditor.uiImage=imageEditor.uiShape.extend({__constructor:function(a){this.cornerOffset=!0;this.__superobject(a)},draw:function(){this.loadImages([this.src],function(a){this.photoImage=this.photoImageOrig=a[this.src];this.img=new Kinetic.Image({image:this.photoImage});this.applyProperties(function(){this.group.add(this.img);this.redraw();this.ready=!0;this.fire("ready",this)})}.bind(this))},redraw:function(){this.drawStage()},setFilter:function(a,b){var c=[];null==a||"none"===a.name?this.filter=
null:(this.filter=a,c[c.length]=a);this._filter(this.photoImageOrig,c,function(a){this.photoImage=this.renderedImage=a;this._adjust(function(){this._fill();b(this)}.bind(this))}.bind(this))},getFilter:function(){return this.filterConfig},setOpacity:function(a){this.img.opacity(a);this.redraw()},getOpacity:function(){return this.img.getOpacity()},setFlipHorizontal:function(){this.flipHorizontal?(this.flipHorizontal=null,this.img.scaleX(1),this.img.setX(0)):(this.flipHorizontal=!0,this.img.scaleX(-1),
this.img.setX(this.width))},setFlipVertical:function(){this.flipVertical?(this.flipVertical=null,this.img.scaleY(1),this.img.setY(0)):(this.flipVertical=!0,this.img.scaleY(-1),this.img.setY(this.height))},getFlipVertical:function(){return this.flipVertical},getProperties:function(){var a=this.getShadowConfig();return this.filterConfig&&(a=a.concat(this._getPropertyConfig("Filter"))),this.FlipVertical&&(a=a.concat(this._getPropertyConfig("FlipVertical"))),this.contrast&&0!=this.contrast&&(a=a.concat(this._getPropertyConfig("Contrast"))),
this.brightness&&0!=this.brightness&&(a=a.concat(this._getPropertyConfig("Brightness"))),this.flipHorizontal&&(a=a.concat(this._getPropertyConfig("FlipHorizontal"))),a},getConfig:function(){return jQuery.extend({src:this.src},this.__superobject())},_getShadowedShape:function(){return this.img},_adjust:function(a){var b=[];this.contrast&&0!==this.contrast&&(b[b.length]={name:"contrast",params:this.contrast});this.brightness&&0!==this.brightness&&(b[b.length]={name:"brightness",params:this.brightness});
this._filter(this.renderedImage||this.photoImageOrig,b,function(b){this.photoImage=b;this._fill();a(this)}.bind(this))},_fill:function(){this.img.setImage(this.photoImage)},setContrast:function(a,b){this.contrast=a;this._adjust(b)},getContrast:function(){return this.contrast||0},setBrightness:function(a,b){this.brightness=a;this._adjust(b)},getBrightness:function(){return this.brightness||0},_filter:function(a,b,c){var d,e;null==b||0==b.length?c(a):(d=document.createElement("canvas"),d.width=a.width,
d.height=a.height,e=this,this.fire("progress-start","Applying Filters",this),Caman(d,a.src,function(){for(var a=0;a<b.length;++a)this[b[a].name](b[a].params);this.render(function(){var a=d.toDataURL(),b=new Image;b.onload=function(){d=null;c(b);e.fire("progress-complete",this)};b.src=a})}))}});
imageEditor.uiLineShape=imageEditor.uiShape.extend({__constructor:function(a){this.cornerOffset=!0;a.scale||(a.scale=1);a.width||(a.width=200);a.height||(a.height=200);a.deg||(a.deg=0);this.__superobject(a)},draw:function(){this.line=new Kinetic.Line({points:[0,0,200,200],scale:this.scale,rotation:this.deg,stroke:"black",strokeWidth:6});this.applyProperties(function(){this.group.add(this.line);this.redraw();this.ready=!0;this.fire("ready",this)})},redraw:function(){this.drawStage()},setFillColor:function(a){this.line.clearFilter();
"transparent"==a?this.fillColor=null:(this.fillColor=a,this.line.setFilterColorFill(a),this.line.setFilter(Kinetic.Filters.ColorFill))},getFillColor:function(){return this.fillColor},setFilter:function(a,b){this.line.setImage(this.imgObj);this.applyFilter(this.imgObj,a,function(a){this.line.setImage(a);b(this)}.bind(this))},getFilter:function(){return this.filterConfig},setOpacity:function(a){this.line.setOpacity(a);this.redraw()},getOpacity:function(){return this.line.getOpacity()},getProperties:function(){var a=
this.getShadowConfig(),a=a.concat(this._getPropertyConfig("Opacity"));return this.fillColor&&(a=a.concat(this._getPropertyConfig("FillColor"))),a=a.concat(this._getPropertyConfig(["StrokeColor","StrokeWidth"])),a},getConfig:function(){return jQuery.extend({src:this.src},this.__superobject())},_getShadowedShape:function(){return this.line},setStrokeColor:function(a){this.line.stroke(a)},getStrokeColor:function(){return this.line.stroke()},setStrokeWidth:function(a){this.line.strokeWidth(a)},getStrokeWidth:function(){return this.line.strokeWidth()}});
imageEditor.uiCircleShape=imageEditor.uiShape.extend({__constructor:function(a){this.cornerOffset=!0;a.width||(a.width=200);a.height||(a.height=200);a.deg||(a.deg=0);a.radius||(a.radius=100);a.scale||(a.scale=1);this.__superobject(a)},draw:function(){this.circle=new Kinetic.Circle({x:this.x,y:this.y,radius:this.radius,rotation:this.deg,scale:this.scale,stroke:"black",fill:"black",strokeWidth:4});this.group.add(this.circle);this.applyProperties(function(){this.redraw();this.ready=!0;this.fire("ready",
this)})},redraw:function(){this.drawStage()},setFillColor:function(a){"transparent"!=a?(this.fillColor=a,this.circle.fill(this.fillColor)):this.circle.fill("rgba(0, 0, 0, 0)")},getFillColor:function(){return this.fillColor},setOpacity:function(a){this.circle.setOpacity(a);this.redraw()},getOpacity:function(){return this.circle.getOpacity()},getProperties:function(){var a=this.getShadowConfig(),a=a.concat(this._getPropertyConfig("Opacity"));return this.fillColor&&(a=a.concat(this._getPropertyConfig("FillColor"))),
a=a.concat(this._getPropertyConfig(["StrokeColor","StrokeWidth"])),a},_getShadowedShape:function(){return this.circle},setStrokeColor:function(a){this.circle.stroke(a)},getStrokeColor:function(){return this.circle.stroke()},setStrokeWidth:function(a){this.circle.strokeWidth(a)},getStrokeWidth:function(){return this.circle.strokeWidth()}});
imageEditor.uiTriangleShape=imageEditor.uiShape.extend({__constructor:function(a){this.cornerOffset=!0;a.width||(a.width=200);a.height||(a.height=200);a.scale||(a.scale=1);a.deg||(a.deg=0);a.radius||(a.radius=100);this.__superobject(a)},draw:function(){this.line=new Kinetic.RegularPolygon({x:this.x,y:this.y,sides:3,scale:this.scale,rotation:this.deg,stroke:"black",strokeWidth:4,fill:"black",radius:this.radius});this.applyProperties(function(){this.group.add(this.line);this.redraw();this.ready=!0;
this.fire("ready",this)})},redraw:function(){this.drawStage()},setFillColor:function(a){this.line.clearFilter();"transparent"==a?this.fillColor=null:(this.fillColor=a,this.line.setFilterColorFill(a),this.line.setFilter(Kinetic.Filters.ColorFill))},getFillColor:function(){return this.fillColor},setFilter:function(a,b){this.line.setImage(this.imgObj);this.applyFilter(this.imgObj,a,function(a){this.line.setImage(a);b(this)}.bind(this))},getFilter:function(){return this.filterConfig},setOpacity:function(a){this.line.setOpacity(a);
this.redraw()},getOpacity:function(){return this.line.getOpacity()},getProperties:function(){var a=this.getShadowConfig(),a=a.concat(this._getPropertyConfig("Opacity"));return this.fillColor&&(a=a.concat(this._getPropertyConfig("FillColor"))),a=a.concat(this._getPropertyConfig(["StrokeColor","StrokeWidth"])),a},getConfig:function(){return jQuery.extend({src:this.src},this.__superobject())},_getShadowedShape:function(){return this.line},setStrokeColor:function(a){this.line.stroke(a)},getStrokeColor:function(){return this.line.stroke()},
setStrokeWidth:function(a){this.line.strokeWidth(a)},getStrokeWidth:function(){return this.line.strokeWidth()}});
imageEditor.uiRectangleShape=imageEditor.uiShape.extend({__constructor:function(a){this.cornerOffset=!0;a.width||(a.width=200);a.height||(a.height=160);a.scale||(a.scale=1);a.deg||(a.deg=0);this.__superobject(a)},draw:function(){this.rect=new Kinetic.Rect({x:0,y:0,width:this.width,height:this.height,rotation:this.deg,scale:this.scale,strokeWidth:4,fill:"black",stroke:"black"});this.applyProperties(function(){this.group.add(this.rect);this.redraw();this.ready=!0;this.fire("ready",this)})},redraw:function(){this.drawStage()},
setFillColor:function(a){"transparent"!=a&&(this.fillColor=a,this.rect.fill(this.fillColor))},getFillColor:function(){return this.fillColor},setOpacity:function(a){this.rect.setOpacity(a);this.redraw()},getOpacity:function(){return this.rect.getOpacity()},getProperties:function(){var a=this.getShadowConfig(),a=a.concat(this._getPropertyConfig("Opacity"));return this.fillColor&&(a=a.concat(this._getPropertyConfig("FillColor"))),a=a.concat(this._getPropertyConfig(["StrokeColor","StrokeWidth"])),a},
getConfig:function(){return jQuery.extend({src:this.src},this.__superobject())},_getShadowedShape:function(){return this.rect},setStrokeColor:function(a){this.rect.stroke(a)},getStrokeColor:function(){return this.rect.stroke()},setStrokeWidth:function(a){this.rect.strokeWidth(a)},getStrokeWidth:function(){return this.rect.strokeWidth()}});
imageEditor.uiPanelElement=imageEditor.coreObject.extend({__constructor:function(a){this.__superobject(a);var b=this;$(document).on("click",".editor-prop-pan .cancel",function(){b.close()});$(document).on("click",".editor-pan-nav a",function(a){a.preventDefault();a=$(this).parents(".editor-pan");var d=a.find(".editor-pan-content").removeClass("active").filter($(this).attr("href")).addClass("active");a.find(".editor-pan-nav li").removeClass("active");$(this).parents("li").addClass("active");b._refreshScroller(d)})},
show:function(a,b){var c=$(".editor-prop-pan-"+b),d;if(0===c.length)for(d=0;d<this.settings.length;++d)if(this.settings[d].type==b){c=this._panel(imageEditor.SETTINGS[d]);break}d=c.find(".editor-pan-content").removeClass("active");d.each(function(){var b=$(this),c=a.getProperty(b.data("type"));b.hasClass("user-photo-selector")?b.find("input").val(""):b.hasClass("color")?b.find("input").spectrum("set",c||"#000"):b.hasClass("range")?b.find(".range-slider").val(c||0):b.hasClass("double-range")?(b.find(".range-slider-one").val(c[0]||
0),b.find(".range-slider-two").val(c[1]||0)):(b.find("li").removeClass("selected"),c&&b.find("li").each(function(a,b){JSON.stringify($(b).data("val"))===JSON.stringify(c)&&$(b).addClass("selected")}))});c.find(".editor-pan-nav li").removeClass("active").first().addClass("active");d=d.first().addClass("active");c.hide().fadeIn("fast");this._refreshScroller(d)},close:function(){return $(".editor-pan").fadeOut("fast"),$(".toolbar li").removeClass("active"),!1},_panel:function(a){var b=$('<div class="editor-pan editor-prop-pan editor-prop-pan-'+
a.type+'"></div>').appendTo(".panels"),c=$('<div class="editor-pan-body"></div>').appendTo(b),d=[],e,g,f;if(a.items)for(e=0;e<a.items.length;++e)g="editor_pan_content_"+a.items[e].type+"_"+e,d[d.length]={id:g,title:a.items[e].title},this._content(g,a.items[e],c);else this._content("editor_pan_content_"+a.type,a,c);return f=$('<div class="editor-pan-nav border-box"></div>').appendTo(b),1<d.length&&(f=$("<ul></ul>").appendTo(f),$.each(d,function(a,b){$('<li class="border-box"><a href="#'+b.id+'">'+
b.title+"</a></li>").appendTo(f)})),b},_content:function(a,b,c){a=$('<div class="editor-pan-content editor-pan-content-{0}" id="{1}"></div>'.format(b.type.toLowerCase(),a)).data("type",b.type).appendTo(c);if(b.data instanceof Array)this._list(b,a);else if(b.data instanceof Object)switch(a.addClass(b.data.type),b.data.type){case "color":c.hasClass("mini")&&c.removeClass("mini");c.addClass("maxi");this._colorSelect(b.type,b.data,a);break;case "range":c.hasClass("maxi")||c.addClass("mini");this._rangeSelect(b.type,
b.data,a,!1);break;case "double-range":c.addClass("maxi");this._rangeSelect(b.type,b.data,a,!0);break;case "background":c.addClass("maxi"),this._upload(b.type,b.data,a)}a.hide()},_list:function(a,b){var c;c="FontFamily"===a.type?'<li class="property-item border-box"><div class="thumb thumb-{1}-{2}"><img src="images/fonts/{2}.png" /></div><div class="label border-box"><span>{0}</span></div></li>':"Filter"===a.type?'<li class="property-item border-box"><div class="thumb thumb-{1}-{2}"><img src="images/effects/{2}.png" /></div><div class="label border-box"><span>{0}</span></div></li>':
'<li class="property-item border-box"><div class="thumb thumb-{1}-{2}">&nbsp;</div><div class="label border-box"><span>{0}</span></div></li>';for(var d=$("<ul></ul>").appendTo(b),e,g,f,h=0;h<a.data.length;++h)e=a.data[h],"undefined"===typeof e.value&&(e.value=e.title),g=$(c.format(e.title,a.type.toLowerCase(),e.title.toLowerCase().replace(/ /g,"-"))).data("val",e.value).appendTo(d),a.thumb&&g.addClass("property-item-image").find(".thumb").html("").append('<img class="lazy" data-original="'+environment.assetsThumbURL.format(e.value)+
'" src="images/loading.gif" alt="'+e.title+'" />');this._carousel(d,b,e.length);f=this;d.find("li").on("tap",function(){if(b.data("scroller").moved)return!1;$(this).parents(".editor-prop-pan").find(".editor-pan-content-"+a.type.toLowerCase()+" li").removeClass("selected");$(this).addClass("selected");f.applyProperty(a.type,$(this).data("val"))})},_loadThumbs:function(){$("img.lazy").lazyload()},_refreshScroller:function(a){(a=a.data("scroller"))&&(a.refresh(),this._loadThumbs())},_colorSelect:function(a,
b,c){var d=imageEditor.COLORS,e=$("<ul></ul>").appendTo(c),g,f;b.transparent&&e.append('<li class="property-item color-item color-transparent border-box" data-val="transparent"><div class="thumb">&nbsp;</div><div class="label border-box"><span>Transparent</span></div></li>');b=$('<li class="property-item color-item color-item-selector border-box"></li>').appendTo(e);g=$('<input type="text" />').appendTo(b);$('<div class="label border-box"><span>Select Color</span></div>').appendTo(b);f=this;g.spectrum({color:"#000",
showButtons:!1,move:function(b){f.applyProperty(a,b.toHexString())}.bind(this)});for(b=0;b<d.length;++b)e.append('<li class="property-item color-item border-box" data-val="{0}"><div class="thumb" style="background-color:{0}">&nbsp;</div><div class="label border-box"><span>{0}</span></div></li>'.format(d[b]));this._carousel(e,c,d.length);c.find(".color-item").on("tap",function(){if(c.data("scroller").moved)return!1;f.applyProperty(a,$(this).attr("data-val"))})},_carousel:function(a,b){var c=new IScroll(b.get(0),
{scrollX:!0,scrollY:!1,tap:!0,mouseWheel:!0,mouseWheelSpeed:40,scrollbars:"custom",interactiveScrollbars:!0}),d=0;a.find("li").each(function(){d+=$(this).outerWidth()});a.width(d+30);b.data("scroller",c);c.on("scrollEnd",function(){this._loadThumbs()}.bind(this))},_rangeSelect:function(a,b,c,d){var e=$('<div class="editor-pan-slider"></div>').appendTo(c),g,f,h;g=$('<div class="noUiSlider range-slider range-slider-one"></div>').appendTo(e);f=null;b.serialize&&(f=$('<input type="text" readonly="readonly" />').appendTo(e));
h=null;d&&(e.addClass("editor-pan-slider-double"),h=$('<div class="noUiSlider range-slider range-slider-two"></div>').appendTo(e));c.find(".range-slider").noUiSlider({range:[b.min,b.max],step:b.step,start:b.start,handles:1,slide:function(){this.applyProperty(a,d?[g.val(),h.val()]:g.val())}.bind(this),serialization:{to:b.serialize?f:!1,resolution:b.step}})},_upload:function(a,b,c){var d=this,e=$('<input type="file" size="30" class="hidden" id="photo_custom_input" />').appendTo(c);e.appendTo(c).on("change",
function(a){a=a.target.files;for(var b,c,p=0;b=a[p];p++)b.type.match("image.*")&&(c=new FileReader,c.onload=function(){return function(a){e.replaceWith(e=e.clone(!0));d.close();d.window.cropPhoto(a.target.result)}}(b),c.readAsDataURL(b))});$("#photo_custom_input").trigger("click")},applyProperty:function(a,b){if("shape"===a)this.editor.addObject({type:b.name,x:100,y:100});else{var c=this.editor.getSelectedObject();c.setProperty(a,b,function(){c.redraw()})}},editText:function(a){var b=$(".editor-pan-edit-text"),
c,d=this;0===b.length&&(b=$('<div class="editor-pan editor-prop-pan editor-pan-edit-text"></div>').appendTo(".panels").hide(),c=$('<div class="editor-pan-body"></div>').appendTo(b),$('<div class="editor-pan-content border-box active"><textarea rows="4" cols="50"></textarea><button class="save-text button">Insert</button></div>').appendTo(c));"text"===a.type?($(".editor-pan-edit-text .save-text").off().hide(),$(".editor-pan-edit-text textarea").off().val(a.title).on("input paste",function(){a.setText($(this).val())})):
($(".editor-pan-edit-text textarea").off().val(""),$(".editor-pan-edit-text .save-text").off().show().on("click",function(){var a=$(".editor-pan-edit-text textarea").val();""!==a?(d.editor.addObject({type:"text",title:a,x:50,y:50,width:200,scale:1}),d.close(),$(".editor-pan").remove()):$.ClassyNotty({title:"Error",content:"Please enter some text.",error:!0,img:"images/error.png"})}));b.show()}});
imageEditor.uiProgressElement=Class.extend({__constructor:function(a){this.elem=$(a.elem);this.counter=0},show:function(a){this.counter++;this.elem.html("<span>"+a+"</span>").show()},hide:function(){this.counter--;0===this.counter&&this.elem.hide()}});
imageEditor.uiToolbarElement=imageEditor.coreObject.extend({__constructor:function(a){this.__superobject(a);this.scroller=new IScroll(".toolbar",{scrollX:!0,scrollY:!1,tap:!0,mouseWheel:!0,scrollbars:"custom",interactiveScrollbars:!0,mouseWheelSpeed:40});var b=this;$("nav.toolbar").on("tap","li",function(){b.click($(this))})},click:function(a){if(this.scroller.moved||a.hasClass("disabled"))return!1;if(a.hasClass("active"))this.panel.close(),a.removeClass("active");else{var b=a.attr("data-method"),
c=a.attr("data-id"),d=this.editor.getSelectedObject();this.panel.close();$("nav.toolbar li").removeClass("active");c&&$("nav.toolbar li[data-id="+c+"]").addClass("active");switch(b){case "back":this.editor.getBackground().select();a.removeClass("active");break;case "delete":confirm("Are you sure you want to delete the currently selected object? You will lose all its changes!")&&this.editor.deleteObject(d);a.removeClass("active");break;case "moveToTop":this.editor.moveObjectToTop(d);a.removeClass("active");
break;case "moveToBottom":this.editor.moveObjectToBottom(d);a.removeClass("active");break;case "showProperty":this.panel.show(d,c);break;case "showWindow":this.window._build(c,"");break;case "editText":this.panel.editText(d);break;case "flipHorizontal":d.setProperty("FlipHorizontal",!0,function(){d.redraw()});a.removeClass("active");break;case "flipVertical":d.setProperty("FlipVertical",!0,function(){d.redraw()});a.removeClass("active");break;case "changeBackground":a.removeClass("active"),$("#background").trigger("click")}}},
update:function(a){$("nav.toolbar li").each(function(){var b=$(this).attr("data-type");b&&(-1!=b.indexOf(a)?($(this).removeClass("disabled"),$(this).show()):-1!=b.indexOf("all")?($(this).addClass("disabled"),$(this).show()):$(this).hide())});this._update()},_update:function(){var a=$("nav.toolbar").find("li").filter(":visible");$("nav.toolbar").find("ul").width(a.length*(a.first().width()+8));this.scroller.refresh()}});
imageEditor.uiWindowElement=imageEditor.coreObject.extend({__constructor:function(a){this.__superobject(a);var b=this;$(document).on("click",".editor-win .editor-cancel",function(){b.close()});$(document).on("click",".editor-win .thumbnail",function(){b.close();return b.editor.addObjectById($(this).attr("data-id")).select(),!1});$(document).on("click",".editor-win-nav a",function(){var a=$(this).parents(".editor-win");return a.find(".editor-win-content").removeClass("active").filter($(this).attr("href")).addClass("active"),
a.find(".editor-win-nav li").removeClass("active"),$(this).parents("li").addClass("active"),b._lazyLoad(),!1});this.editor.window=this},_lazyLoad:function(){$("img.lazy").lazyload({container:$(".editor-win-contents")})},_create:function(a,b){var c=$('<div class="editor-win '+a+'"></div>').appendTo(".editor");return c.append('<div class="editor-win-head"><h2>'+b+'</h2><a class="editor-cancel"><span>Close</span></a></div>'),c.append('<div class="editor-win-body"><ul class="editor-win-nav border-box clearfix"></ul><div class="editor-win-contents border-box"></div><div class="editor-win-footer"></div></div>'),
c},_show:function(a){a.css("z-index",99).addClass("editor-win-active").fadeIn();a.find(".editor-win-contents").outerHeight($(".editor").innerHeight()-a.find(".editor-win-head").outerHeight()-a.find(".editor-win-nav").outerHeight()-a.find(".editor-win-footer").outerHeight()-1)},close:function(){$(".editor-win").removeClass("editor-win-active").fadeOut();$(".toolbar li").removeClass("active")},cropPhoto:function(a){var b=$(".editor-win-crop"),c=this,d,e,g,f;this.jcrop={};d=function(a){var d,g;c.jcrop.api&&
c.jcrop.api.destroy();d=b.find(".editor-win-contents");d.html("");g=$('<img alt="" />').appendTo(d).get(0);g.onload=function(){var a=d.width(),b=d.height(),f=getImageSize(e()),a=a/f.width;a*f.height>b&&(a=b/f.height);c.jcrop.scale=a;b=Math.floor(a*f.width);f=Math.floor(a*f.height);g.style.width=b+"px";g.style.height=f+"px";$(g).Jcrop({setSelect:[0,0,b,f],onSelect:function(a){c.jcrop.crop=a}},function(){c.jcrop.api=this})};g.src=a};e=function(){return $(".editor-win-crop img").get(0)};0==b.length&&
(b=this._create("editor-win-crop","Crop your image"),g=b.find(".editor-win-nav"),g.addClass("editor-win-toolbar"),$("<span>right 90</span>").appendTo(g).click(function(){d(rotateImage(e(),90))}),$("<span>left 90</span>").appendTo(g).click(function(){d(rotateImage(e(),-90))}),$("<span>rotate 180</span>").appendTo(g).click(function(){d(rotateImage(e(),180))}),$("<span>Flip Vertical</span>").appendTo(g).click(function(){d(flipVertical(e()))}),$("<span>Flip Horizontal</span>").appendTo(g).click(function(){d(flipHorizontal(e()))}),
f=b.find(".editor-win-footer").addClass("visible"),$('<button class="button">Apply</button>').appendTo(f).click(function(){var a=document.createElement("canvas");a.width=config.width;a.height=config.height;var b=c.jcrop.scale,d=c.jcrop.crop;a.getContext("2d").drawImage(e(),Math.floor(d.x/b),Math.floor(d.y/b),Math.floor(d.w/b),Math.floor(d.h/b));a=a.toDataURL("image/jpeg",0.84);this.editor.getSelectedObject().setPhoto(a);this.close()}.bind(this)));this._show(b);d(a)},cropPhotoSave:function(a){var b=
$(".editor-win-crop"),c=this,d,e,g;this.jcrop={};d=function(){return $(".editor-win-crop img").get(0)};0==b.length&&(b=this._create("editor-win-crop","Crop your image"),e=b.find(".editor-win-nav"),e.addClass("editor-win-toolbar"),g=b.find(".editor-win-footer").addClass("visible"),$('<button class="button">Download</button>').appendTo(g).click(function(){var a=document.createElement("canvas");a.width=config.width;a.height=config.height;var b=c.jcrop.scale,e=c.jcrop.crop;a.getContext("2d").drawImage(d(),
Math.floor(e.x/b),Math.floor(e.y/b),Math.floor(e.w/b),Math.floor(e.h/b),0,0,config.width,config.height);a=a.toDataURL("image/png",0.9);$.ajax({type:"POST",url:config.apiExportURL,data:{imgData:a},cache:!1,success:function(a){$(".export-iframe").remove();$("body").append('<iframe class="export-iframe" src=""></iframe>');$(".export-iframe").attr("src",config.apiExportURL+"?get="+a)}});this.close()}.bind(this)));this._show(b);var f,h;c.jcrop.api&&c.jcrop.api.destroy();f=b.find(".editor-win-contents");
f.html("");h=$('<img alt="" />').appendTo(f).get(0);h.onload=function(){var a=f.width(),b=f.height(),e=getImageSize(d()),a=a/e.width;a*e.height>b&&(a=b/e.height);c.jcrop.scale=a;b=Math.floor(a*e.width);e=Math.floor(a*e.height);h.style.width=b+"px";h.style.height=e+"px";$(h).Jcrop({setSelect:[0,0,b,e],onSelect:function(a){c.jcrop.crop=a}},function(){c.jcrop.api=this})};h.src=a},_build:function(a,b){var c=this,d="editor-win-"+a,e=$("."+d),g,f,h,p,m,s;if(0==e.length)if(e=this._create(d,b),d=e.find(".editor-win-nav"),
g=e.find(".editor-win-contents"),"save"==a)$(".card-save-form").appendTo(g).show();else{var k=$('<ul class="clearfix"></ul>').appendTo(g),j=$('<div class="load-more button">More</div>').appendTo(g),q=$("<h2>Cliparts</h2>"),t=$('<div class="toolbar-sub"></div>').appendTo(d);e.find(".editor-win-head h2").replaceWith(q).wrap('<div class="editor-win-search border-box"></div>');for(var l="",r=0;r<imageEditor.CLIPART_CATEGORIES.length;r++)l+="<span"+("all"===imageEditor.CLIPART_CATEGORIES[r]?' class="active"':
"")+">"+imageEditor.CLIPART_CATEGORIES[r]+"</span>";t.append(l);f=null;d.addClass("editor-win-toolbar");h=null;p=function(b){var e;h=[];b=RegExp(b,"i");for(e=0;e<c.shapes.length;++e)c.shapes[e].type==a&&(-1!=c.shapes[e].tags.search(b)||null!=c.shapes[e].title&&-1!=c.shapes[e].title.search(b))&&(h[h.length]=c.shapes[e])};p("");m=function(){var a=k.find("li").length,b=a+30,c,e;for(b>h.length&&(b=h.length);a<b;++a)c=h[a],e=null!=c.src?'<img src="'+config.assetsThumbURL.format(c.src)+'" alt="" />':c.title,
k.append('<li class="thumbnail" data-id="'+c.id+'"><span class="helper"></span>'+e+"</li>");b>=h.length?j.hide():j.show();$.waypoints("refresh")};j.waypoint(function(){f=$(this);f.waypoint("disable");m();f.waypoint("enable")},{offset:"bottom-in-view",context:g});m();j.on("click",function(){m()});s=function(){"all"===q.val()?p(""):p(q.val());k.html("");k.scrollTop();m()};q.on("input",function(){s()});t.find("span").click(function(){$(".toolbar-sub span").removeClass("active");$(this).addClass("active");
q.val($(this).text());s()})}this._show(e);this._lazyLoad()}});
var editor=imageEditor.coreObject.extend({__constructor:function(a){var b=this;this.__superobject(a);this.scale=1;this.stage=new Kinetic.Stage({container:this.container,width:this.width,height:this.height,scale:{x:this.scale,y:this.scale}});this.layer=new Kinetic.Layer;this.stage.add(this.layer);this.progressbar=new imageEditor.uiProgressElement({elem:".progress"});this.items=[];for(a=0;a<imageEditor.TOOLS.length;a++)$(".toolbar > ul").append('<li data-method="'+imageEditor.TOOLS[a].method+'" data-type="'+
imageEditor.TOOLS[a].type+'" data-id="'+imageEditor.TOOLS[a].id+'" class="tips" title="'+imageEditor.TOOLS[a].tip+'"><i class="editor-icon editor-icon-'+imageEditor.TOOLS[a].icon+'"></i></li>');$(".upload").on("click",function(){$("#upload").trigger("click");return!1});$(".reset").on("click",function(){confirm("Are you sure you want to reset the workspace? You will lose all the changes!")&&(b.clearStage(),b.loadConfig(config.presets));return!1});$(".get-template").on("click",function(){var a=$("textarea.out");
a.hasClass("hidden")?(a.val(b.getConfig()),a.removeClass("hidden")):a.addClass("hidden")});$(".download").on("click",function(){b.toDataUrl(function(a){b.window.cropPhotoSave(a)});!1;return!1});this.getTemplates();$(".more").on("click",function(){b.getTemplates()});$("nav.templates").on("click",".template",function(){if(confirm("Are you sure you want to load a template? You will lose all the changes!")){var a=$(this).data("id");"undefined"!==typeof imageEditor.TEMPLATE[a]&&(b.clearStage(),b.loadConfig(imageEditor.TEMPLATE[a].presets))}return!1});
$("#background").on("change",function(a){a=a||window.event;a.preventDefault();a=a.originalEvent||a;var d=new FileReader;d.onload=function(a){b.window.cropPhoto(a.target.result)};d.onerror=function(){$.ClassyNotty({title:"Error",content:"Your image must be a PNG or JPEG image.",error:!0,img:"images/error.png"})};d.readAsDataURL(a.target.files[0]);return!1});$("#upload").on("change",function(a){a=a||window.event;a.preventDefault();a=a.originalEvent||a;var d=new FileReader;d.onload=function(a){var c=
new Image;c.src=a.target.result;c.onload=function(){var c=1;this.width>config.width?c=config.width/this.width:this.height>config.height&&(c=config.height/this.height);b.addObject({type:"image",src:a.target.result,x:10,y:10,deg:0,width:this.width,height:this.height,scale:c})}};d.onerror=function(){$.ClassyNotty({title:"Error",content:"Your image must be a PNG or JPEG image.",error:!0,img:"images/error.png"})};d.readAsDataURL(a.target.files[0]);return!1});$(function(){$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,
live:!0})});$(window).unload(function(){});$(".templates, .output").css({height:$("section.editor").height()-18});$("textarea.out").css({height:$("section.editor").height()-66})},getTemplates:function(){for(var a="",b=0,c=parseInt($(".more").data("start")),c="undefined"===typeof c?0:c;c<imageEditor.TEMPLATE.length;c++){if(10<=b){$(".more").removeClass("backup").html("more").data("start",b).show();break}a+='<div id="ed_template_'+c+'" data-id="'+c+'" class="template'+(c%2?" last":"")+'"></div>';b++;
$(".more").addClass("backup").html("back").data("start",0)}$("nav.templates .list").empty().append(a)},clearStage:function(){this.items=[];this.layer.destroyChildren();this.layer.draw()},addObjectById:function(a){return this.addObject(this.getItemConfig(a))},addObject:function(a){a.layer=this.layer;a.stageWidth=this.width/this.scale;a.stageHeight=this.height/this.scale;do a.id=Math.floor(1E4*Math.random());while(null!==this.getObjectById(a.id));var b=null;switch(a.type){case "clipart":b=new imageEditor.uiClipart(a);
break;case "image":b=new imageEditor.uiImage(a);break;case "text":b=new imageEditor.uiText(a);break;case "line":b=new imageEditor.uiLineShape(a);break;case "circle":b=new imageEditor.uiCircleShape(a);break;case "rectangle":b=new imageEditor.uiRectangleShape(a);break;case "triangle":b=new imageEditor.uiTriangleShape(a);break;case "background":b=new imageEditor.uiBackground(a)}return this._addObject(b),b},getObjectById:function(a){for(var b=0;b<this.items.length;++b)if(a===this.items[b].id)return this.items[b];
return null},_addObject:function(a){this.items[this.items.length]=a;a.on("select",function(){this.deselectAll(a.id);this.fire("item-selected",a)}.bind(this));a.on("progress-start",function(a){this.progressbar.show(a)}.bind(this));a.on("progress-complete",function(){this.progressbar.hide()}.bind(this));a.on("ready",function(){for(var a=0;a<this.items.length;++a)if(!this.items[a].ready)return!1;this.fire("ready",this)}.bind(this));a.on("error",function(a){$.ClassyNotty({title:"Error",content:a,error:!0,
img:"images/error.png"})}.bind(this));"background"!==a.type&&this.updateBackgroundOrder();a.draw()},getItemConfig:function(a){for(var b=0;b<imageEditor.SHAPES.length;++b)if(imageEditor.SHAPES[b].id==a)return jQuery.extend(!0,{},imageEditor.SHAPES[b])},deleteObject:function(a){a.dispose();this.items.remove(a);this.getBackground().select()},deleteObjectType:function(a){for(var b=0;b<this.items.length;++b)this.items[b].type==a&&this.deleteObject(this.items[b])},deselectAll:function(a){$.each(this.items,
function(b,c){c.id!==a&&c.deselect()});this.fire("deselect-all",this);this.stage.draw()},getSelectedObject:function(){var a=null;return $.each(this.items,function(b,c){c.selected&&(a=c)}),a},moveObjectToTop:function(a){a.moveToTop();this.updateBackgroundOrder();this.stage.draw()},moveObjectToBottom:function(a){a.moveToBottom();this.updateBackgroundOrder();this.stage.draw()},updateBackgroundOrder:function(){this.getBackground().updateOrder()},getBackground:function(){for(var a=0;a<this.items.length;++a)if("background"==
this.items[a].type)return this.items[a]},toDataUrl:function(a){this.stage.setSize(config.width,config.height);this.stage.scale({x:1,y:1});this.stage.draw();this.deselectAll();this.stage.toDataURL({mimeType:"image/png",quality:0.9,callback:function(b){this.stage.setSize(this.width,this.height);this.stage.scale({x:this.scale,y:this.scale});this.stage.draw();this.getBackground().select();a(b)}.bind(this)})},getConfig:function(){for(var a=[],b=0;b<this.items.length;++b)a[a.length]=this.items[b].getConfig();
return JSON.stringify(a)},loadConfig:function(a){var b,c;a.sort(function(a,b){return a.zindex-b.zindex});for(b=0;b<a.length;++b)c=this.addObject(a[b]),"background"==c.type&&c.select()}});function getImageSize(a){var b=new Image;return b.src=a.src,{width:b.width,height:b.height}}
function resizeImage(a,b,c,d){var e=new Image;e.onload=function(){var a=b,f=Math.floor(e.height*b/e.width),h;f>c&&(a=Math.floor(e.width*c/e.height),f=c);h=document.createElement("canvas");h.width=a;h.height=f;h.getContext("2d").drawImage(e,0,0,a,f);a=h.toDataURL("image/jpeg",0.84);d(a)};e.src=a}
function rotateImage(a,b){var c=b*Math.PI/180,d=getImageSize(a),e=Math.ceil(Math.abs(d.width*Math.cos(c)+d.height*Math.sin(c))),c=Math.ceil(Math.abs(d.width*Math.sin(c)+d.height*Math.cos(c))),g=document.createElement("canvas"),f;return g.width=e,g.height=c,f=g.getContext("2d"),f.translate(e/2,c/2),f.rotate(b*Math.PI/180),f.translate(d.width/-2,d.height/-2),f.drawImage(a,0,0),g.toDataURL()}
function flipHorizontal(a){var b=getImageSize(a),c;return canvas=document.createElement("canvas"),canvas.width=b.width,canvas.height=b.height,c=canvas.getContext("2d"),c.translate(b.width,0),c.scale(-1,1),c.drawImage(a,0,0),canvas.toDataURL()}function flipVertical(a){var b=getImageSize(a),c;return canvas=document.createElement("canvas"),canvas.width=b.width,canvas.height=b.height,c=canvas.getContext("2d"),c.translate(0,b.height),c.scale(1,-1),c.drawImage(a,0,0),canvas.toDataURL()}
$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};Array.prototype.remove=function(){for(var a,b=arguments,c=b.length,d;c&&this.length;)for(a=b[--c];-1!==(d=this.indexOf(a));)this.splice(d,1);return this};Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};
String.prototype.startsWith=function(a){return 0===this.indexOf(a)};String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!==typeof a[c]?a[c]:b})};
(function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},b=[].slice,c=this,d=function(c,d){var f,h,p,m,s,k,j,q;f=c(d);s=0<=a.call(d,"ontouchstart");h={horizontal:{},vertical:{}};p=1;m={};q=1;var t,l=function(a){var b=this;this.$element=a;this.element=a[0];this.didScroll=this.didResize=!1;this.id="context"+p++;this.oldScroll={x:a.scrollLeft(),y:a.scrollTop()};this.waypoints={horizontal:{},vertical:{}};a.data("waypoints-context-id",this.id);
m[this.id]=this;a.bind("scroll.waypoints",function(){var a;if(!b.didScroll&&!s)return b.didScroll=!0,a=function(){return b.doScroll(),b.didScroll=!1},d.setTimeout(a,c.waypoints.settings.scrollThrottle)});a.bind("resize.waypoints",function(){var a;if(!b.didResize)return b.didResize=!0,a=function(){return c.waypoints("refresh"),b.didResize=!1},d.setTimeout(a,c.waypoints.settings.resizeThrottle)})};t=(l.prototype.doScroll=function(){var a,b=this;return a={horizontal:{newScroll:this.$element.scrollLeft(),
oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.$element.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}},!s||a.vertical.oldScroll&&a.vertical.newScroll||c.waypoints("refresh"),c.each(a,function(a,d){var f,n,g;return g=[],n=d.newScroll>d.oldScroll,f=n?d.forward:d.backward,c.each(b.waypoints[a],function(a,b){var c,e;return d.oldScroll<(c=b.offset)&&c<=d.newScroll?g.push(b):d.newScroll<(e=b.offset)&&e<=d.oldScroll?g.push(b):void 0}),g.sort(function(a,
b){return a.offset-b.offset}),n||g.reverse(),c.each(g,function(a,b){if(b.options.continuous||a===g.length-1)return b.trigger([f])})}),this.oldScroll={x:a.horizontal.newScroll,y:a.vertical.newScroll}},l.prototype.refresh=function(){var a,b,d,f=this;return d=c.isWindow(this.element),b=this.$element.offset(),this.doScroll(),a={horizontal:{contextOffset:d?0:b.left,contextScroll:d?0:this.oldScroll.x,contextDimension:this.$element.width(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},
vertical:{contextOffset:d?0:b.top,contextScroll:d?0:this.oldScroll.y,contextDimension:d?c.waypoints("viewportHeight"):this.$element.height(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}},c.each(a,function(a,b){return c.each(f.waypoints[a],function(a,d){var f,g,n,u,v;if(f=d.options.offset,n=d.offset,g=c.isWindow(d.element)?0:d.$element.offset()[b.offsetProp],c.isFunction(f)?f=f.apply(d.element):"string"==typeof f&&(f=parseFloat(f),-1<d.options.offset.indexOf("%")&&(f=Math.ceil(b.contextDimension*
f/100))),d.offset=g-b.contextOffset+b.contextScroll-f,(!d.options.onlyOnScroll||null==n)&&d.enabled)return null!==n&&n<(u=b.oldScroll)&&u<=d.offset?d.trigger([b.backward]):null!==n&&n>(v=b.oldScroll)&&v>=d.offset?d.trigger([b.forward]):null===n&&b.oldScroll>=d.offset?d.trigger([b.forward]):void 0})})},l.prototype.checkEmpty=function(){if(c.isEmptyObject(this.waypoints.horizontal)&&c.isEmptyObject(this.waypoints.vertical))return this.$element.unbind("resize.waypoints scroll.waypoints"),delete m[this.id]},
l);var r,l=function(a,b,d){var f;d=c.extend({},c.fn.waypoint.defaults,d);"bottom-in-view"===d.offset&&(d.offset=function(){var a;return a=c.waypoints("viewportHeight"),c.isWindow(b.element)||(a=b.$element.height()),a-c(this).outerHeight()});this.$element=a;this.element=a[0];this.axis=d.horizontal?"horizontal":"vertical";this.callback=d.handler;this.context=b;this.enabled=d.enabled;this.id="waypoints"+q++;this.offset=null;this.options=d;b.waypoints[this.axis][this.id]=this;h[this.axis][this.id]=this;
d=null!=(f=a.data("waypoints-waypoint-ids"))?f:[];d.push(this.id);a.data("waypoints-waypoint-ids",d)};r=(l.prototype.trigger=function(a){if(this.enabled)return null!=this.callback&&this.callback.apply(this.element,a),this.options.triggerOnce?this.destroy():void 0},l.prototype.disable=function(){return this.enabled=!1},l.prototype.enable=function(){return this.context.refresh(),this.enabled=!0},l.prototype.destroy=function(){return delete h[this.axis][this.id],delete this.context.waypoints[this.axis][this.id],
this.context.checkEmpty()},l.getWaypointsByElement=function(a){var b,d;return(d=c(a).data("waypoints-waypoint-ids"),!d)?[]:(b=c.extend({},h.horizontal,h.vertical),c.map(d,function(a){return b[a]}))},l);return j={init:function(a,b){return null==b&&(b={}),null==b.handler&&(b.handler=a),this.each(function(){var a,d,f,g;return a=c(this),f=null!=(g=b.context)?g:c.fn.waypoint.defaults.context,c.isWindow(f)||(f=a.closest(f)),f=c(f),d=m[f.data("waypoints-context-id")],d||(d=new t(f)),new r(a,d,b)}),c.waypoints("refresh"),
this},disable:function(){return j._invoke(this,"disable")},enable:function(){return j._invoke(this,"enable")},destroy:function(){return j._invoke(this,"destroy")},prev:function(a,b){return j._traverse.call(this,a,b,function(a,b,c){if(0<b)return a.push(c[b-1])})},next:function(a,b){return j._traverse.call(this,a,b,function(a,b,c){if(b<c.length-1)return a.push(c[b+1])})},_traverse:function(a,b,f){var h,j;return null==a&&(a="vertical"),null==b&&(b=d),j=k.aggregate(b),h=[],this.each(function(){var b;
return b=c.inArray(this,j[a]),f(h,b,j[a])}),this.pushStack(h)},_invoke:function(a,b){return a.each(function(){var a;return a=r.getWaypointsByElement(this),c.each(a,function(a,c){return c[b](),!0})}),this}},c.fn.waypoint=function(){var a,d;return d=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],j[d]?j[d].apply(this,a):c.isFunction(d)?j.init.apply(this,arguments):c.isPlainObject(d)?j.init.apply(this,[null,d]):d?c.error("The "+d+" method does not exist in jQuery Waypoints."):c.error("jQuery Waypoints needs a callback function or handler option.")},
c.fn.waypoint.defaults={context:d,continuous:!0,enabled:!0,horizontal:!1,offset:0,triggerOnce:!1},k={refresh:function(){return c.each(m,function(a,b){return b.refresh()})},viewportHeight:function(){var a;return null!=(a=d.innerHeight)?a:f.height()},aggregate:function(a){var b,d,f;return(b=h,a&&(b=null!=(f=m[c(a).data("waypoints-context-id")])?f.waypoints:void 0),!b)?[]:(d={horizontal:[],vertical:[]},c.each(d,function(a,f){return c.each(b[a],function(a,b){return f.push(b)}),f.sort(function(a,b){return a.offset-
b.offset}),d[a]=c.map(f,function(a){return a.element}),d[a]=c.unique(d[a])}),d)},above:function(a){return null==a&&(a=d),k._filter(a,"vertical",function(a,b){return b.offset<=a.oldScroll.y})},below:function(a){return null==a&&(a=d),k._filter(a,"vertical",function(a,b){return b.offset>a.oldScroll.y})},left:function(a){return null==a&&(a=d),k._filter(a,"horizontal",function(a,b){return b.offset<=a.oldScroll.x})},right:function(a){return null==a&&(a=d),k._filter(a,"horizontal",function(a,b){return b.offset>
a.oldScroll.x})},enable:function(){return k._invoke("enable")},disable:function(){return k._invoke("disable")},destroy:function(){return k._invoke("destroy")},extendFn:function(a,b){return j[a]=b},_invoke:function(a){var b;return b=c.extend({},h.vertical,h.horizontal),c.each(b,function(b,c){return c[a](),!0})},_filter:function(a,b,d){var f,g;return(f=m[c(a).data("waypoints-context-id")],!f)?[]:(g=[],c.each(f.waypoints[b],function(a,b){if(d(f,b))return g.push(b)}),g.sort(function(a,b){return a.offset-
b.offset}),c.map(g,function(a){return a.element}))}},c.waypoints=function(){var a,c;return c=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],k[c]?k[c].apply(null,a):k.aggregate.call(null,c)},c.waypoints.settings={resizeThrottle:100,scrollThrottle:30},f.load(function(){return c.waypoints("refresh")})};"function"==typeof define&&define.amd?define("waypoints",["jquery"],function(a){return d(a,c)}):d(c.jQuery,c)}).call(this);
var ImageEditor=function(){this.window=this.toolbar=this.panel=this.editor=null;this.__constructor=function(){var a=this,b=config.presets,c;this.editor=new editor({container:config.container,width:config.width,height:config.height});this.window=new imageEditor.uiWindowElement({shapes:imageEditor.SHAPES,editor:this.editor});this.panel=new imageEditor.uiPanelElement({settings:imageEditor.SETTINGS,editor:this.editor,window:this.window});this.toolbar=new imageEditor.uiToolbarElement({panel:this.panel,
editor:this.editor,window:this.window});this.editor.on("deselect-all",function(){a.panel.close();a.toolbar.update()});this.editor.on("item-selected",function(b){a.toolbar.update(b.type)});"undefined"!==typeof localStorage.editor&&(c=JSON.parse(localStorage.editor),0<c.length&&(b=c));this.editor.loadConfig(b)};this.__constructor()};
