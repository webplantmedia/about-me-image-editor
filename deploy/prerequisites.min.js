/*
 Generated by CoffeeScript 1.6.1 Caman.js  Modernizr 2.6.2 (Custom Build) | MIT & BSD
 Build: http://modernizr.com/download/#-csstransforms-csstransitions-touch-shiv-cssclasses-prefixed-teststyles-testprop-testallprops-prefixes-domprefixes-load
 tipsy, facebook style tooltips for jquery
 version 1.0.0a
 (c) 2008-2010 jason frame [jason@onehackoranother.com]
 released under the MIT license  Lazy Load 1.9.3 - MIT license - Copyright 2010-2013 Mika Tuupola 
 jQuery ClassyNotty
 www.class.pm
 Written by Marius Stanciu - Sergiu <marius@picozu.com>
 Licensed under the MIT license www.class.pm/LICENSE
 Version 1.1.2
 jQuery Spectrum 
 jQuery Hotkeys Plugin
 Copyright 2010, John Resig
 Dual licensed under the MIT or GPL Version 2 licenses.
 iScroll v5.1.1 ~ (c) 2008-2014 Matteo Spinelli ~ http://cubiq.org/license  jQuery noUISlider */
(function(){var d,a,b,c,f,e,h,g,j,k,n,l,r,s,p,u,q,v,B,F={}.hasOwnProperty,x=[].indexOf||function(w){for(var a=0,b=this.length;a<b;a++)if(a in this&&this[a]===w)return a;return-1},G=[].slice;v=Array.prototype.slice;d=function(w,a){null==a&&(a=document);return"object"===typeof w||"undefined"!==typeof exports&&null!==exports?w:a.querySelector(w)};var E=function(){},z;z=0;E.uniqid={get:function(){return z++}};E.extend=function(w){var a,b,c,f,e,d;b=w;f=v.call(arguments,1);e=0;for(d=f.length;e<d;e++)for(c in a=
f[e],a)F.call(a,c)&&(b[c]=a[c]);return b};E.clampRGB=function(w){return 0>w?0:255<w?255:w};E.copyAttributes=function(w,a,b){var c,f,e,d,h;null==b&&(b={});e=w.attributes;h=[];c=0;for(f=e.length;c<f;c++)w=e[c],null!=b.except&&(d=w.nodeName,0<=x.call(b.except,d))||h.push(a.setAttribute(w.nodeName,w.nodeValue));return h};E.dataArray=function(w){null==w&&(w=0);return b.NodeJS||null!=window.Uint8Array?new Uint8Array(w):Array(w)};"undefined"!==typeof exports&&null!==exports?(p=exports,f=require("canvas"),
k=f.Image,h=require("fibers"),q=require("fs")):p=window;var m=function(){var w,b,c,f=this;if(0===arguments.length)throw"Invalid arguments";if(this instanceof m){this.finishInit=this.finishInit.bind(this);this.imageLoaded=this.imageLoaded.bind(this);w=arguments[0];if(!m.NodeJS&&(c=parseInt(m.getAttrId(w[0]),10),b="function"===typeof w[1]?w[1]:"function"===typeof w[2]?w[2]:function(){},!isNaN(c)&&u.has(c)))return u.execute(c,b);this.id=E.uniqid.get();this.initializedPixelData=this.originalPixelData=
null;this.cropCoordinates={x:0,y:0};this.resized=this.cropped=!1;this.pixelStack=[];this.layerStack=[];this.canvasQueue=[];this.currentLayer=null;this.scaled=!1;this.analyze=new a(this);this.renderer=new s(this);this.domIsLoaded(function(){f.parseArguments(w);return f.setup()});return this}return new m(arguments)};m.version={release:"4.1.1",date:"4/8/2013"};m.DEBUG=!1;m.NodeJS="undefined"!==typeof exports&&null!==exports;m.autoload=!m.NodeJS;m.allowRevert=!0;m.crossOrigin="anonymous";m.toString=function(){return"Version "+
m.version.release+", Released "+m.version.date};m.remoteProxy="";m.proxyParam="camanProxyUrl";m.getAttrId=function(w){if(m.NodeJS)return!0;"string"===typeof w&&(w=d(w));return!(null!=w&&null!=w.getAttribute)?null:w.getAttribute("data-caman-id")};m.prototype.domIsLoaded=function(w){var a=this;return m.NodeJS?setTimeout(function(){return w.call(a)},0):"complete"===document.readyState?(l.debug("DOM initialized"),setTimeout(function(){return w.call(a)},0)):document.addEventListener("readystatechange",
function(){if("complete"===document.readyState)return l.debug("DOM initialized"),w.call(a)},!1)};m.prototype.parseArguments=function(w){var a,b,c;if(0===w.length)throw"Invalid arguments given";this.imageUrl=this.initType=this.initObj=null;this.callback=function(){};this.setInitObject(w[0]);if(1!==w.length){switch(typeof w[1]){case "string":this.imageUrl=w[1];break;case "function":this.callback=w[1]}if(2!==w.length&&(this.callback=w[2],4===w.length)){b=w[4];c=[];for(a in b)F.call(b,a)&&(w=b[a],c.push(this.options[a]=
w));return c}}};m.prototype.setInitObject=function(w){if(m.NodeJS)this.initObj=w,this.initType="node";else{this.initObj="object"===typeof w?w:d(w);if(null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()}};m.prototype.setup=function(){switch(this.initType){case "node":return this.initNode();case "img":return this.initImage();case "canvas":return this.initCanvas()}};m.prototype.initNode=function(){var w=this;l.debug("Initializing for NodeJS");
this.image=new k;this.image.onload=function(){l.debug("Image loaded. Width = "+w.imageWidth()+", Height = "+w.imageHeight());w.canvas=new f(w.imageWidth(),w.imageHeight());return w.finishInit()};this.image.onerror=function(w){throw w;};return this.image.src=this.initObj};m.prototype.initImage=function(){this.image=this.initObj;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");E.copyAttributes(this.image,this.canvas,{except:["src"]});this.image.parentNode.replaceChild(this.canvas,
this.image);this.imageAdjustments();return this.waitForImageLoaded()};m.prototype.initCanvas=function(){this.canvas=this.initObj;this.context=this.canvas.getContext("2d");return null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()};m.prototype.imageAdjustments=function(){this.needsHiDPISwap()&&(l.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement());
if(j.isRemote(this.image))return this.image.src=j.proxyUrl(this.image.src),l.debug("Remote image detected, using URL = "+this.image.src)};m.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded};m.prototype.isImageLoaded=function(){return!this.image.complete||null!=this.image.naturalWidth&&0===this.image.naturalWidth?!1:!0};m.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth};m.prototype.imageHeight=
function(){return this.image.height||this.image.naturalHeight};m.prototype.imageLoaded=function(){l.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight());this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight());return this.finishInit()};m.prototype.finishInit=function(){var w,a,b,c,f;null==this.context&&(this.context=this.canvas.getContext("2d"));
this.originalWidth=this.preScaledWidth=this.width=this.canvas.width;this.originalHeight=this.preScaledHeight=this.height=this.canvas.height;this.hiDPIAdjustments();this.hasId()||this.assignId();null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight);this.reloadCanvasData();if(m.allowRevert){this.initializedPixelData=E.dataArray(this.pixelData.length);this.originalPixelData=E.dataArray(this.pixelData.length);f=this.pixelData;
w=b=0;for(c=f.length;b<c;w=++b)a=f[w],this.initializedPixelData[w]=a,this.originalPixelData[w]=a}this.dimensions={width:this.canvas.width,height:this.canvas.height};u.put(this.id,this);this.callback.call(this,this);return this.callback=function(){}};m.prototype.reloadCanvasData=function(){this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);return this.pixelData=this.imageData.data};m.prototype.resetOriginalPixelData=function(){var w,a,b,c,f;if(!m.allowRevert)throw"Revert disabled";
this.originalPixelData=E.dataArray(this.pixelData.length);c=this.pixelData;f=[];a=0;for(b=c.length;a<b;a++)w=c[a],f.push(this.originalPixelData.push(w));return f};m.prototype.hasId=function(){return null!=m.getAttrId(this.canvas)};m.prototype.assignId=function(){if(!m.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)};m.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")};m.prototype.hiDPIAdjustments=
function(){var w;if(!m.NodeJS&&!this.hiDPIDisabled()&&(w=this.hiDPIRatio(),1!==w))return l.debug("HiDPI ratio = "+w),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*w,this.canvas.height=this.preScaledHeight*w,this.canvas.style.width=""+this.preScaledWidth+"px",this.canvas.style.height=""+this.preScaledHeight+"px",this.context.scale(w,w),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=
this.canvas.height};m.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)};m.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio};m.prototype.needsHiDPISwap=function(){return this.hiDPIDisabled()||!this.hiDPICapable()?!1:null!==this.hiDPIReplacement()};
m.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")};m.prototype.replaceCanvas=function(w){var a;a=this.canvas;this.canvas=w;this.context=this.canvas.getContext("2d");a.parentNode.replaceChild(this.canvas,a);this.width=this.canvas.width;this.height=this.canvas.height;this.reloadCanvasData();return this.dimensions={width:this.canvas.width,height:this.canvas.height}};m.prototype.render=function(w){var a=this;null==w&&(w=function(){});e.trigger(this,
"renderStart");return this.renderer.execute(function(){a.context.putImageData(a.imageData,0,0);return w.call(a)})};m.prototype.revert=function(){var w,a,b,c,f;if(!m.allowRevert)throw"Revert disabled";f=this.originalVisiblePixels();w=b=0;for(c=f.length;b<c;w=++b)a=f[w],this.pixelData[w]=a;return this.context.putImageData(this.imageData,0,0)};m.prototype.reset=function(){var w,a,b,c,f,e,d,h,g;w=document.createElement("canvas");E.copyAttributes(this.canvas,w);w.width=this.originalWidth;w.height=this.originalHeight;
a=w.getContext("2d");c=a.getImageData(0,0,w.width,w.height);e=c.data;g=this.initializedPixelData;b=d=0;for(h=g.length;d<h;b=++d)f=g[b],e[b]=f;a.putImageData(c,0,0);this.cropCoordinates={x:0,y:0};this.resized=!1;return this.replaceCanvas(w)};m.prototype.originalVisiblePixels=function(){var w,a,b,c,f,e,d,h,g,q,j,k,v,l,n,p;if(!m.allowRevert)throw"Revert disabled";g=[];q=this.cropCoordinates.x;b=q+this.width;j=this.cropCoordinates.y;c=j+this.height;if(this.resized){w=document.createElement("canvas");
w.width=this.originalWidth;w.height=this.originalHeight;a=w.getContext("2d");e=a.getImageData(0,0,w.width,w.height);h=e.data;l=this.originalPixelData;f=k=0;for(v=l.length;k<v;f=++k)d=l[f],h[f]=d;a.putImageData(e,0,0);f=document.createElement("canvas");f.width=this.width;f.height=this.height;a=f.getContext("2d");a.drawImage(w,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height);h=a.getImageData(0,0,this.width,this.height).data;a=this.width}else h=this.originalPixelData,a=this.originalWidth;
f=e=0;for(d=h.length;e<d;f=e+=4)w=r.locationToCoordinates(f,a),q<=(n=w.x)&&n<b&&(j<=(p=w.y)&&p<c)&&g.push(h[f],h[f+1],h[f+2],h[f+3]);return g};m.prototype.process=function(w,a){this.renderer.add({type:g.Type.Single,name:w,processFn:a});return this};m.prototype.processKernel=function(w,a,b,c){var f,e,d;if(!b){f=e=b=0;for(d=a.length;0<=d?e<d:e>d;f=0<=d?++e:--e)b+=a[f]}this.renderer.add({type:g.Type.Kernel,name:w,adjust:a,divisor:b,bias:c||0});return this};m.prototype.processPlugin=function(w,a){this.renderer.add({type:g.Type.Plugin,
plugin:w,args:a});return this};m.prototype.newLayer=function(a){var b;b=new n(this);this.canvasQueue.push(b);this.renderer.add({type:g.Type.LayerDequeue});a.call(b);this.renderer.add({type:g.Type.LayerFinished});return this};m.prototype.executeLayer=function(a){return this.pushContext(a)};m.prototype.pushContext=function(a){this.layerStack.push(this.currentLayer);this.pixelStack.push(this.pixelData);this.currentLayer=a;return this.pixelData=a.pixelData};m.prototype.popContext=function(){this.pixelData=
this.pixelStack.pop();return this.currentLayer=this.layerStack.pop()};m.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()};p.Caman=b=m;p=function(a){this.c=a};p.prototype.calculateLevels=function(){var a,b,c,f;b={r:{},g:{},b:{}};for(a=c=0;255>=c;a=++c)b.r[a]=0,b.g[a]=0,b.b[a]=0;a=c=0;for(f=this.c.pixelData.length;c<f;a=c+=4)b.r[this.c.pixelData[a]]++,b.g[this.c.pixelData[a+1]]++,b.b[this.c.pixelData[a+2]]++;c=this.c.pixelData.length/4;for(a=f=0;255>=f;a=++f)b.r[a]/=c,
b.g[a]/=c,b.b[a]/=c;return b};a=p;b.DOMUpdated=function(){var a,b,f,e,d;b=document.querySelectorAll("img[data-caman]");if(0<b.length){d=[];f=0;for(e=b.length;f<e;f++)a=b[f],d.push(new c(a,function(){this.parse();return this.execute()}));return d}};b.autoload&&("complete"===document.readyState?b.DOMUpdated():document.addEventListener("DOMContentLoaded",b.DOMUpdated,!1));p=function(a,c){this.dataStr=a.getAttribute("data-caman");this.caman=b(a,c.bind(this))};p.prototype.parse=function(){var a,b,c,f,
e,d,h,g;this.ele=this.caman.canvas;f=RegExp("(\\w+)\\((.*?)\\)","g");e=this.dataStr.match(f);if(0<e.length){f=/(\w+)\((.*?)\)/;g=[];d=0;for(h=e.length;d<h;d++){b=e[d];a=b.match(f);b=a[1];a=a[2];b=new Function("return function() {        this."+b+"("+a+");      };");try{c=b(),g.push(c.call(this.caman))}catch(q){g.push(l.debug(q))}}return g}};p.prototype.execute=function(){var a;a=this.ele;return this.caman.render(function(){return a.parentNode.replaceChild(this.toImage(),a)})};c=p;var K=function(){};
K.blenders={};K.register=function(a,b){return this.blenders[a]=b};K.execute=function(a,b,c){return this.blenders[a](b,c)};b.Blender=K;var C=function(){};C.distance=function(a,b,c,f){return Math.sqrt(Math.pow(c-a,2)+Math.pow(f-b,2))};C.randomRange=function(a,b,c){null==c&&(c=!1);a+=Math.random()*(b-a);return c?a.toFixed(c):Math.round(a)};C.luminance=function(a){return 0.299*a.r+0.587*a.g+0.114*a.b};C.bezier=function(a,b,c,f,e,d){var h,g,q,j,k,v,l,n,p,m;p=a[0];a=a[1];q=b[0];v=b[1];h=c[0];j=c[1];k=f[0];
g=f[1];c={};b=parseInt(3*(q-p),10);q=3*(h-q)-b;h=k-p-b-q;k=3*(v-a);j=3*(j-v)-k;g=g-a-k-j;for(v=m=0;1E3>m;v=++m)l=v/1E3,v=Math.round(h*Math.pow(l,3)+q*Math.pow(l,2)+b*l+p),l=Math.round(g*Math.pow(l,3)+j*Math.pow(l,2)+k*l+a),e&&l<e?l=e:d&&l>d&&(l=d),c[v]=l;if(c.length<f[0]+1){v=p=0;for(b=f[0];0<=b?p<=b:p>=b;v=0<=b?++p:--p)if(null==c[v]){d=[v-1,c[v-1]];e=a=v;for(q=f[0];v<=q?a<=q:a>=q;e=v<=q?++a:--a)if(null!=c[e]){n=[e,c[e]];break}c[v]=d[1]+(n[1]-d[1])/(n[0]-d[0])*(v-d[0])}}null==c[f[0]]&&(c[f[0]]=c[f[0]-
1]);return c};b.Calculate=C;var y=function(){};y.hexToRGB=function(a){var b,c;"#"===a.charAt(0)&&(a=a.substr(1));c=parseInt(a.substr(0,2),16);b=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);return{r:c,g:b,b:a}};y.rgbToHSL=function(a,b,c){var f,e,d,h,g;"object"===typeof a&&(b=a.g,c=a.b,a=a.r);a/=255;b/=255;c/=255;h=Math.max(a,b,c);e=Math.min(a,b,c);d=(h+e)/2;h===e?e=g=0:(f=h-e,g=0.5<d?f/(2-h-e):f/(h+e),e=function(){switch(h){case a:return(b-c)/f+(b<c?6:0);case b:return(c-a)/f+2;case c:return(a-
b)/f+4}}(),e/=6);return{h:e,s:g,l:d}};y.hslToRGB=function(a,b,c){var f,e;"object"===typeof a&&(b=a.s,c=a.l,a=a.h);0===b?e=c=a=c:(b=0.5>c?c*(1+b):c+b-c*b,f=2*c-b,e=this.hueToRGB(f,b,a+1/3),c=this.hueToRGB(f,b,a),a=this.hueToRGB(f,b,a-1/3));return{r:255*e,g:255*c,b:255*a}};y.hueToRGB=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a};y.rgbToHSV=function(a,b,c){var f,e,d,h;a/=255;b/=255;c/=255;d=Math.max(a,b,c);e=Math.min(a,b,c);f=d-e;h=0===d?0:f/d;d===
e?e=0:(e=function(){switch(d){case a:return(b-c)/f+(b<c?6:0);case b:return(c-a)/f+2;case c:return(a-b)/f+4}}(),e/=6);return{h:e,s:h,v:d}};y.hsvToRGB=function(a,b,c){var f,e,d,h,g,q;h=Math.floor(6*a);e=6*a-h;a=c*(1-b);g=c*(1-e*b);b=c*(1-(1-e)*b);switch(h%6){case 0:q=c;d=b;f=a;break;case 1:q=g;d=c;f=a;break;case 2:q=a;d=c;f=b;break;case 3:q=a;d=g;f=c;break;case 4:q=b;d=a;f=c;break;case 5:q=c,d=a,f=g}return{r:255*q,g:255*d,b:255*f}};y.rgbToXYZ=function(a,b,c){a/=255;b/=255;c/=255;a=0.04045<a?Math.pow((a+
0.055)/1.055,2.4):a/12.92;b=0.04045<b?Math.pow((b+0.055)/1.055,2.4):b/12.92;c=0.04045<c?Math.pow((c+0.055)/1.055,2.4):c/12.92;return{x:100*(0.4124*a+0.3576*b+0.1805*c),y:100*(0.2126*a+0.7152*b+0.0722*c),z:100*(0.0193*a+0.1192*b+0.9505*c)}};y.xyzToRGB=function(a,b,c){var f,e;a/=100;b/=100;c/=100;e=3.2406*a+-1.5372*b+-0.4986*c;f=-0.9689*a+1.8758*b+0.0415*c;a=0.0557*a+-0.204*b+1.057*c;e=0.0031308<e?1.055*Math.pow(e,0.4166666667)-0.055:12.92*e;f=0.0031308<f?1.055*Math.pow(f,0.4166666667)-0.055:12.92*
f;a=0.0031308<a?1.055*Math.pow(a,0.4166666667)-0.055:12.92*a;return{r:255*e,g:255*f,b:255*a}};y.xyzToLab=function(a,b,c){"object"===typeof a&&(b=a.y,c=a.z,a=a.x);a/=95.047;b/=100;c/=108.883;a=0.008856451679<a?Math.pow(a,0.3333333333):7.787037037*a+0.1379310345;b=0.008856451679<b?Math.pow(b,0.3333333333):7.787037037*b+0.1379310345;c=0.008856451679<c?Math.pow(c,0.3333333333):7.787037037*c+0.1379310345;return{l:116*b-16,a:500*(a-b),b:200*(b-c)}};y.labToXYZ=function(a,b,c){"object"===typeof a&&(b=a.a,
c=a.b,a=a.l);a=(a+16)/116;b=a+b/500;c=a-c/200;return{x:95.047*(0.2068965517<b?b*b*b:0.1284185493*(b-0.1379310345)),y:100*(0.2068965517<a?a*a*a:0.1284185493*(a-0.1379310345)),z:108.883*(0.2068965517<c?c*c*c:0.1284185493*(c-0.1379310345))}};y.rgbToLab=function(a,b,c){"object"===typeof a&&(b=a.g,c=a.b,a=a.r);a=this.rgbToXYZ(a,b,c);return this.xyzToLab(a)};y.labToRGB=function(){};p=function(){};p.events={};p.types="processStart processComplete renderStart renderFinished blockStarted blockFinished".split(" ");
p.trigger=function(a,b,c){var f,e,d,h;if(this.events[b]&&this.events[b].length){d=this.events[b];h=[];f=0;for(e=d.length;f<e;f++)b=d[f],null===b.target||a.id===b.target.id?h.push(b.fn.call(a,c)):h.push(void 0);return h}};p.listen=function(a,b,c){var f;"string"===typeof a&&(f=a,c=b,a=null,b=f);if(0>x.call(this.types,b))return!1;this.events[b]||(this.events[b]=[]);this.events[b].push({target:a,fn:c});return!0};e=p;b.Event=e;p=function(){};p.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,
Plugin:6};p.register=function(a,c){return b.prototype[a]=c};b.Filter=g=p;p=function(){};p.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/;p.isRemote=function(a){return null==a||this.corsEnabled(a)?!1:this.isURLRemote(a.src)};p.corsEnabled=function(a){var b;return null!=a.crossOrigin&&("anonymous"===(b=a.crossOrigin.toLowerCase())||"use-credentials"===b)};p.isURLRemote=function(a){return(a=a.match(this.domainRegex))?a[1]!==document.domain:!1};p.remoteCheck=function(a){if(this.isURLRemote(a))if(b.remoteProxy.length)if(b.isURLRemote(b.remoteProxy))l.info("Cannot use a remote proxy for loading images.");
else return""+b.remoteProxy+"?camanProxyUrl="+encodeURIComponent(a);else l.info("Attempting to load a remote image without a configured proxy. URL: "+a)};p.proxyUrl=function(a){return""+b.remoteProxy+"?"+b.proxyParam+"="+encodeURIComponent(a)};p.useProxy=function(a){var b;b={ruby:"rb",python:"py",perl:"pl",javascript:"js"};a=a.toLowerCase();null!=b[a]&&(a=b[a]);return"proxies/caman_proxy."+a};b.IO=j=p;b.prototype.save=function(){return"undefined"!==typeof exports&&null!==exports?this.nodeSave.apply(this,
arguments):this.browserSave.apply(this,arguments)};b.prototype.browserSave=function(a){null==a&&(a="png");a=a.toLowerCase();a=this.toBase64(a).replace("image/"+a,"image/octet-stream");return document.location.href=a};b.prototype.nodeSave=function(a,b){var c;null==b&&(b=!0);try{if(c=q.statSync(a),c.isFile()&&!b)return!1}catch(f){l.debug("Creating output file "+a)}return q.writeFile(a,this.canvas.toBuffer(),function(){return l.debug("Finished writing to "+a)})};b.prototype.toImage=function(a){var b;
b=document.createElement("img");b.src=this.toBase64(a);b.width=this.dimensions.width;b.height=this.dimensions.height;window.devicePixelRatio&&(b.width/=window.devicePixelRatio,b.height/=window.devicePixelRatio);return b};b.prototype.toBase64=function(a){null==a&&(a="png");a=a.toLowerCase();return this.canvas.toDataURL("image/"+a)};p=function(a){this.filter=this.c=a;this.options={blendingMode:"normal",opacity:1};this.layerID=E.uniqid.get();this.canvas="undefined"!==typeof exports&&null!==exports?new f:
document.createElement("canvas");this.canvas.width=this.c.dimensions.width;this.canvas.height=this.c.dimensions.height;this.context=this.canvas.getContext("2d");this.context.createImageData(this.canvas.width,this.canvas.height);this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.pixelData=this.imageData.data};p.prototype.newLayer=function(a){return this.c.newLayer.call(this.c,a)};p.prototype.setBlendingMode=function(a){this.options.blendingMode=a;return this};p.prototype.opacity=
function(a){this.options.opacity=a/100;return this};p.prototype.copyParent=function(){var a,b,c,f;b=this.c.pixelData;a=c=0;for(f=this.c.pixelData.length;c<f;a=c+=4)this.pixelData[a]=b[a],this.pixelData[a+1]=b[a+1],this.pixelData[a+2]=b[a+2],this.pixelData[a+3]=b[a+3];return this};p.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)};p.prototype.overlayImage=function(a){"object"===typeof a?a=a.src:"string"===typeof a&&"#"===a[0]&&(a=d(a).src);if(!a)return this;this.c.renderer.renderQueue.push({type:g.Type.LoadOverlay,
src:a,layer:this});return this};p.prototype.applyToParent=function(){var a,b,c,f,e,d,h,g,q;c=this.c.pixelStack[this.c.pixelStack.length-1];b=this.c.pixelData;q=[];a=h=0;for(g=b.length;h<g;a=h+=4)d={r:c[a],g:c[a+1],b:c[a+2],a:c[a+3]},e={r:b[a],g:b[a+1],b:b[a+2],a:b[a+3]},f=K.execute(this.options.blendingMode,e,d),f.r=E.clampRGB(f.r),f.g=E.clampRGB(f.g),f.b=E.clampRGB(f.b),null==f.a&&(f.a=e.a),c[a]=d.r-(d.r-f.r)*this.options.opacity*(f.a/255),c[a+1]=d.g-(d.g-f.g)*this.options.opacity*(f.a/255),q.push(c[a+
2]=d.b-(d.b-f.b)*this.options.opacity*(f.a/255));return q};n=p;l=new function(){var a,c,f,e;e=["log","info","warn","error"];c=0;for(f=e.length;c<f;c++)a=e[c],this[a]=function(a){return function(){var c;c=1<=arguments.length?G.call(arguments,0):[];if(b.DEBUG)try{return console[a].apply(console,c)}catch(f){return console[a](c)}}}(a);this.debug=this.log};p=function(a){this.c=a;this.loc=0};p.coordinatesToLocation=function(a,b,c){return 4*(b*c+a)};p.locationToCoordinates=function(a,b){return{x:a%(4*b)/
4,y:Math.floor(a/(4*b))}};p.prototype.locationXY=function(){return{x:this.loc%(4*this.c.dimensions.width)/4,y:this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width))}};p.prototype.getPixelRelative=function(a,b){var c;c=this.loc+4*this.c.dimensions.width*-1*b+4*a;return c>this.c.pixelData.length||0>c?{r:0,g:0,b:0,a:0}:{r:this.c.pixelData[c],g:this.c.pixelData[c+1],b:this.c.pixelData[c+2],a:this.c.pixelData[c+3]}};p.prototype.putPixelRelative=function(a,b,c){if(!(newLoc>this.c.pixelData.length||
0>newLoc))return this.c.pixelData[newLoc]=c.r,this.c.pixelData[newLoc+1]=c.g,this.c.pixelData[newLoc+2]=c.b,this.c.pixelData[newLoc+3]=c.a,!0};p.prototype.getPixel=function(a,b){var c;c=this.coordinatesToLocation(a,b,this.width);return{r:this.c.pixelData[c],g:this.c.pixelData[c+1],b:this.c.pixelData[c+2],a:this.c.pixelData[c+3]}};p.prototype.putPixel=function(a,b,c){a=this.coordinatesToLocation(a,b,this.width);this.c.pixelData[a]=c.r;this.c.pixelData[a+1]=c.g;this.c.pixelData[a+2]=c.b;return this.c.pixelData[a+
3]=c.a};r=p;var D=function(){};D.plugins={};D.register=function(a,b){return this.plugins[a]=b};D.execute=function(a,b,c){return this.plugins[b].apply(a,c)};b.Plugin=D;p=b;var J=function(a){var b=this;this.c=a;this.processNext=function(){return J.prototype.processNext.apply(b,arguments)};this.renderQueue=[];this.modPixelData=null};J.Blocks=b.NodeJS?require("os").cpus().length:4;J.prototype.add=function(a){if(null!=a)return this.renderQueue.push(a)};J.prototype.processNext=function(){var a;if(0===this.renderQueue.length)return e.trigger(this,
"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;this.currentJob=this.renderQueue.shift();switch(this.currentJob.type){case g.Type.LayerDequeue:return a=this.c.canvasQueue.shift(),this.c.executeLayer(a),this.processNext();case g.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case g.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case g.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}};
J.prototype.execute=function(a){this.finishedFn=a;this.modPixelData=E.dataArray(this.c.pixelData.length);return this.processNext()};J.prototype.eachBlock=function(a){var c,f,e,d,g,q,j,k,v,l=this;this.blocksDone=0;g=this.c.pixelData.length;c=4*Math.floor(g/4/J.Blocks);g=c+4*(g/4%J.Blocks);v=[];d=j=0;for(k=J.Blocks;0<=k?j<k:j>k;d=0<=k?++j:--j)q=d*c,e=q+(d===J.Blocks-1?g:c),b.NodeJS?(f=h(function(){return a.call(l,d,q,e)}),f=f.run(),v.push(this.blockFinished(f))):v.push(setTimeout(function(b,c,f){return function(){return a.call(l,
b,c,f)}}(d,q,e),0));return v};J.prototype.executeFilter=function(){e.trigger(this.c,"processStart",this.currentJob);return this.currentJob.type===g.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)};J.prototype.executePlugin=function(){l.debug("Executing plugin "+this.currentJob.plugin);D.execute(this.c,this.currentJob.plugin,this.currentJob.args);l.debug("Plugin "+this.currentJob.plugin+" finished!");return this.processNext()};J.prototype.renderBlock=function(a,c,f){var d,
g,q,j;l.debug("Block #"+a+" - Filter: "+this.currentJob.name+", Start: "+c+", End: "+f);e.trigger(this.c,"blockStarted",{blockNum:a,totalBlocks:J.Blocks,startPixel:c,endPixel:f});d={r:0,g:0,b:0,a:0};g=new r(this.c);for(c=j=c;j<f;c=j+=4)g.loc=c,d.r=this.c.pixelData[c],d.g=this.c.pixelData[c+1],d.b=this.c.pixelData[c+2],d.a=this.c.pixelData[c+3],q=this.currentJob.processFn.call(g,d),null==q.a&&(q.a=d.a),this.c.pixelData[c]=E.clampRGB(q.r),this.c.pixelData[c+1]=E.clampRGB(q.g),this.c.pixelData[c+2]=
E.clampRGB(q.b),this.c.pixelData[c+3]=E.clampRGB(q.a);return b.NodeJS?h.yield(a):this.blockFinished(a)};J.prototype.renderKernel=function(a,c,f){var e,d,g,q,j,k,v,p,n,m,B,s;g=this.currentJob.bias;j=this.currentJob.divisor;n=this.c.pixelData.length;e=this.currentJob.adjust;d=Math.sqrt(e.length);p=[];l.debug("Rendering kernel - Filter: "+this.currentJob.name);c=Math.max(c,4*this.c.dimensions.width*((d-1)/2));f=Math.min(f,n-4*this.c.dimensions.width*((d-1)/2));d=(d-1)/2;n=new r(this.c);for(c=m=c;m<f;c=
m+=4){n.loc=c;q=0;for(k=B=-d;-d<=d?B<=d:B>=d;k=-d<=d?++B:--B)for(v=s=d;d<=-d?s<=-d:s>=-d;v=d<=-d?++s:--s)v=n.getPixelRelative(k,v),p[3*q]=v.r,p[3*q+1]=v.g,p[3*q+2]=v.b,q++;q=this.processKernel(e,p,j,g);this.modPixelData[c]=E.clampRGB(q.r);this.modPixelData[c+1]=E.clampRGB(q.g);this.modPixelData[c+2]=E.clampRGB(q.b);this.modPixelData[c+3]=this.c.pixelData[c+3]}return b.NodeJS?h.yield(a):this.blockFinished(a)};J.prototype.blockFinished=function(a){var b,c,f;0<=a&&l.debug("Block #"+a+" finished! Filter: "+
this.currentJob.name);this.blocksDone++;e.trigger(this.c,"blockFinished",{blockNum:a,blocksFinished:this.blocksDone,totalBlocks:J.Blocks});if(this.blocksDone===J.Blocks){if(this.currentJob.type===g.Type.Kernel){b=c=0;for(f=this.c.pixelData.length;0<=f?c<f:c>f;b=0<=f?++c:--c)this.c.pixelData[b]=this.modPixelData[b]}0<=a&&l.debug("Filter "+this.currentJob.name+" finished!");e.trigger(this.c,"processComplete",this.currentJob);return this.processNext()}};J.prototype.processKernel=function(a,b,c,f){var e,
d,h,g;d={r:0,g:0,b:0};e=h=0;for(g=a.length;0<=g?h<g:h>g;e=0<=g?++h:--h)d.r+=a[e]*b[3*e],d.g+=a[e]*b[3*e+1],d.b+=a[e]*b[3*e+2];d.r=d.r/c+f;d.g=d.g/c+f;d.b=d.b/c+f;return d};J.prototype.loadOverlay=function(a,b){var c,f,e=this;c=document.createElement("img");c.onload=function(){a.context.drawImage(c,0,0,e.c.dimensions.width,e.c.dimensions.height);a.imageData=a.context.getImageData(0,0,e.c.dimensions.width,e.c.dimensions.height);a.pixelData=a.imageData.data;e.c.pixelData=a.pixelData;return e.processNext()};
f=j.remoteCheck(b);return c.src=null!=f?f:b};p.Renderer=s=J;p=function(){};p.items={};p.has=function(a){return null!=this.items[a]};p.get=function(a){return this.items[a]};p.put=function(a,b){return this.items[a]=b};p.execute=function(a,b){var c=this;setTimeout(function(){return b.call(c.get(a),c.get(a))},0);return this.get(a)};p.flush=function(a){null==a&&(a=!1);return a?delete this.items[a]:this.items={}};b.Store=u=p;K.register("normal",function(a){return{r:a.r,g:a.g,b:a.b}});K.register("multiply",
function(a,b){return{r:a.r*b.r/255,g:a.g*b.g/255,b:a.b*b.b/255}});K.register("screen",function(a,b){return{r:255-(255-a.r)*(255-b.r)/255,g:255-(255-a.g)*(255-b.g)/255,b:255-(255-a.b)*(255-b.b)/255}});K.register("overlay",function(a,b){var c;c={};c.r=128<b.r?255-2*(255-a.r)*(255-b.r)/255:2*b.r*a.r/255;c.g=128<b.g?255-2*(255-a.g)*(255-b.g)/255:2*b.g*a.g/255;c.b=128<b.b?255-2*(255-a.b)*(255-b.b)/255:2*b.b*a.b/255;return c});K.register("difference",function(a,b){return{r:a.r-b.r,g:a.g-b.g,b:a.b-b.b}});
K.register("addition",function(a,b){return{r:b.r+a.r,g:b.g+a.g,b:b.b+a.b}});K.register("exclusion",function(a,b){return{r:128-2*(b.r-128)*(a.r-128)/255,g:128-2*(b.g-128)*(a.g-128)/255,b:128-2*(b.b-128)*(a.b-128)/255}});K.register("softLight",function(a,b){var c;c={};c.r=128<b.r?255-(255-b.r)*(255-(a.r-128))/255:b.r*(a.r+128)/255;c.g=128<b.g?255-(255-b.g)*(255-(a.g-128))/255:b.g*(a.g+128)/255;c.b=128<b.b?255-(255-b.b)*(255-(a.b-128))/255:b.b*(a.b+128)/255;return c});K.register("lighten",function(a,
b){return{r:b.r>a.r?b.r:a.r,g:b.g>a.g?b.g:a.g,b:b.b>a.b?b.b:a.b}});K.register("darken",function(a,b){return{r:b.r>a.r?a.r:b.r,g:b.g>a.g?a.g:b.g,b:b.b>a.b?a.b:b.b}});g.register("fillColor",function(){var a;a=1===arguments.length?y.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]};return this.process("fillColor",function(b){b.r=a.r;b.g=a.g;b.b=a.b;b.a=255;return b})});g.register("brightness",function(a){a=Math.floor(255*(a/100));return this.process("brightness",function(b){b.r+=
a;b.g+=a;b.b+=a;return b})});g.register("saturation",function(a){a*=-0.01;return this.process("saturation",function(b){var c;c=Math.max(b.r,b.g,b.b);b.r!==c&&(b.r+=(c-b.r)*a);b.g!==c&&(b.g+=(c-b.g)*a);b.b!==c&&(b.b+=(c-b.b)*a);return b})});g.register("vibrance",function(a){a*=-1;return this.process("vibrance",function(b){var c,f;f=Math.max(b.r,b.g,b.b);c=2*Math.abs(f-(b.r+b.g+b.b)/3)/255*a/100;b.r!==f&&(b.r+=(f-b.r)*c);b.g!==f&&(b.g+=(f-b.g)*c);b.b!==f&&(b.b+=(f-b.b)*c);return b})});g.register("greyscale",
function(){return this.process("greyscale",function(a){var b;b=C.luminance(a);a.r=b;a.g=b;a.b=b;return a})});g.register("contrast",function(a){a=Math.pow((a+100)/100,2);return this.process("contrast",function(b){b.r/=255;b.r-=0.5;b.r*=a;b.r+=0.5;b.r*=255;b.g/=255;b.g-=0.5;b.g*=a;b.g+=0.5;b.g*=255;b.b/=255;b.b-=0.5;b.b*=a;b.b+=0.5;b.b*=255;return b})});g.register("hue",function(a){return this.process("hue",function(b){var c,f;f=y.rgbToHSV(b.r,b.g,b.b);c=100*f.h;c+=Math.abs(a);c=c%100/100;f.h=c;c=y.hsvToRGB(f.h,
f.s,f.v);c.a=b.a;return c})});g.register("colorize",function(){var a,b;2===arguments.length?(b=y.hexToRGB(arguments[0]),a=arguments[1]):4===arguments.length&&(b={r:arguments[0],g:arguments[1],b:arguments[2]},a=arguments[3]);return this.process("colorize",function(c){c.r-=(c.r-b.r)*(a/100);c.g-=(c.g-b.g)*(a/100);c.b-=(c.b-b.b)*(a/100);return c})});g.register("invert",function(){return this.process("invert",function(a){a.r=255-a.r;a.g=255-a.g;a.b=255-a.b;return a})});g.register("sepia",function(a){null==
a&&(a=100);a/=100;return this.process("sepia",function(b){b.r=Math.min(255,b.r*(1-0.607*a)+b.g*0.769*a+b.b*0.189*a);b.g=Math.min(255,b.r*0.349*a+b.g*(1-0.314*a)+b.b*0.168*a);b.b=Math.min(255,b.r*0.272*a+b.g*0.534*a+b.b*(1-0.869*a));return b})});g.register("gamma",function(a){return this.process("gamma",function(b){b.r=255*Math.pow(b.r/255,a);b.g=255*Math.pow(b.g/255,a);b.b=255*Math.pow(b.b/255,a);return b})});g.register("noise",function(a){a=2.55*Math.abs(a);return this.process("noise",function(b){var c;
c=C.randomRange(-1*a,a);b.r+=c;b.g+=c;b.b+=c;return b})});g.register("clip",function(a){a=2.55*Math.abs(a);return this.process("clip",function(b){b.r>255-a?b.r=255:b.r<a&&(b.r=0);b.g>255-a?b.g=255:b.g<a&&(b.g=0);b.b>255-a?b.b=255:b.b<a&&(b.b=0);return b})});g.register("channels",function(a){var b,c;if("object"!==typeof a)return this;for(b in a)F.call(a,b)&&(c=a[b],0===c?delete a[b]:a[b]/=100);return 0===a.length?this:this.process("channels",function(b){null!=a.red&&(b.r=0<a.red?b.r+(255-b.r)*a.red:
b.r-b.r*Math.abs(a.red));null!=a.green&&(b.g=0<a.green?b.g+(255-b.g)*a.green:b.g-b.g*Math.abs(a.green));null!=a.blue&&(b.b=0<a.blue?b.b+(255-b.b)*a.blue:b.b-b.b*Math.abs(a.blue));return b})});g.register("curves",function(){var a,b,c,f,e,d,h;b=arguments[0];c=2<=arguments.length?G.call(arguments,1):[];"string"===typeof b&&(b=b.split(""));"v"===b[0]&&(b=["r","g","b"]);if(3>c.length||4<c.length)throw"Invalid number of arguments to curves filter";h=c[0];f=c[1];e=4===c.length?c[2]:c[1];c=c[c.length-1];
a=C.bezier(h,f,e,c,0,255);if(0<h[0]){d=f=0;for(e=h[0];0<=e?f<e:f>e;d=0<=e?++f:--f)a[d]=h[1]}if(255>c[0])for(d=h=f=c[0];255>=f?255>=h:255<=h;d=255>=f?++h:--h)a[d]=c[1];return this.process("curves",function(c){var f,e;d=f=0;for(e=b.length;0<=e?f<e:f>e;d=0<=e?++f:--f)c[b[d]]=a[c[b[d]]];return c})});g.register("exposure",function(a){var b,c;c=Math.abs(a)/100;b=[0,255*c];c=[255-255*c,255];0>a&&(b=b.reverse(),c=c.reverse());return this.curves("rgb",[0,0],b,c,[255,255])});b.Plugin.register("crop",function(a,
b,c,e){var d;null==c&&(c=0);null==e&&(e=0);"undefined"!==typeof exports&&null!==exports?d=new f(a,b):(d=document.createElement("canvas"),E.copyAttributes(this.canvas,d),d.width=a,d.height=b);d.getContext("2d").drawImage(this.canvas,c,e,a,b,0,0,a,b);this.cropCoordinates={x:c,y:e};this.cropped=!0;return this.replaceCanvas(d)});b.Plugin.register("resize",function(a){var b,c;null==a&&(a=null);if(null===a||null==a.width&&null==a.height)l.error("Invalid or missing dimensions given for resize");else return null==
a.width?a.width=this.canvas.width*a.height/this.canvas.height:null==a.height&&(a.height=this.canvas.height*a.width/this.canvas.width),"undefined"!==typeof exports&&null!==exports?b=new f(a.width,a.height):(b=document.createElement("canvas"),E.copyAttributes(this.canvas,b),b.width=a.width,b.height=a.height),c=b.getContext("2d"),c.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,a.width,a.height),this.resized=!0,this.replaceCanvas(b)});b.Filter.register("crop",function(){return this.processPlugin("crop",
Array.prototype.slice.call(arguments,0))});b.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))});b.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])});b.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])});b.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,
1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])});b.Filter.register("motionBlur",function(a){return this.processKernel("Motion Blur",0===a||180===a?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:0<a&&90>a||180<a&&270>a?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===a||270===a?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1])});b.Filter.register("sharpen",function(a){null==a&&(a=100);a/=100;return this.processKernel("Sharpen",
[0,-a,0,-a,4*a+1,-a,0,-a,0])});B={brightness:function(a,b,c){a.r-=a.r*b*c.strength;a.g-=a.g*b*c.strength;a.b-=a.b*b*c.strength;return a},gamma:function(a,b,c){a.r=255*Math.pow(a.r/255,Math.max(10*b*c.strength,1));a.g=255*Math.pow(a.g/255,Math.max(10*b*c.strength,1));a.b=255*Math.pow(a.b/255,Math.max(10*b*c.strength,1));return a},colorize:function(a,b,c){a.r-=(a.r-c.color.r)*b;a.g-=(a.g-c.color.g)*b;a.b-=(a.b-c.color.b)*b;return a}};g.register("vignette",function(a,b){var c,f,e;null==b&&(b=60);"string"===
typeof a&&"%"===a.substr(-1)&&(a=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(a.substr(0,a.length-1),10)/100):this.dimensions.height*(parseInt(a.substr(0,a.length-1),10)/100));b/=100;f=[this.dimensions.width/2,this.dimensions.height/2];e=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2))-a;c=C.bezier([0,1],[30,30],[70,60],[100,80]);return this.process("vignette",function(d){var h;h=this.locationXY();h=C.distance(h.x,h.y,f[0],f[1]);h>e&&(h=Math.max(1,c[Math.round(100*((h-
e)/a))]/10*b),d.r=255*Math.pow(d.r/255,h),d.g=255*Math.pow(d.g/255,h),d.b=255*Math.pow(d.b/255,h));return d})});g.register("rectangularVignette",function(a){var c,f,e,d;a=E.extend({strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},a);if(a.size)if("string"===typeof a.size)c=parseInt(a.size,10)/100,a.size={width:this.dimensions.width*c,height:this.dimensions.height*c};else if("object"===typeof a.size){d=["width","height"];f=0;for(e=d.length;f<e;f++)c=d[f],"string"===typeof a.size[c]&&
(a.size[c]=this.dimensions[c]*(parseInt(a.size[c],10)/100))}else"number"===a.size&&(c=a.size,a.size={width:c,height:c});else return this;"string"===typeof a.cornerRadius&&(a.cornerRadius=a.size.width/2*(parseInt(a.cornerRadius,10)/100));a.strength/=100;a.size.width=Math.floor(a.size.width);a.size.height=Math.floor(a.size.height);a.image={width:this.dimensions.width,height:this.dimensions.height};"colorize"===a.method&&"string"===typeof a.color&&(a.color=y.hexToRGB(a.color));a.coords={left:(this.dimensions.width-
a.size.width)/2,right:this.dimensions.width-a.coords.left,bottom:(this.dimensions.height-a.size.height)/2,top:this.dimensions.height-a.coords.bottom};a.corners=[{x:a.coords.left+a.cornerRadius,y:a.coords.top-a.cornerRadius},{x:a.coords.right-a.cornerRadius,y:a.coords.top-a.cornerRadius},{x:a.coords.right-a.cornerRadius,y:a.coords.bottom+a.cornerRadius},{x:a.coords.left+a.cornerRadius,y:a.coords.bottom+a.cornerRadius}];a.maxDist=C.distance(0,0,a.corners[3].x,a.corners[3].y)-a.cornerRadius;return this.process("rectangularVignette",
function(c){var f,e;e=this.locationXY();if(e.x>a.corners[0].x&&e.x<a.corners[1].x&&e.y>a.coords.bottom&&e.y<a.coords.top||e.x>a.coords.left&&e.x<a.coords.right&&e.y>a.corners[3].y&&e.y<a.corners[2].y)return c;e.x>a.corners[0].x&&e.x<a.corners[1].x&&e.y>a.coords.top?f=(e.y-a.coords.top)/a.maxDist:e.y>a.corners[2].y&&e.y<a.corners[1].y&&e.x>a.coords.right?f=(e.x-a.coords.right)/a.maxDist:e.x>a.corners[0].x&&e.x<a.corners[1].x&&e.y<a.coords.bottom?f=(a.coords.bottom-e.y)/a.maxDist:e.y>a.corners[2].y&&
e.y<a.corners[1].y&&e.x<a.coords.left?f=(a.coords.left-e.x)/a.maxDist:e.x<=a.corners[0].x&&e.y>=a.corners[0].y?(f=b.distance(e.x,e.y,a.corners[0].x,a.corners[0].y),f=(f-a.cornerRadius)/a.maxDist):e.x>=a.corners[1].x&&e.y>=a.corners[1].y?(f=b.distance(e.x,e.y,a.corners[1].x,a.corners[1].y),f=(f-a.cornerRadius)/a.maxDist):e.x>=a.corners[2].x&&e.y<=a.corners[2].y?(f=b.distance(e.x,e.y,a.corners[2].x,a.corners[2].y),f=(f-a.cornerRadius)/a.maxDist):e.x<=a.corners[3].x&&e.y<=a.corners[3].y&&(f=b.distance(e.x,
e.y,a.corners[3].x,a.corners[3].y),f=(f-a.cornerRadius)/a.maxDist);return 0>f?c:B[a.method](c,f,a)})});var A,M,O,I,R;I=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,
446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,
338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];R=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,
22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];M=function(a,b,c,e,d,h,g){var q,j,k;q="undefined"!==typeof exports&&null!==exports?new f:document.createElement("canvas");
q.width=a;q.height=b;j=c+0.5*Math.cos(d)*h;k=e+0.5*Math.sin(d)*h;c-=0.5*Math.cos(d)*h;e-=0.5*Math.sin(d)*h;q=q.getContext("2d");j=q.createLinearGradient(j,k,c,e);g?(j.addColorStop(0,"white"),j.addColorStop(0.5,"black"),j.addColorStop(1,"white")):(j.addColorStop(0,"white"),j.addColorStop(1,"black"));q.fillStyle=j;q.fillRect(0,0,a,b);return q.getImageData(0,0,a,b)};O=function(a,b,c,e,d,h){var g;g="undefined"!==typeof exports&&null!==exports?new f:document.createElement("canvas");g.width=a;g.height=
b;g=g.getContext("2d");c=g.createRadialGradient(c,e,d,c,e,h);c.addColorStop(1,"white");c.addColorStop(0,"black");g.fillStyle=c;g.fillRect(0,0,a,b);return g.getImageData(0,0,a,b)};A=function(){this.a=this.b=this.g=this.r=0;return this.next=null};b.Plugin.register("compoundBlur",function(a,b,c,f){var e,d,h,g,q,j,k,v,l,p,n,m,B,s,L,x,r,F,G,u,N,E,y,M,z,C,D,O,K,H,J,Z,U,$,Y;H=this.dimensions.width;p=this.dimensions.height;s=this.pixelData;E=a.data;K=H*p;q=K<<2;a=[];for(m=D=0;0<=q?D<q:D>q;m=0<=q?++D:--D)a[m]=
s[m];q=0;D=f;for(f-=1;0<=D--;)if(e=b+0.5|0,0!==e){256<e&&(e=256);j=e+e+1;J=H-1;n=p-1;g=e+1;O=g*(g+1)/2;C=new A;B=void 0;z=C;for(m=d=1;1<=j?d<j:d>j;m=1<=j?++d:--d)z=z.next=new A,m===g&&(B=z);z.next=C;$=U=0;j=I[e];M=R[e];for(Y=0;0<=p?Y<p:Y>p;0<=p?++Y:--Y){G=k=e=N=l=h=0;u=g*(F=a[U]);v=g*(r=a[U+1]);d=g*(x=a[U+2]);N+=O*F;l+=O*r;h+=O*x;z=C;for(m=0;0<=g?m<g:m>g;0<=g?++m:--m)z.r=F,z.g=r,z.b=x,z=z.next;for(m=Z=1;1<=g?Z<g:Z>g;m=1<=g?++Z:--Z)L=U+((J<m?J:m)<<2),N+=(z.r=F=a[L])*(y=g-m),l+=(z.g=r=a[L+1])*y,h+=
(z.b=x=a[L+2])*y,G+=F,k+=r,e+=x,z=z.next;m=C;z=B;for(Z=y=0;0<=H?y<H:y>H;Z=0<=H?++y:--y)a[U]=N*j>>M,a[U+1]=l*j>>M,a[U+2]=h*j>>M,N-=u,l-=v,h-=d,u-=m.r,v-=m.g,d-=m.b,L=$+((L=Z+g)<J?L:J)<<2,G+=m.r=a[L],k+=m.g=a[L+1],e+=m.b=a[L+2],N+=G,l+=k,h+=e,m=m.next,u+=F=z.r,v+=r=z.g,d+=x=z.b,G-=F,k-=r,e-=x,z=z.next,U+=4;$+=H}for(Z=J=0;0<=H?J<H:J>H;Z=0<=H?++J:--J){k=e=G=l=h=N=0;U=Z<<2;u=g*(F=a[U]);v=g*(r=a[U+1]);d=g*(x=a[U+2]);N+=O*F;l+=O*r;h+=O*x;z=C;for(m=0;0<=g?m<g:m>g;0<=g?++m:--m)z.r=F,z.g=r,z.b=x,z=z.next;$=
H;for(m=Y=1;1<=g?Y<g:Y>g;m=1<=g?++Y:--Y)U=$+Z<<2,N+=(z.r=F=a[U])*(y=g-m),l+=(z.g=r=a[U+1])*y,h+=(z.b=x=a[U+2])*y,G+=F,k+=r,e+=x,z=z.next,m<n&&($+=H);U=Z;m=C;z=B;for(x=$=0;0<=p?$<p:$>p;x=0<=p?++$:--$)L=U<<2,a[L]=N*j>>M,a[L+1]=l*j>>M,a[L+2]=h*j>>M,N-=u,l-=v,h-=d,u-=m.r,v-=m.g,d-=m.b,L=Z+((L=x+g)<n?L:n)*H<<2,N+=G+=m.r=a[L],l+=k+=m.g=a[L+1],h+=e+=m.b=a[L+2],m=m.next,u+=F=z.r,v+=r=z.g,d+=x=z.b,G-=F,k-=r,e-=x,z=z.next,U+=H}b*=c;for(m=K;-1<--m;)n=m<<2,B=(E[n+2]&255)/255*f,g=B|0,g===q?(g=256*(B-(B|0)),B=
256-g,s[n]=s[n]*B+a[n]*g>>8,s[n+1]=s[n+1]*B+a[n+1]*g>>8,s[n+2]=s[n+2]*B+a[n+2]*g>>8):g===q+1&&(s[n]=a[n],s[n+1]=a[n+1],s[n+2]=a[n+2]);q++}return this});b.Filter.register("tiltShift",function(a){var b;a=E.extend({center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},a);a.angle*=Math.PI/180;b=M(this.dimensions.width,this.dimensions.height,a.center.x,a.center.y,a.angle,a.focusWidth,!0);return this.processPlugin("compoundBlur",[b,
a.startRadius,a.radiusFactor,a.steps])});b.Filter.register("radialBlur",function(a){var b;a=E.extend({size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},a);a.radius||(a.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width);b=O(this.dimensions.width,this.dimensions.height,a.center.x,a.center.y,a.radius/2-a.size,a.radius/2);return this.processPlugin("compoundBlur",[b,a.startRadius,a.radiusFactor,
a.steps])});b.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])});b.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])});b.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])});b.Filter.register("posterize",function(a){var b,c;b=256/a;c=255/(a-1);return this.process("posterize",function(a){a.r=Math.floor(Math.floor(a.r/b)*c);a.g=Math.floor(Math.floor(a.g/
b)*c);a.b=Math.floor(Math.floor(a.b/b)*c);return a})});b.Filter.register("vintage",function(a){null==a&&(a=!0);this.greyscale();this.contrast(5);this.noise(3);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.87);if(a)return this.vignette("40%",30)});b.Filter.register("lomo",function(a){null==a&&(a=!0);this.brightness(15);this.exposure(15);this.curves("rgb",[0,0],[200,0],[155,255],[255,255]);this.saturation(-20);this.gamma(1.8);a&&this.vignette("50%",60);return this.brightness(5)});
b.Filter.register("clarity",function(a){null==a&&(a=!1);this.vibrance(20);this.curves("rgb",[5,0],[130,150],[190,220],[250,255]);this.sharpen(15);this.vignette("45%",20);a&&(this.greyscale(),this.contrast(4));return this});b.Filter.register("sinCity",function(){this.contrast(100);this.brightness(15);this.exposure(10);this.posterize(80);this.clip(30);return this.greyscale()});b.Filter.register("sunrise",function(){this.exposure(3.5);this.saturation(-5);this.vibrance(50);this.sepia(60);this.colorize("#e87b22",
10);this.channels({red:8,blue:8});this.contrast(5);this.gamma(1.2);return this.vignette("55%",25)});b.Filter.register("crossProcess",function(){this.exposure(5);this.colorize("#e87b22",4);this.sepia(20);this.channels({blue:8,red:3});this.curves("b",[0,0],[100,150],[180,180],[255,255]);this.contrast(15);this.vibrance(75);return this.gamma(1.6)});b.Filter.register("orangePeel",function(){this.curves("rgb",[0,0],[100,50],[140,200],[255,255]);this.vibrance(-30);this.saturation(-30);this.colorize("#ff9000",
30);this.contrast(-5);return this.gamma(1.4)});b.Filter.register("love",function(){this.brightness(5);this.exposure(8);this.contrast(4);this.colorize("#c42007",30);this.vibrance(50);return this.gamma(1.3)});b.Filter.register("grungy",function(){this.gamma(1.5);this.clip(25);this.saturation(-60);this.contrast(5);this.noise(5);return this.vignette("50%",30)});b.Filter.register("jarques",function(){this.saturation(-35);this.curves("b",[20,0],[90,120],[186,144],[255,230]);this.curves("r",[0,0],[144,90],
[138,120],[255,255]);this.curves("g",[10,0],[115,105],[148,100],[255,248]);this.curves("rgb",[0,0],[120,100],[128,140],[255,255]);return this.sharpen(20)});b.Filter.register("pinhole",function(){this.greyscale();this.sepia(10);this.exposure(10);this.contrast(15);return this.vignette("60%",35)});b.Filter.register("oldBoot",function(){this.saturation(-20);this.vibrance(-50);this.gamma(1.1);this.sepia(30);this.channels({red:-10,blue:5});this.curves("rgb",[0,0],[80,50],[128,230],[255,255]);return this.vignette("60%",
30)});b.Filter.register("glowingSun",function(a){null==a&&(a=!0);this.brightness(10);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.gamma(0.8);this.filter.contrast(50);return this.filter.exposure(10)});this.newLayer(function(){this.setBlendingMode("softLight");this.opacity(80);return this.fillColor("#f49600")});this.exposure(20);this.gamma(0.8);if(a)return this.vignette("45%",20)});b.Filter.register("hazyDays",function(){this.gamma(1.2);this.newLayer(function(){this.setBlendingMode("overlay");
this.opacity(60);this.copyParent();this.filter.channels({red:5});return this.filter.stackBlur(15)});this.newLayer(function(){this.setBlendingMode("addition");this.opacity(40);return this.fillColor("#6899ba")});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(35);this.copyParent();this.filter.brightness(40);this.filter.vibrance(40);this.filter.exposure(30);this.filter.contrast(15);this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]);this.filter.curves("g",[0,40],[128,
128],[128,128],[255,215]);this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]);return this.filter.stackBlur(5)});this.curves("r",[20,0],[128,158],[128,128],[235,255]);this.curves("g",[20,0],[128,128],[128,128],[235,255]);this.curves("b",[20,0],[128,108],[128,128],[235,255]);return this.vignette("45%",20)});b.Filter.register("herMajesty",function(){this.brightness(40);this.colorize("#ea1c5d",10);this.curves("b",[0,10],[128,180],[190,190],[255,255]);this.newLayer(function(){this.setBlendingMode("overlay");
this.opacity(50);this.copyParent();this.filter.gamma(0.7);return this.newLayer(function(){this.setBlendingMode("normal");this.opacity(60);return this.fillColor("#ea1c5d")})});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(60);this.copyParent();this.filter.saturation(50);this.filter.hue(90);return this.filter.contrast(10)});this.gamma(1.4);this.vibrance(-30);this.newLayer(function(){this.opacity(10);return this.fillColor("#e5f0ff")});return this});b.Filter.register("blackwhite",
function(){return this.saturation(-100)});b.Filter.register("nostalgia",function(){this.saturation(20);this.gamma(1.4);this.greyscale();this.contrast(5);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.8);this.contrast(5);this.exposure(10);this.newLayer(function(){this.setBlendingMode("overlay");this.copyParent();this.opacity(55);return this.filter.stackBlur(10)});return this.vignette("50%",30)});b.Filter.register("hemingway",function(){this.greyscale();this.contrast(10);this.gamma(0.9);
this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(40);this.copyParent();this.filter.exposure(15);this.filter.contrast(15);return this.filter.channels({green:10,red:5})});this.sepia(30);this.curves("rgb",[0,10],[120,90],[180,200],[235,255]);this.channels({red:5,green:-2});return this.exposure(15)});b.Filter.register("concentrate",function(){this.sharpen(40);this.saturation(-50);this.channels({red:3});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();
this.filter.sharpen(5);this.filter.contrast(50);this.filter.exposure(10);return this.filter.channels({blue:5})});return this.brightness(10)});var H,L,N;L=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,
271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,
367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];N=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,
22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];H=function(){this.a=this.b=this.g=this.r=0;return this.next=null};
b.Plugin.register("stackBlur",function(a){var b,c,f,e,d,h,g,q,j,k,v,l,m,n,p,B,s,x,r,F,G,u,E,y,z,A,M,C,I,D,O;if(!(isNaN(a)||1>a)){a|=0;n=this.pixelData;A=this.dimensions.width;g=this.dimensions.height;b=a+a+1;M=A-1;q=g-1;r=a+1;z=r*(r+1)/2;u=y=new H;for(j=c=1;1<=b?c<b:c>b;j=1<=b?++c:--c)u=u.next=new H,j===r&&(E=u);u.next=y;D=I=0;k=L[a];G=N[a];for(O=0;0<=g?O<g:O>g;0<=g?++O:--O){B=e=b=x=h=f=0;s=r*(p=n[I]);d=r*(m=n[I+1]);c=r*(l=n[I+2]);x+=z*p;h+=z*m;f+=z*l;u=y;for(C=0;0<=r?C<r:C>r;0<=r?++C:--C)u.r=p,u.g=
m,u.b=l,u=u.next;for(j=C=1;1<=r?C<r:C>r;j=1<=r?++C:--C)v=I+((M<j?M:j)<<2),x+=(u.r=p=n[v])*(F=r-j),h+=(u.g=m=n[v+1])*F,f+=(u.b=l=n[v+2])*F,B+=p,e+=m,b+=l,u=u.next;u=y;j=E;for(C=F=0;0<=A?F<A:F>A;C=0<=A?++F:--F)n[I]=x*k>>G,n[I+1]=h*k>>G,n[I+2]=f*k>>G,x-=s,h-=d,f-=c,s-=u.r,d-=u.g,c-=u.b,v=D+((v=C+a+1)<M?v:M)<<2,B+=u.r=n[v],e+=u.g=n[v+1],b+=u.b=n[v+2],x+=B,h+=e,f+=b,u=u.next,s+=p=j.r,d+=m=j.g,c+=l=j.b,B-=p,e-=m,b-=l,j=j.next,I+=4;D+=A}for(C=M=0;0<=A?M<A:M>A;C=0<=A?++M:--M){e=b=B=h=f=x=0;I=C<<2;s=r*(p=
n[I]);d=r*(m=n[I+1]);c=r*(l=n[I+2]);x+=z*p;h+=z*m;f+=z*l;u=y;for(v=0;0<=r?v<r:v>r;0<=r?++v:--v)u.r=p,u.g=m,u.b=l,u=u.next;v=A;for(j=D=1;1<=a?D<=a:D>=a;j=1<=a?++D:--D)I=v+C<<2,x+=(u.r=p=n[I])*(F=r-j),h+=(u.g=m=n[I+1])*F,f+=(u.b=l=n[I+2])*F,B+=p,e+=m,b+=l,u=u.next,j<q&&(v+=A);I=C;u=y;j=E;for(l=D=0;0<=g?D<g:D>g;l=0<=g?++D:--D)v=I<<2,n[v]=x*k>>G,n[v+1]=h*k>>G,n[v+2]=f*k>>G,x-=s,h-=d,f-=c,s-=u.r,d-=u.g,c-=u.b,v=C+((v=l+r)<q?v:q)*A<<2,x+=B+=u.r=n[v],h+=e+=u.g=n[v+1],f+=b+=u.b=n[v+2],u=u.next,s+=p=j.r,d+=
m=j.g,c+=l=j.b,B-=p,e-=m,b-=l,j=j.next,I+=A}return this}});b.Filter.register("stackBlur",function(a){return this.processPlugin("stackBlur",[a])});b.Filter.register("threshold",function(a){return this.process("threshold",function(b){0.2126*b.r+0.7152*b.g+0.0722*b.b<a?(b.r=0,b.g=0,b.b=0):(b.r=255,b.g=255,b.b=255);return b})})}).call(this);var Kinetic={};
!function(){var d=navigator.userAgent.toLowerCase(),d=/(chrome)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||0>d.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(d)||[];Kinetic={version:"5.0.1",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:{browser:d[1]||"",version:d[2]||"0"},Filters:{},Node:function(a){this._init(a)},
Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},Layer:function(a){this.___init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))},
_removeName:function(a,b){if(void 0!==a){var c=this.names[a];if(void 0!==c){for(var f=0;f<c.length;f++)c[f]._id===b&&c.splice(f,1);0===c.length&&delete this.names[a]}}}}}();(function(d,a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):d.returnExports=a()})(this,function(){return Kinetic});
!function(){Kinetic.Collection=function(){var a=[].slice.call(arguments),b=a.length,c=0;for(this.length=b;b>c;c++)this[c]=a[c];return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)};Kinetic.Collection.prototype.toArray=function(){var a,b=[],c=this.length;for(a=0;c>a;a++)b.push(this[a]);return b};Kinetic.Collection.toCollection=function(a){var b,c=new Kinetic.Collection,d=a.length;for(b=0;d>b;b++)c.push(a[b]);return c};
Kinetic.Collection.mapMethods=function(a){var b;a=a.prototype;for(b in a)!function(a){Kinetic.Collection.prototype[a]=function(){var b,c=this.length;args=[].slice.call(arguments);for(b=0;c>b;b++)this[b][a].apply(this[b],args);return this}}(b)};Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]};Kinetic.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b;this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(a,b){this.m[0]*=a;this.m[1]*=a;this.m[2]*=b;this.m[3]*=b},rotate:function(a){var b=
Math.cos(a);a=Math.sin(a);var c=this.m[1]*b+this.m[3]*a,d=this.m[0]*-a+this.m[2]*b,j=this.m[1]*-a+this.m[3]*b;this.m[0]=this.m[0]*b+this.m[2]*a;this.m[1]=c;this.m[2]=d;this.m[3]=j},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[1]+this.m[3]*b,d=this.m[2]+this.m[0]*a,j=this.m[3]+this.m[1]*a;this.m[0]+=this.m[2]*b;this.m[1]=c;this.m[2]=d;this.m[3]=j},multiply:function(a){var b=this.m[1]*a.m[0]+this.m[3]*a.m[1],c=this.m[0]*a.m[2]+this.m[2]*a.m[3],d=this.m[1]*
a.m[2]+this.m[3]*a.m[3],j=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],k=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=b;this.m[2]=c;this.m[3]=d;this.m[4]=j;this.m[5]=k},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=-this.m[1]*a,c=-this.m[2]*a,d=this.m[0]*a,j=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),k=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*a;this.m[1]=b;this.m[2]=c;this.m[3]=d;this.m[4]=j;this.m[5]=
k},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var c=this.m[0],d=this.m[1],j=this.m[2],k=this.m[4],d=(c*(b-this.m[5])-d*(a-k))/(c*this.m[3]-d*j);this.translate((a-k-j*d)/c,d)}};var d=Math.PI/180,a=180/Math.PI,b={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],
green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},c=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},_isFunction:function(a){return!(!a||!a.constructor||!a.call||!a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},_isNumber:function(a){return"[object Number]"==Object.prototype.toString.call(a)},_isString:function(a){return"[object String]"==
Object.prototype.toString.call(a)},_hasMethods:function(a){var b,c=[];for(b in a)this._isFunction(a[b])&&c.push(b);return 0<c.length},_isInDocument:function(a){for(;a=a.parentNode;)if(a==document)return!0;return!1},_simplifyArray:function(a){var b,c,d=[],j=a.length,k=Kinetic.Util;for(b=0;j>b;b++)c=a[b],k._isNumber(c)?c=Math.round(1E3*c)/1E3:k._isString(c)||(c=c.toString()),d.push(c);return d},_getImage:function(a,b){var c,d;a?this._isElement(a)?b(a):this._isString(a)?(c=new Image,c.onload=function(){b(c)},
c.src=a):a.data?(d=document.createElement("canvas"),d.width=a.width,d.height=a.height,_context=d.getContext("2d"),_context.putImageData(a,0,0),this._getImage(d.toDataURL(),b)):b(null):b(null)},_getRGBAString:function(a){return["rgba(",a.red||0,",",a.green||0,",",a.blue||0,",",a.alpha||1,")"].join("")},_rgbToHex:function(a,b,c){return(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace("#","");a=parseInt(a,16);return{r:255&a>>16,g:255&a>>8,b:255&a}},getRandomColor:function(){for(var a=
(16777215*Math.random()<<0).toString(16);6>a.length;)a="0"+a;return"#"+a},get:function(a,b){return void 0===a?b:a},getRGB:function(a){var e;return a in b?(e=b[a],{r:e[0],g:e[1],b:e[2]}):"#"===a[0]?this._hexToRgb(a.substring(1)):"rgb("===a.substr(0,4)?(e=c.exec(a.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var c=this._clone(b),d;for(d in a)c[d]=this._isObject(a[d])?this._merge(a[d],c[d]):a[d];return c},cloneObject:function(a){var b=
{},c;for(c in a)b[c]=this._isObject(a[c])?this._clone(a[c]):a[c];return b},cloneArray:function(a){return a.slice(0)},_degToRad:function(a){return a*d},_radToDeg:function(b){return b*a},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw Error("Kinetic error: "+a);},warn:function(a){window.console&&console.warn&&console.warn("Kinetic warning: "+a)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},addMethods:function(a,
b){for(var c in b)a.prototype[c]=b[c]},_getControlPoints:function(a,b,c,d,j,k,n){var l=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),r=Math.sqrt(Math.pow(j-c,2)+Math.pow(k-d,2)),s=n*l/(l+r);n=n*r/(l+r);return[c-s*(j-a),d-s*(k-b),c+n*(j-a),d+n*(k-b)]},_expandPoints:function(a,b){var c,d,j=a.length,k=[];for(c=2;j-2>c;c+=2)d=Kinetic.Util._getControlPoints(a[c-2],a[c-1],a[c],a[c+1],a[c+2],a[c+3],b),k.push(d[0]),k.push(d[1]),k.push(a[c]),k.push(a[c+1]),k.push(d[2]),k.push(d[3]);return k},_removeLastLetter:function(a){return a.substring(0,
a.length-1)}}}();
!function(){var d=document.createElement("canvas").getContext("2d"),a=(window.devicePixelRatio||1)/(d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1);Kinetic.Canvas=function(a){this.init(a)};Kinetic.Canvas.prototype={init:function(b){b=b||{};this.pixelRatio=b.pixelRatio||Kinetic.pixelRatio||a;this._canvas=document.createElement("canvas");this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=
0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio;this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio;this._canvas.style.height=
a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,c){this.setWidth(a);this.setHeight(c)},toDataURL:function(a,c){try{return this._canvas.toDataURL(a,c)}catch(f){try{return this._canvas.toDataURL()}catch(d){return Kinetic.Util.warn("Unable to get data URL. "+d.message),""}}}};Kinetic.SceneCanvas=function(a){a=a||{};var c=a.width||0,f=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.SceneContext(this);this.setSize(c,f)};Kinetic.SceneCanvas.prototype=
{setWidth:function(a){var c=this.pixelRatio,f=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a);f.scale(c,c)},setHeight:function(a){var c=this.pixelRatio,f=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a);f.scale(c,c)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(a){a=a||{};var c=a.width||0,f=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.HitContext(this);this.setSize(c,f)};Kinetic.Util.extend(Kinetic.HitCanvas,
Kinetic.Canvas)}();
!function(){var d="arc arcTo beginPath bezierCurveTo clearRect clip closePath createLinearGradient createPattern createRadialGradient drawImage fill fillText getImageData createImageData lineTo moveTo putImageData quadraticCurveTo rect restore rotate save scale setLineDash setTransform stroke strokeText transform translate".split(" ");Kinetic.Context=function(a){this.init(a)};Kinetic.Context.prototype={init:function(a){this.canvas=a;this._context=a._canvas.getContext("2d");Kinetic.enableTrace&&(this.traceArr=
[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){a.getFillEnabled()&&this._fill(a);a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(a){var b,c,f,d,h=this.traceArr,g=h.length,j="";for(b=0;g>b;b++)c=h[b],(f=c.method)?(d=c.args,j+=f,j+=a?"()":Kinetic.Util._isArray(d[0])?"(["+d.join(",")+"])":"("+d.join(",")+")"):(j+=c.property,a||(j+="="+c.val)),j+=";";return j},clearTrace:function(){this.traceArr=
[]},_trace:function(a){var b=this.traceArr;b.push(a);b.length>=Kinetic.traceArrMax&&b.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var b=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,b.getWidth(),b.getHeight())},_applyLineCap:function(a){(a=a.getLineCap())&&this.setAttr("lineCap",a)},_applyOpacity:function(a){a=a.getAbsoluteOpacity();1!==a&&
this.setAttr("globalAlpha",a)},_applyLineJoin:function(a){(a=a.getLineJoin())&&this.setAttr("lineJoin",a)},_applyTransform:function(a){var b,c=a.getTransformsEnabled();"all"===c?(b=a.getAbsoluteTransform().getMatrix(),this.transform(b[0],b[1],b[2],b[3],b[4],b[5])):"position"===c&&this.translate(a.getX(),a.getY())},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=
arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;return 2===a.length?this._context.createImageData(a[0],a[1]):1===a.length?this._context.createImageData(a[0]):void 0},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],
a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;
this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],
a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){this._context.rotate(arguments[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},
strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a,b,c=this,f=d.length,e=Kinetic.Util._simplifyArray,h=this.setAttr;for(a=0;f>a;a++)!function(a){var f,d=c[a];c[a]=function(){return b=e(Array.prototype.slice.call(arguments,0)),f=d.apply(c,arguments),c._trace({method:a,args:b}),
f}}(d[a]);c.setAttr=function(){h.apply(c,arguments);c._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)};Kinetic.SceneContext.prototype={_fillColor:function(a){var b=a.fill()||Kinetic.Util._getRGBAString({red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()});this.setAttr("fillStyle",b);a._fillFunc(this)},_fillPattern:function(a){var b=a.getFillPatternImage(),c=a.getFillPatternX(),f=a.getFillPatternY(),d=a.getFillPatternScale(),
h=a.getFillPatternRotation(),g=a.getFillPatternOffset();a=a.getFillPatternRepeat();(c||f)&&this.translate(c||0,f||0);h&&this.rotate(h);d&&this.scale(d.x,d.y);g&&this.translate(-1*g.x,-1*g.y);this.setAttr("fillStyle",this.createPattern(b,a||"repeat"));this.fill()},_fillLinearGradient:function(a){var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint();a=a.getFillLinearGradientColorStops();b=this.createLinearGradient(b.x,b.y,c.x,c.y);if(a){for(c=0;c<a.length;c+=2)b.addColorStop(a[c],
a[c+1]);this.setAttr("fillStyle",b);this.fill()}},_fillRadialGradient:function(a){var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),f=a.getFillRadialGradientStartRadius(),d=a.getFillRadialGradientEndRadius();a=a.getFillRadialGradientColorStops();b=this.createRadialGradient(b.x,b.y,f,c.x,c.y,d);for(c=0;c<a.length;c+=2)b.addColorStop(a[c],a[c+1]);this.setAttr("fillStyle",b);this.fill()},_fill:function(a){var b=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),c=a.getFillPatternImage(),
f=a.getFillLinearGradientColorStops(),d=a.getFillRadialGradientColorStops(),h=a.getFillPriority();b&&"color"===h?this._fillColor(a):c&&"pattern"===h?this._fillPattern(a):f&&"linear-gradient"===h?this._fillLinearGradient(a):d&&"radial-gradient"===h?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):f?this._fillLinearGradient(a):d&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.dash(),c=a.getStrokeScaleEnabled();a.hasStroke()&&(c||(this.save(),this.setTransform(1,0,0,
1,0,0)),this._applyLineCap(a),b&&a.dashEnabled()&&this.setLineDash(b),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||Kinetic.Util._getRGBAString({red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()})),a._strokeFunc(this),c||this.restore())},_applyShadow:function(a){var b=Kinetic.Util,c=a.getAbsoluteOpacity(),f=b.get(a.getShadowColor(),"black"),d=b.get(a.getShadowBlur(),5),h=b.get(a.getShadowOpacity(),0);a=b.get(a.getShadowOffset(),{x:0,
y:0});h&&this.setAttr("globalAlpha",h*c);this.setAttr("shadowColor",f);this.setAttr("shadowBlur",d);this.setAttr("shadowOffsetX",a.x);this.setAttr("shadowOffsetY",a.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)};Kinetic.HitContext.prototype={_fill:function(a){this.save();this.setAttr("fillStyle",a.colorKey);a._fillFuncHit(this);this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",
a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}();
!function(){Kinetic.Factory={addGetterSetter:function(d,a,b,c,f){this.addGetter(d,a,b);this.addSetter(d,a,c,f);this.addOverloadedGetterSetter(d,a)},addGetter:function(d,a,b){var c="get"+Kinetic.Util._capitalize(a);d.prototype[c]=function(){var c=this.attrs[a];return void 0===c?b:c}},addSetter:function(d,a,b,c){var f="set"+Kinetic.Util._capitalize(a);d.prototype[f]=function(d){return b&&(d=b.call(this,d)),this._setAttr(a,d),c&&c.call(this),this}},addComponentsGetterSetter:function(d,a,b,c,f){var e,
h,g=b.length,j=Kinetic.Util._capitalize,k="get"+j(a),n="set"+j(a);d.prototype[k]=function(){var c={};for(e=0;g>e;e++)h=b[e],c[h]=this.getAttr(a+j(h));return c};d.prototype[n]=function(b){var d,e=this.attrs[a];c&&(b=c.call(this,b));for(d in b)this._setAttr(a+j(d),b[d]);return this._fireChangeEvent(a,e,b),f&&f.call(this),this};this.addOverloadedGetterSetter(d,a)},addOverloadedGetterSetter:function(d,a){var b=Kinetic.Util._capitalize(a),c="set"+b,f="get"+b;d.prototype[a]=function(){return arguments.length?
(this[c](arguments[0]),this):this[f]()}},backCompat:function(d,a){for(var b in a)d.prototype[b]=d.prototype[a[b]]},afterSetFilter:function(){this._filterUpToDate=!1}};Kinetic.Validators={RGBComponent:function(d){return 255<d?255:0>d?0:Math.round(d)},alphaComponent:function(d){return 1<d?1:1E-4>d?1E-4:d}}}();
!function(){var d="Shape";Kinetic.Util.addMethods(Kinetic.Node,{_init:function(a){var b=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=!1;this.setAttrs(a);this.on("xChange.kinetic yChange.kinetic scaleXChange.kinetic scaleYChange.kinetic skewXChange.kinetic skewYChange.kinetic rotationChange.kinetic offsetXChange.kinetic offsetYChange.kinetic transformsEnabledChange.kinetic",function(){this._clearCache("transform");b._clearSelfAndDescendantCache("absoluteTransform")});
this.on("visibleChange.kinetic",function(){b._clearSelfAndDescendantCache("visible")});this.on("listeningChange.kinetic",function(){b._clearSelfAndDescendantCache("listening")});this.on("opacityChange.kinetic",function(){b._clearSelfAndDescendantCache("absoluteOpacity")})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,b){return void 0===this._cache[a]&&(this._cache[a]=b.call(this)),this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a);
this.children&&this.getChildren().each(function(b){b._clearSelfAndDescendantCache(a)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(a){var b,c=a||{};a=c.x||0;var d=c.y||0,e=c.width||this.width(),h=c.height||this.height(),c=c.drawBorder||!1,g=new Kinetic.SceneCanvas({pixelRatio:1,width:e,height:h}),j=new Kinetic.SceneCanvas({pixelRatio:1,width:e,height:h}),k=new Kinetic.HitCanvas({width:e,height:h}),n=this.transformsEnabled(),l=this.x(),r=this.y();
return this.clearCache(),this.transformsEnabled("position"),this.x(-1*a),this.y(-1*d),this.drawScene(g),this.drawHit(k),c&&(b=g.getContext(),b.save(),b.beginPath(),b.rect(0,0,e,h),b.closePath(),b.setAttr("strokeStyle","red"),b.setAttr("lineWidth",5),b.stroke(),b.restore()),this.x(l),this.y(r),this.transformsEnabled(n),this._cache.canvas={scene:g,filter:j,hit:k},this},_drawCachedSceneCanvas:function(a){a.save();a._applyTransform(this);a.drawImage(this._getCachedSceneCanvas()._canvas,0,0);a.restore()},
_getCachedSceneCanvas:function(){var a,b,c,d,e=this.filters(),h=this._cache.canvas,g=h.scene,h=h.filter,j=h.getContext();if(e){if(!this._filterUpToDate){try{a=e.length;j.clear();j.drawImage(g._canvas,0,0);b=j.getImageData(0,0,h.getWidth(),h.getHeight());for(c=0;a>c;c++)d=e[c],d.call(this,b),j.putImageData(b,0,0)}catch(k){Kinetic.Util.warn("Unable to apply filter. "+k.message)}this._filterUpToDate=!0}return h}return g},_drawCachedHitCanvas:function(a){var b=this._cache.canvas.hit;a.save();a._applyTransform(this);
a.drawImage(b._canvas,0,0);a.restore()},on:function(a,b){var c,d,e,h=a.split(" "),g=h.length;for(c=0;g>c;c++)d=h[c],e=d.split("."),d=e[0],e=e[1]||"",this.eventListeners[d]||(this.eventListeners[d]=[]),this.eventListeners[d].push({name:e,handler:b});return this},off:function(a){var b,c,d,e,h,g=a.split(" "),j=g.length;for(a=0;j>a;a++)if(c=g[a],d=c.split("."),e=d[0],h=d[1],e)this.eventListeners[e]&&this._off(e,h);else for(b in this.eventListeners)this._off(b,h);return this},remove:function(){var a=this.getParent();
return a&&a.children&&(a.children.splice(this.index,1),a._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache("stage"),this._clearSelfAndDescendantCache("absoluteTransform"),this._clearSelfAndDescendantCache("visible"),this._clearSelfAndDescendantCache("listening"),this._clearSelfAndDescendantCache("absoluteOpacity"),this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(a){var b="get"+Kinetic.Util._capitalize(a);
return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),b=new Kinetic.Collection;a;)b.push(a),a=a.getParent();return b},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,c;if(a)for(b in a)"children"===b||(c="set"+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[c])?this[c](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var a=
this.getListening(),b=this.getParent();return"inherit"===a?b?b.isListening():!0:a},isVisible:function(){return this._getCache("visible",this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return"inherit"===a?b?b.isVisible():!0:a},shouldDrawHit:function(){var a=this.getLayer();return a&&a.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||
0},getAbsoluteZIndex:function(){function a(k){b=[];c=k.length;for(f=0;c>f;f++)e=k[f],j++,e.nodeType!==d&&(b=b.concat(e.getChildren().toArray())),e._id===g._id&&(f=c);0<b.length&&b[0].getDepth()<=h&&a(b)}var b,c,f,e,h=this.getDepth(),g=this,j=0;return"Stage"!==g.nodeType&&a(g.getStage().getChildren()),j},getDepth:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},setPosition:function(a){return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},
getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,c=this.offset();return b.m=a.slice(),b.translate(c.x,c.y),b.getTranslation()},setAbsolutePosition:function(a){var b,c=this._clearTransform();return this.attrs.x=c.x,this.attrs.y=c.y,delete c.x,delete c.y,b=this.getAbsoluteTransform(),b.invert(),b.translate(a.x,a.y),a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y},this.setPosition({x:a.x,y:a.y}),this._setTransform(c),this},
_setTransform:function(a){for(var b in a)this.attrs[b]=a[b];this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform")},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,
this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"),a},move:function(a){var b=a.x;a=a.y;var c=this.getX(),d=this.getY();return void 0!==b&&(c+=b),void 0!==a&&(d+=a),this.setPosition({x:c,y:d}),this},_eachAncestorReverse:function(a,b){var c,d,e=[];c=this.getParent();for(b&&e.unshift(this);c;)e.unshift(c),c=c.parent;c=e.length;for(d=0;c>d;d++)a(e[d])},rotate:function(a){return this.setRotation(this.getRotation()+
a),this},moveToTop:function(){return this.parent.children.splice(this.index,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var a=this.index;return this.parent.getChildren().length-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):
!1},moveToBottom:function(){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){return this.parent.children.splice(this.index,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),
a},moveTo:function(a){return Kinetic.Node.prototype.remove.call(this),a.add(this),this},toObject:function(){var a,b,c,d,e=Kinetic.Util,h={},g=this.getAttrs();h.attrs={};for(a in g)b=g[a],e._isFunction(b)||e._isElement(b)||e._isObject(b)&&e._hasMethods(b)||(c=this[a],delete g[a],d=c?c.call(this):null,g[a]=b,d!==b&&(h.attrs[a]=b));return h.className=this.getClassName(),h},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();
return a?a.getLayer():null},getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():void 0},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(){return this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var a,b,c=new Kinetic.Transform;return this._eachAncestorReverse(function(d){a=d.transformsEnabled();b=d.getTransform();
"all"===a?c.multiply(b):"position"===a&&c.translate(d.x(),d.y())},!0),c},getTransform:function(){return this._getCache("transform",this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform,b=this.getX(),c=this.getY(),d=this.getRotation()*Math.PI/180,e=this.getScaleX(),h=this.getScaleY(),g=this.getSkewX(),j=this.getSkewY(),k=this.getOffsetX(),n=this.getOffsetY();return(0!==b||0!==c)&&a.translate(b,c),0!==d&&a.rotate(d),(0!==g||0!==j)&&a.skew(g,j),(1!==e||1!==h)&&a.scale(e,h),(0!==k||
0!==n)&&a.translate(-1*k,-1*n),a},clone:function(a){var b,c,d,e,h;c=this.getClassName();var g=new Kinetic[c](this.attrs);for(b in this.eventListeners){c=this.eventListeners[b];d=c.length;for(e=0;d>e;e++)h=c[e],0>h.name.indexOf("kinetic")&&(g.eventListeners[b]||(g.eventListeners[b]=[]),g.eventListeners[b].push(h))}return g.setAttrs(a),g},toDataURL:function(a){a=a||{};var b=a.mimeType||null,c=a.quality||null,d=this.getStage(),e=a.x||0,h=a.y||0;a=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||
(d?d.getWidth():0),height:a.height||this.getHeight()||(d?d.getHeight():0),pixelRatio:1});d=a.getContext();return d.save(),(e||h)&&d.translate(-1*e,-1*h),this.drawScene(a),d.restore(),a.toDataURL(b,c)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(a){return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||
0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,b){var c,d,e=this.eventListeners[a];for(c=0;c<e.length;c++)if(d=e[c].name,!("kinetic"===d&&"kinetic"!==b||b&&d!==b)){if(e.splice(c,1),0===e.length){delete this.eventListeners[a];break}c--}},_fireBeforeChangeEvent:function(a,b,c){this._fire(["before",Kinetic.Util._capitalize(a),"Change"].join(""),{oldVal:b,newVal:c})},_fireChangeEvent:function(a,
b,c){this._fire(a+"Change",{oldVal:b,newVal:c})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr("id",a),this},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr("name",a),this},setAttr:function(){var a=Array.prototype.slice.call(arguments),b=a[0],a=a[1],c=this["set"+Kinetic.Util._capitalize(b)];return Kinetic.Util._isFunction(c)?c.call(this,a):this._setAttr(b,a),this},_setAttr:function(a,
b){var c;void 0!==b&&(c=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_setComponentAttr:function(a,b,c){var d;void 0!==c&&(d=this.attrs[a],d||(this.attrs[a]=this.getAttr(a)),this.attrs[a][b]=c,this._fireChangeEvent(a,d,c))},_fireAndBubble:function(a,b,c){var f=!0;b&&this.nodeType===d&&(b.targetNode=this);"mouseenter"===a&&c&&this._id===c._id?f=!1:"mouseleave"===a&&c&&this._id===c._id&&(f=!1);f&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._fireAndBubble.call(this.parent,
a,b,c.parent):this._fireAndBubble.call(this.parent,a,b)))},_fire:function(a,b){var c,d=this.eventListeners[a];if(d)for(c=0;c<d.length;c++)d[c].handler.call(this,b)},draw:function(){return this.drawScene(),this.drawHit(),this}});Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)};Kinetic.Node._createNode=function(a,b){var c,d,e;c=Kinetic.Node.prototype.getClassName.call(a);var h=a.children;if(b&&(a.attrs.container=b),c=new Kinetic[c](a.attrs),h){d=h.length;for(e=0;d>e;e++)c.add(this._createNode(h[e]))}return c};
Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position");Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,"name");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id");Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",
0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",
0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0);Kinetic.Factory.addSetter(Kinetic.Node,"width",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(a){return this._filterUpToDate=!1,a});Kinetic.Factory.addGetterSetter(Kinetic.Node,
"visible","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all");Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Kinetic.Collection.mapMethods(Kinetic.Node)}();!function(){Kinetic.Filters.Grayscale=function(d){var a,b=d.data,c=b.length;for(d=0;c>d;d+=4)a=0.34*b[d]+0.5*b[d+1]+0.16*b[d+2],b[d]=a,b[d+1]=a,b[d+2]=a}}();
!function(){Kinetic.Filters.Brighten=function(d){var a=255*this.brightness(),b=d.data,c=b.length;for(d=0;c>d;d+=4)b[d]+=a,b[d+1]+=a,b[d+2]+=a};Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)}();!function(){Kinetic.Filters.Invert=function(d){var a=d.data,b=a.length;for(d=0;b>d;d+=4)a[d]=255-a[d],a[d+1]=255-a[d+1],a[d+2]=255-a[d+2]}}();
!function(){function d(){this.a=this.b=this.g=this.r=0;this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,
367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,
310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],b=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(c){var f=0|this.blurRadius();if(0<f){var e,h,g,j,k,n,l,r,s,p,u,q,v,B,F,x,G,E,z,m,K,C,y,D=c.data,J=c.width;c=c.height;
e=f+f+1;var A=J-1,M=c-1,O=f+1,I=O*(O+1)/2,R=new d,H=null,L=R;y=g=null;var N=a[f],w=b[f];for(g=1;e>g;g++)L=L.next=new d,g==O&&(H=L);L.next=R;for(h=n=k=0;c>h;h++){F=x=G=E=l=r=s=p=0;u=O*(z=D[k]);q=O*(m=D[k+1]);v=O*(K=D[k+2]);B=O*(C=D[k+3]);l+=I*z;r+=I*m;s+=I*K;p+=I*C;L=R;for(g=0;O>g;g++)L.r=z,L.g=m,L.b=K,L.a=C,L=L.next;for(g=1;O>g;g++)j=k+((g>A?A:g)<<2),l+=(L.r=z=D[j])*(y=O-g),r+=(L.g=m=D[j+1])*y,s+=(L.b=K=D[j+2])*y,p+=(L.a=C=D[j+3])*y,F+=z,x+=m,G+=K,E+=C,L=L.next;g=R;y=H;for(e=0;J>e;e++)D[k+3]=C=p*
N>>w,0!==C?(C=255/C,D[k]=(l*N>>w)*C,D[k+1]=(r*N>>w)*C,D[k+2]=(s*N>>w)*C):D[k]=D[k+1]=D[k+2]=0,l-=u,r-=q,s-=v,p-=B,u-=g.r,q-=g.g,v-=g.b,B-=g.a,j=n+((j=e+f+1)<A?j:A)<<2,F+=g.r=D[j],x+=g.g=D[j+1],G+=g.b=D[j+2],E+=g.a=D[j+3],l+=F,r+=x,s+=G,p+=E,g=g.next,u+=z=y.r,q+=m=y.g,v+=K=y.b,B+=C=y.a,F-=z,x-=m,G-=K,E-=C,y=y.next,k+=4;n+=J}for(e=0;J>e;e++){x=G=E=F=r=s=p=l=0;k=e<<2;u=O*(z=D[k]);q=O*(m=D[k+1]);v=O*(K=D[k+2]);B=O*(C=D[k+3]);l+=I*z;r+=I*m;s+=I*K;p+=I*C;L=R;for(g=0;O>g;g++)L.r=z,L.g=m,L.b=K,L.a=C,L=L.next;
j=J;for(g=1;f>=g;g++)k=j+e<<2,l+=(L.r=z=D[k])*(y=O-g),r+=(L.g=m=D[k+1])*y,s+=(L.b=K=D[k+2])*y,p+=(L.a=C=D[k+3])*y,F+=z,x+=m,G+=K,E+=C,L=L.next,M>g&&(j+=J);k=e;g=R;y=H;for(h=0;c>h;h++)j=k<<2,D[j+3]=C=p*N>>w,0<C?(C=255/C,D[j]=(l*N>>w)*C,D[j+1]=(r*N>>w)*C,D[j+2]=(s*N>>w)*C):D[j]=D[j+1]=D[j+2]=0,l-=u,r-=q,s-=v,p-=B,u-=g.r,q-=g.g,v-=g.b,B-=g.a,j=e+((j=h+O)<M?j:M)*J<<2,l+=F+=g.r=D[j],r+=x+=g.g=D[j+1],s+=G+=g.b=D[j+2],p+=E+=g.a=D[j+3],g=g.next,u+=z=y.r,q+=m=y.g,v+=K=y.b,B+=C=y.a,F-=z,x-=m,G-=K,E-=C,y=y.next,
k+=J}}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)}();
!function(){function d(a,c,d){c=4*(d*a.width+c);d=[];return d.push(a.data[c++],a.data[c++],a.data[c++],a.data[c++]),d}function a(a,c){return Math.sqrt(Math.pow(a[0]-c[0],2)+Math.pow(a[1]-c[1],2)+Math.pow(a[2]-c[2],2))}Kinetic.Filters.Mask=function(b){var c;c=this.threshold();var f=d(b,0,0),e=d(b,b.width-1,0),h=d(b,0,b.height-1),g=d(b,b.width-1,b.height-1);c=c||10;if(a(f,e)<c&&a(e,g)<c&&a(g,h)<c&&a(h,f)<c){f=[e,f,g,h];e=[0,0,0];for(h=0;h<f.length;h++)e[0]+=f[h][0],e[1]+=f[h][1],e[2]+=f[h][2];f=(e[0]/=
f.length,e[1]/=f.length,e[2]/=f.length,e);e=[];for(h=0;h<b.width*b.height;h++)g=a(f,[b.data[4*h],b.data[4*h+1],b.data[4*h+2]]),e[h]=c>g?0:255;c=e}else c=void 0;if(c){for(var f=b.width,e=b.height,h=[1,1,1,1,0,1,1,1,1],g=Math.round(Math.sqrt(h.length)),j=Math.floor(g/2),k=[],n=0;e>n;n++)for(var l=0;f>l;l++){for(var r=n*f+l,s=0,p=0;g>p;p++)for(var u=0;g>u;u++){var q=n+p-j,v=l+u-j;0<=q&&(e>q&&0<=v&&f>v)&&(s+=c[q*f+v]*h[p*g+u])}k[r]=2040===s?255:0}c=k;f=b.width;e=b.height;h=[1,1,1,1,1,1,1,1,1];g=Math.round(Math.sqrt(h.length));
j=Math.floor(g/2);k=[];for(n=0;e>n;n++)for(l=0;f>l;l++){r=n*f+l;for(p=s=0;g>p;p++)for(u=0;g>u;u++)q=n+p-j,v=l+u-j,0<=q&&(e>q&&0<=v&&f>v)&&(s+=c[q*f+v]*h[p*g+u]);k[r]=1020<=s?255:0}c=k;f=b.width;e=b.height;h=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];g=Math.round(Math.sqrt(h.length));j=Math.floor(g/2);k=[];for(n=0;e>n;n++)for(l=0;f>l;l++){r=n*f+l;for(p=s=0;g>p;p++)for(u=0;g>u;u++)q=n+p-j,v=l+u-j,0<=q&&(e>q&&0<=v&&f>v)&&(s+=c[q*f+v]*h[p*g+u]);k[r]=s}c=k;for(f=0;f<b.width*b.height;f++)b.data[4*f+3]=c[f]}return b};
Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.RGB=function(d){var a,b=d.data,c=b.length,f=this.red(),e=this.green(),h=this.blue();for(d=0;c>d;d+=4)a=(0.34*b[d]+0.5*b[d+1]+0.16*b[d+2])/255,b[d]=a*f,b[d+1]=a*e,b[d+2]=a*h,b[d+3]=b[d+3]};Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(d){return this._filterUpToDate=!1,255<d?255:0>d?0:Math.round(d)});Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(d){return this._filterUpToDate=!1,255<d?255:0>d?0:Math.round(d)});Kinetic.Factory.addGetterSetter(Kinetic.Node,
"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.HSV=function(d){var a,b,c,f,e;d=d.data;var h=d.length;a=this.value();var g=this.saturation(),j=Math.abs(this.hue()+360)%360;b=a*g*Math.cos(j*Math.PI/180);c=a*g*Math.sin(j*Math.PI/180);var g=0.299*a+0.701*b+0.167*c,j=0.587*a-0.587*b+0.33*c,k=0.114*a-0.114*b-0.497*c,n=0.299*a-0.299*b-0.328*c,l=0.587*a+0.413*b+0.035*c,r=0.114*a-0.114*b+0.293*c,s=0.299*a-0.3*b+1.25*c,p=0.587*a-0.586*b-1.05*c,u=0.114*a+0.886*b-0.2*c;for(a=0;h>a;a+=4)b=d[a+0],c=d[a+1],f=d[a+2],e=d[a+3],d[a+0]=
g*b+j*c+k*f,d[a+1]=n*b+l*c+r*f,d[a+2]=s*b+p*c+u*f,d[a+3]=e};Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",1,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",1,null,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.Emboss=function(d){var a=10*this.embossStrength(),b=255*this.embossWhiteLevel(),c=this.embossDirection(),f=this.embossBlend(),e=0,h=0,g=d.data,j=d.width;d=d.height;var k=4*j,n=d;switch(c){case "top-left":h=e=-1;break;case "top":e=-1;h=0;break;case "top-right":e=-1;h=1;break;case "right":e=0;h=1;break;case "bottom-right":h=e=1;break;case "bottom":e=1;h=0;break;case "bottom-left":e=1;h=-1;break;case "left":e=0,h=-1}do{var c=(n-1)*k,l=e;1>n+l&&(l=0);n+l>d&&(l=0);var l=4*(n-
1+l)*j,r=j;do{var s=c+4*(r-1),p=h;1>r+p&&(p=0);r+p>j&&(p=0);var p=l+4*(r-1+p),u=g[s+1]-g[p+1],q=g[s+2]-g[p+2],p=g[s]-g[p],v=0<p?p:-p,B=0<q?q:-q;((0<u?u:-u)>v&&(p=u),B>v&&(p=q),p*=a,f)?(u=g[s]+p,q=g[s+1]+p,p=g[s+2]+p,g[s]=255<u?255:0>u?0:u,g[s+1]=255<q?255:0>q?0:q,g[s+2]=255<p?255:0>p?0:p):(p=b-p,0>p?p=0:255<p&&(p=255),g[s]=g[s+1]=g[s+2]=p)}while(--r)}while(--n)};Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",0.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,
"embossWhiteLevel",0.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)}();
!function(){function d(a,b,c,d,e){var h;c-=b;e-=d;return 0===c?d+e/2:0===e?d:(h=(a-b)/c,e*h+d)}Kinetic.Filters.Enhance=function(a){var b,c=a.data,f=c.length,e=c[0],h=e,g=c[1],j=g,k=c[2],n=k,l=this.enhance();if(0!==l){for(a=0;f>a;a+=4)b=c[a+0],e>b?e=b:b>h&&(h=b),b=c[a+1],g>b?g=b:b>j&&(j=b),b=c[a+2],k>b?k=b:b>n&&(n=b);h===e&&(h=255,e=0);j===g&&(j=255,g=0);n===k&&(n=255,k=0);var r,s,p,u,q,v,B,F,x;0<l?(s=h+l*(255-h),p=e-l*(e-0),q=j+l*(255-j),v=g-l*(g-0),F=n+l*(255-n),x=k-l*(k-0)):(r=0.5*(h+e),s=h+l*(h-
r),p=e+l*(e-r),u=0.5*(j+g),q=j+l*(j-u),v=g+l*(g-u),B=0.5*(n+k),F=n+l*(n-B),x=k+l*(k-B));for(a=0;f>a;a+=4)c[a+0]=d(c[a+0],e,h,p,s),c[a+1]=d(c[a+1],g,j,v,q),c[a+2]=d(c[a+2],k,n,x,F)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.Posterize=function(d){var a;a=Math.round(254*this.levels())+1;d=d.data;var b=d.length,c=255/a;for(a=0;b>a;a+=1)d[a]=Math.floor(d[a]/c)*c};Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",0.5,null,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.Noise=function(d){var a;a=255*this.noise();d=d.data;var b=d.length,c=a/2;for(a=0;b>a;a+=4)d[a+0]+=c-2*c*Math.random(),d[a+1]+=c-2*c*Math.random(),d[a+2]+=c-2*c*Math.random()};Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",0.2,null,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.Pixelate=function(d){var a,b,c,f,e,h,g,j,k,n,l,r,s,p,u=Math.ceil(this.pixelSize()),q=d.width,v=d.height;d=d.data;var B=Math.ceil(q/u),F=Math.ceil(v/u);for(r=0;B>r;r+=1)for(s=0;F>s;s+=1){g=h=e=f=0;j=r*u;k=j+u;n=s*u;l=n+u;p=0;for(a=j;k>a;a+=1)if(!(a>=q))for(b=n;l>b;b+=1)b>=v||(c=4*(q*b+a),f+=d[c+0],e+=d[c+1],h+=d[c+2],g+=d[c+3],p+=1);f/=p;e/=p;h/=p;alphas=g/p;for(a=j;k>a;a+=1)if(!(a>=q))for(b=n;l>b;b+=1)b>=v||(c=4*(q*b+a),d[c+0]=f,d[c+1]=e,d[c+2]=h,d[c+3]=g)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,
"pixelSize",8,null,Kinetic.Factory.afterSetFilter)}();!function(){Kinetic.Filters.Threshold=function(d){var a=255*this.threshold(),b=d.data,c=b.length;for(d=0;c>d;d+=1)b[d]=b[d]<a?0:255};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0.5,null,Kinetic.Factory.afterSetFilter)}();
!function(){Kinetic.Filters.Sepia=function(d){var a,b,c,f,e,h,g,j=d.data,k=d.width,n=d.height,l=4*k;do{d=(n-1)*l;a=k;do b=d+4*(a-1),c=j[b],f=j[b+1],e=j[b+2],h=0.393*c+0.769*f+0.189*e,g=0.349*c+0.686*f+0.168*e,c=0.272*c+0.534*f+0.131*e,j[b]=255<h?255:h,j[b+1]=255<g?255:g,j[b+2]=255<c?255:c,j[b+3]=j[b+3];while(--a)}while(--n)}}();
!function(){Kinetic.Filters.Solarize=function(d){var a=d.data,b=d.width,c=4*b;d=d.height;do{var f=(d-1)*c,e=b;do{var h=f+4*(e-1),g=a[h],j=a[h+1],k=a[h+2];127<g&&(g=255-g);127<j&&(j=255-j);127<k&&(k=255-k);a[h]=g;a[h+1]=j;a[h+2]=k}while(--e)}while(--d)}}();
!function(){Kinetic.Filters.ColorFill=function(d){var a=this.getFilterColorFill(),a=Kinetic.Util.getRGB(a);d=d.data;for(var b=0;b<d.length;b+=4)d[b]=a.r,d[b+1]=a.g,d[b+2]=a.b};Kinetic.Factory.addGetterSetter(Kinetic.Node,"filterColorFill","#000000",null,Kinetic.Factory.afterSetFilter)}();
!function(){var d=document.createElement("canvas");Kinetic.Filters.Kaleidoscope=function(a){var b=a.width,c=a.height,f=Math.round(this.kaleidoscopePower()),e=Math.round(this.kaleidoscopeAngle()),h=Math.floor(b*(e%360)/360);if(!(1>f)){d.width=b;d.height=c;var e=d.getContext("2d").getImageData(0,0,b,c),g,j,k,n=a.data,l=e.data,r=a.width,s=a.height,p=b/2||r/2,u=c/2||s/2,q=0,v=0,B=0,F=0,x=Math.sqrt(p*p+u*u);j=r-p;g=s-u;k=Math.sqrt(j*j+g*g);var x=k>x?k:x,G,E,z,m,K,C,y,D,J,A,M,O=360/r*Math.PI/180;for(G=
0;r>G;G+=1){E=Math.sin(G*O);z=Math.cos(G*O);for(k=0;s>k;k+=1)j=p+x*k/s*z,g=u+x*k/s*E,1>=j&&(j=1),j>=r-0.5&&(j=r-1),1>=g&&(g=1),g>=s-0.5&&(g=s-1),m=j-0.5,j+=0.5,K=Math.floor(m),C=Math.floor(j),y=g-0.5,D=g+0.5,J=Math.floor(y),A=Math.floor(D),M=(1-(m-K))*(1-(y-J)),g=4*(J*r+K),q=n[g+0]*M,v=n[g+1]*M,B=n[g+2]*M,F=n[g+3]*M,M=(1-(m-K))*(D-A),g=4*(A*r+K),q+=n[g+0]*M,v+=n[g+1]*M,B+=n[g+2]*M,F+=n[g+3]*M,M=(j-C)*(D-A),g=4*(A*r+C),q+=n[g+0]*M,v+=n[g+1]*M,B+=n[g+2]*M,F+=n[g+3]*M,M=(j-C)*(1-(y-J)),g=4*(J*r+C),q+=
n[g+0]*M,v+=n[g+1]*M,B+=n[g+2]*M,F+=n[g+3]*M,g=4*(G+k*r),l[g+0]=q,l[g+1]=v,l[g+2]=B,l[g+3]=F}for(n=b/Math.pow(2,f);8>=n;)n*=2,f-=1;s=n=Math.ceil(n);p=0;u=s;x=1;h+n>b&&(p=s,u=0,x=-1);for(r=0;c>r;r+=1)for(l=p;l!==u;l+=x)s=Math.round(l+h)%b,z=4*(b*r+s),k=e.data[z+0],G=e.data[z+1],E=e.data[z+2],z=e.data[z+3],m=4*(b*r+l),e.data[m+0]=k,e.data[m+1]=G,e.data[m+2]=E,e.data[m+3]=z;for(r=0;c>r;r+=1){s=Math.floor(n);for(h=0;f>h;h+=1){for(l=0;s+1>l;l+=1)z=4*(b*r+l),k=e.data[z+0],G=e.data[z+1],E=e.data[z+2],z=
e.data[z+3],m=4*(b*r+2*s-l-1),e.data[m+0]=k,e.data[m+1]=G,e.data[m+2]=E,e.data[m+3]=z;s*=2}}s={polarRotation:0};b=e.data;a=a.data;c=e.width;e=e.height;f=s.polarCenterX||c/2;h=s.polarCenterY||e/2;G=k=x=u=0;n=Math.sqrt(f*f+h*h);l=c-f;r=e-h;l=Math.sqrt(l*l+r*r);n=l>n?l:n;s=s.polarRotation||0;180*(c/360)/Math.PI;for(l=0;c>l;l+=1)for(r=0;e>r;r+=1)p=l-f,x=r-h,u=Math.sqrt(p*p+x*x)*e/n,x=(180*Math.atan2(x,p)/Math.PI+360+s)%360,x=x*c/360,p=x-0.5,E=x+0.5,z=Math.floor(p),m=Math.floor(E),O=u-0.5,K=u+0.5,C=Math.floor(O),
y=Math.floor(K),g=(1-(p-z))*(1-(O-C)),j=4*(C*c+z),u=b[j+0]*g,x=b[j+1]*g,k=b[j+2]*g,G=b[j+3]*g,g=(1-(p-z))*(K-y),j=4*(y*c+z),u+=b[j+0]*g,x+=b[j+1]*g,k+=b[j+2]*g,G+=b[j+3]*g,g=(E-m)*(K-y),j=4*(y*c+m),u+=b[j+0]*g,x+=b[j+1]*g,k+=b[j+2]*g,G+=b[j+3]*g,g=(E-m)*(1-(O-C)),j=4*(C*c+m),u+=b[j+0]*g,x+=b[j+1]*g,k+=b[j+2]*g,G+=b[j+3]*g,j=4*(r*c+l),a[j+0]=u,a[j+1]=x,a[j+2]=k,a[j+3]=G}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,
"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)}();
!function(){function d(a){window.setTimeout(a,1E3/60)}Kinetic.Animation=function(a,b){this.func=a;this.setLayers(b);this.id=Kinetic.Animation.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}};Kinetic.Animation.prototype={setLayers:function(a){var b=[];this.layers=b=a?0<a.length?a:[a]:[]},getLayers:function(){return this.layers},addLayer:function(a){var b,d,h=this.layers;if(h){b=h.length;for(d=0;b>d;d++)if(h[d]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),
!0},isRunning:function(){for(var a=Kinetic.Animation.animations,b=0;b<a.length;b++)if(a[b].id===this.id)return!0;return!1},start:function(){this.stop();this.frame.timeDiff=0;this.frame.lastTime=(new Date).getTime();Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime;this.frame.lastTime=a;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1E3/this.frame.timeDiff}};Kinetic.Animation.animations=
[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=!1;Kinetic.Animation._addAnimation=function(a){this.animations.push(a);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(a){a=a.id;for(var b=this.animations,d=b.length,h=0;d>h;h++)if(b[h].id===a){this.animations.splice(h,1);break}};Kinetic.Animation._runFrames=function(){var a,b,d,h,g,j,k,n,l={},r=this.animations;for(h=0;h<r.length;h++){a=r[h];b=a.layers;d=a.func;a._updateFrameObject((new Date).getTime());j=b.length;
for(g=0;j>g;g++)k=b[g],void 0!==k._id&&(l[k._id]=k);d&&d.call(a,a.frame)}for(n in l)l[n].draw()};Kinetic.Animation._animationLoop=function(){var a=this;0<this.animations.length?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){a._animationLoop()})):this.animRunning=!1};Kinetic.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||d;Kinetic.Animation.requestAnimFrame=function(b){(Kinetic.isDragging?d:a)(b)};var b=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){b.call(this,a)};Kinetic.Layer.prototype.batchDraw=function(){var a=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){a.lastBatchDrawTime&&500<(new Date).getTime()-a.lastBatchDrawTime&&a.batchAnim.stop()},this));this.lastBatchDrawTime=(new Date).getTime();this.batchAnim.isRunning()||(this.draw(),
this.batchAnim.start())};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}();
!function(){var d={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=0;Kinetic.Tween=function(c){var f,e=this,h=c.node,g=h._id,j=c.duration||1,k=c.easing||Kinetic.Easings.Linear,n=!!c.yoyo;this.node=h;this._id=a++;this.anim=new Kinetic.Animation(function(){e.tween.onEnterFrame()},h.getLayer()||h.getLayers());this.tween=new b(f,function(a){e._tweenFunc(a)},k,0,1,1E3*j,n);this._addListeners();Kinetic.Tween.attrs[g]||(Kinetic.Tween.attrs[g]={});Kinetic.Tween.attrs[g][this._id]||(Kinetic.Tween.attrs[g][this._id]=
{});Kinetic.Tween.tweens[g]||(Kinetic.Tween.tweens[g]={});for(f in c)void 0===d[f]&&this._addAttr(f,c[f]);this.reset();this.onFinish=c.onFinish;this.onReset=c.onReset};Kinetic.Tween.attrs={};Kinetic.Tween.tweens={};Kinetic.Tween.prototype={_addAttr:function(a,b){var d,h,g,j;d=this.node;var k=d._id;if(h=Kinetic.Tween.tweens[k][a],h&&delete Kinetic.Tween.attrs[k][h][a],d=d.getAttr(a),Kinetic.Util._isArray(b)){h=[];j=b.length;for(g=0;j>g;g++)h.push(b[g]-d[g])}else h=b-d;Kinetic.Tween.attrs[k][this._id][a]=
{start:d,diff:h};Kinetic.Tween.tweens[k][a]=this._id},_tweenFunc:function(a){var b,d,h,g,j,k,n,l=this.node,r=Kinetic.Tween.attrs[l._id][this._id];for(b in r){if(d=r[b],h=d.start,g=d.diff,Kinetic.Util._isArray(h)){j=[];n=h.length;for(k=0;n>k;k++)j.push(h[k]+g[k]*a)}else j=h+g*a;l.setAttr(b,j)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()};this.tween.onReverse=function(){a.anim.start()};this.tween.onPause=function(){a.anim.stop()};this.tween.onFinish=function(){a.onFinish&&
a.onFinish()};this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var a=this.node;return this.tween.reset(),(a.getLayer()||a.getLayers()).draw(),this},seek:function(a){var b=this.node;return this.tween.seek(1E3*a),(b.getLayer()||b.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var a=this.node;return this.tween.finish(),(a.getLayer()||
a.getLayers()).draw(),this},destroy:function(){var a,b=this.node._id,d=this._id,h=Kinetic.Tween.tweens[b];this.pause();for(a in h)delete Kinetic.Tween.tweens[b][a];delete Kinetic.Tween.attrs[b][d]}};var b=function(a,b,d,h,g,j,k){this.prop=a;this.propFunc=b;this._pos=this.begin=h;this.duration=j;this.prevPos=this._change=0;this.yoyo=k;this._finish=this._startTime=this._position=this._time=0;this.func=d;this._change=g-this.begin;this.pause()};b.prototype={fire:function(a){(a=this[a])&&a()},setTime:function(a){a>
this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos;this.propFunc(a);this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=2;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},
reverse:function(){this.state=3;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(a){this.pause();this._time=a;this.update();this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=
this.getTimer()-this._startTime;2===this.state?this.setTime(a):3===this.state&&this.setTime(this.duration-a)},pause:function(){this.state=1;this.fire("onPause")},getTimer:function(){return(new Date).getTime()}};Kinetic.Easings={BackEaseIn:function(a,b,d,h){return d*(a/=h)*a*(2.70158*a-1.70158)+b},BackEaseOut:function(a,b,d,h){return d*((a=a/h-1)*a*(2.70158*a+1.70158)+1)+b},BackEaseInOut:function(a,b,d,h){var g=1.70158;return 1>(a/=h/2)?d/2*a*a*(((g*=1.525)+1)*a-g)+b:d/2*((a-=2)*a*(((g*=1.525)+1)*
a+g)+2)+b},ElasticEaseIn:function(a,b,d,h,g,j){var k=0;return 0===a?b:1==(a/=h)?b+d:(j||(j=0.3*h),!g||g<Math.abs(d)?(g=d,k=j/4):k=j/(2*Math.PI)*Math.asin(d/g),-(g*Math.pow(2,10*(a-=1))*Math.sin(2*(a*h-k)*Math.PI/j))+b)},ElasticEaseOut:function(a,b,d,h,g,j){var k=0;return 0===a?b:1==(a/=h)?b+d:(j||(j=0.3*h),!g||g<Math.abs(d)?(g=d,k=j/4):k=j/(2*Math.PI)*Math.asin(d/g),g*Math.pow(2,-10*a)*Math.sin(2*(a*h-k)*Math.PI/j)+d+b)},ElasticEaseInOut:function(a,b,d,h,g,j){var k=0;return 0===a?b:2==(a/=h/2)?b+
d:(j||(j=1.5*0.3*h),!g||g<Math.abs(d)?(g=d,k=j/4):k=j/(2*Math.PI)*Math.asin(d/g),1>a?-0.5*g*Math.pow(2,10*(a-=1))*Math.sin(2*(a*h-k)*Math.PI/j)+b:0.5*g*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*h-k)*Math.PI/j)+d+b)},BounceEaseOut:function(a,b,d,h){return(a/=h)<1/2.75?7.5625*d*a*a+b:2/2.75>a?d*(7.5625*(a-=1.5/2.75)*a+0.75)+b:2.5/2.75>a?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},BounceEaseIn:function(a,b,d,h){return d-Kinetic.Easings.BounceEaseOut(h-a,0,d,h)+b},BounceEaseInOut:function(a,
b,d,h){return h/2>a?0.5*Kinetic.Easings.BounceEaseIn(2*a,0,d,h)+b:0.5*Kinetic.Easings.BounceEaseOut(2*a-h,0,d,h)+0.5*d+b},EaseIn:function(a,b,d,h){return d*(a/=h)*a+b},EaseOut:function(a,b,d,h){return-d*(a/=h)*(a-2)+b},EaseInOut:function(a,b,d,h){return 1>(a/=h/2)?d/2*a*a+b:-d/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,d,h){return d*(a/=h)*a*a*a*a+b},StrongEaseOut:function(a,b,d,h){return d*((a=a/h-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,d,h){return 1>(a/=h/2)?d/2*a*a*a*a*a+b:d/2*((a-=2)*
a*a*a*a+2)+b},Linear:function(a,b,d,h){return d*a/h+b}}}();
!function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var c=Kinetic.DD,d=c.node;d&&(d._setDragPosition(a),c.isDragging||(c.isDragging=!0,d.fire("dragstart",a,!0)),d.fire("dragmove",a,!0))},_endDragBefore:function(a){var c,d=Kinetic.DD,e=d.node;e&&(c=e.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=e)),delete d.node,(c||e).draw())},_endDragAfter:function(a){a=a||{};var c=a.dragEndNode;a&&c&&
c.fire("dragend",a,!0)}};Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,c=this.getStage(),d=this.getLayer(),c=c.getPointerPosition(),e=this.getAbsolutePosition();c&&(a.node&&a.node.stopDrag(),a.node=this,a.offset.x=c.x-e.x,a.offset.y=c.y-e.y,a.anim.setLayers(d||this.getLayers()),a.anim.start(),this._setDragPosition())};Kinetic.Node.prototype._setDragPosition=function(a){var c=Kinetic.DD,d=this.getStage().getPointerPosition(),e=this.getDragBoundFunc(),c={x:d.x-c.offset.x,y:d.y-c.offset.y};
void 0!==e&&(c=e.call(this,c,a));this.setAbsolutePosition(c)};Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,c={};a._endDragBefore(c);a._endDragAfter(c)};Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a);this._dragChange()};var d=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var a=Kinetic.DD;a.node&&a.node._id===this._id&&this.stopDrag();d.call(this)};Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===
this._id&&a.isDragging};Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup();"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(c){Kinetic.DD.node||a.startDrag(c)}):this.on("mousedown.kinetic touchstart.kinetic",function(c){Kinetic.DD.node||a.startDrag(c)})};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),c=Kinetic.DD;a&&c.node&&c.node._id===
this._id&&c.node.stopDrag()}};Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))};Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var a=document.documentElement;a.addEventListener("mouseup",Kinetic.DD._endDragBefore,
!0);a.addEventListener("touchend",Kinetic.DD._endDragBefore,!0);a.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1);a.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}();
!function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(d){this.children=new Kinetic.Collection;Kinetic.Node.call(this,d)},getChildren:function(){return this.children},hasChildren:function(){return 0<this.getChildren().length},removeChildren:function(){for(var d,a=this.children;0<a.length;)d=a[0],d.hasChildren()&&d.removeChildren(),d.remove();return this},destroyChildren:function(){for(var d=this.children;0<d.length;)d[0].destroy();return this},add:function(d){var a=this.children;return this._validateAdd(d),
d.index=a.length,d.parent=this,a.push(d),this._fire("add",{child:d}),this},destroy:function(){this.hasChildren()&&this.destroyChildren();Kinetic.Node.prototype.destroy.call(this)},find:function(d){var a,b,c,f,e=[],h=d.replace(/ /g,"").split(","),g=h.length;for(d=0;g>d;d++)if(b=h[d],"#"===b.charAt(0))(a=this._getNodeById(b.slice(1)))&&e.push(a);else if("."===b.charAt(0))a=this._getNodesByName(b.slice(1)),e=e.concat(a);else{c=this.getChildren();f=c.length;for(a=0;f>a;a++)e=e.concat(c[a]._get(b))}return Kinetic.Collection.toCollection(e)},
_getNodeById:function(d){d=Kinetic.ids[d];return void 0!==d&&this.isAncestorOf(d)?d:null},_getNodesByName:function(d){return this._getDescendants(Kinetic.names[d]||[])},_get:function(d){for(var a=Kinetic.Node.prototype._get.call(this,d),b=this.getChildren(),c=b.length,f=0;c>f;f++)a=a.concat(b[f]._get(d));return a},toObject:function(){var d=Kinetic.Node.prototype.toObject.call(this);d.children=[];for(var a=this.getChildren(),b=a.length,c=0;b>c;c++)d.children.push(a[c].toObject());return d},_getDescendants:function(d){for(var a=
[],b=d.length,c=0;b>c;c++){var f=d[c];this.isAncestorOf(f)&&a.push(f)}return a},isAncestorOf:function(d){for(d=d.getParent();d;){if(d._id===this._id)return!0;d=d.getParent()}return!1},clone:function(d){var a=Kinetic.Node.prototype.clone.call(this,d);return this.getChildren().each(function(b){a.add(b.clone())}),a},getAllIntersections:function(d){var a=[];return this.find("Shape").each(function(b){b.isVisible()&&b.intersects(d)&&a.push(b)}),a},_setChildrenIndices:function(){this.children.each(function(d,
a){d.index=a})},drawScene:function(d){var a=this.getLayer(),a=(d=d||a&&a.getCanvas())&&d.getContext(),b=this._cache.canvas,b=b&&b.scene;return this.isVisible()&&(b?this._drawCachedSceneCanvas(a):this._drawChildren(d,"drawScene")),this},drawHit:function(d){var a=this.getLayer(),a=(d=d||a&&a.hitCanvas)&&d.getContext(),b=this._cache.canvas,b=b&&b.hit;return this.shouldDrawHit()&&(b?this._drawCachedHitCanvas(a):this._drawChildren(d,"drawHit")),this},_drawChildren:function(d,a){var b,c,f=d&&d.getContext(),
e=this.getClipWidth(),h=this.getClipHeight(),g=e&&h;g&&(b=this.getClipX(),c=this.getClipY(),f.save(),f._applyTransform(this),f.beginPath(),f.rect(b,c,e,h),f.clip(),f.reset());this.children.each(function(b){b[a](d)});g&&f.restore()}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX");
Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight");Kinetic.Collection.mapMethods(Kinetic.Container)}();
!function(){function d(a){a.fill()}function a(a){a.stroke()}function b(a){a.fill()}function c(a){a.stroke()}function f(){this._clearCache(e)}var e="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(e){this.nodeType="Shape";this._fillFunc=d;this._strokeFunc=a;this._fillFuncHit=b;this._strokeFuncHit=c;for(var g,j=Kinetic.shapes;!(g=Kinetic.Util.getRandomColor(),g&&!(g in j)););this.colorKey=g;j[g]=this;Kinetic.Node.call(this,e);this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChanged.kinetic",
f)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(e,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!(!this.getShadowColor()&&!this.getShadowBlur()&&!this.getShadowOffsetX()&&!this.getShadowOffsetY())},hasFill:function(){return!(!this.getFill()&&!this.getFillPatternImage()&&
!this.getFillLinearGradientColorStops()&&!this.getFillRadialGradientColorStops())},hasStroke:function(){return!(!this.stroke()&&!this.strokeRed()&&!this.strokeGreen()&&!this.strokeBlue())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(a){var b,c=this.getStage().bufferHitCanvas;return c.getContext().clear(),this.drawScene(c),b=c.context.getImageData(0|a.x,0|a.y,1,1).data,0<b[3]},destroy:function(){Kinetic.Node.prototype.destroy.call(this);delete Kinetic.shapes[this.colorKey]},
_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(a){var b,c,d;a=(a||this.getLayer().getCanvas()).getContext();var e=this._cache.canvas,f=this.sceneFunc(),r=this.hasShadow();return this.isVisible()&&(e?this._drawCachedSceneCanvas(a):f&&(a.save(),this._useBufferCanvas()?(b=this.getStage(),c=b.bufferCanvas,d=c.getContext(),d.clear(),d.save(),d._applyLineJoin(this),d._applyTransform(this),f.call(this,d),d.restore(),
r&&(a.save(),a._applyShadow(this),a.drawImage(c._canvas,0,0),a.restore()),a._applyOpacity(this),a.drawImage(c._canvas,0,0)):(a._applyLineJoin(this),a._applyTransform(this),r&&(a.save(),a._applyShadow(this),f.call(this,a),a.restore()),a._applyOpacity(this),f.call(this,a)),a.restore())),this},drawHit:function(a){a=(a||this.getLayer().hitCanvas).getContext();var b=this.hitFunc()||this.sceneFunc(),c=this._cache.canvas,c=c&&c.hit;return this.shouldDrawHit()&&(c?this._drawCachedHitCanvas(a):b&&(a.save(),
a._applyLineJoin(this),a._applyTransform(this),b.call(this,a),a.restore())),this},drawHitFromCache:function(a){var b,c,d,e,f,r,s,p;a=a||0;var u=this._cache.canvas,q=this._getCachedSceneCanvas(),v=q.getContext(),u=u.hit.getContext(),B=q.getWidth(),q=q.getHeight();u.clear();try{b=v.getImageData(0,0,B,q);c=b.data;d=u.getImageData(0,0,B,q);e=d.data;f=c.length;r=Kinetic.Util._hexToRgb(this.colorKey);for(s=0;f>s;s+=4)p=c[s+3],p>a&&(e[s]=r.r,e[s+1]=r.g,e[s+2]=r.b,e[s+3]=255);u.putImageData(d,0,0)}catch(F){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+
F.message)}return this}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent);
Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent);
Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"shadowOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillPatternRepeat","repeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",
["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillLinearGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillRadialGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0);Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",
setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Kinetic.Collection.mapMethods(Kinetic.Shape)}();
!function(){function d(b,c){b.content.addEventListener(c,function(d){b[a+c](d)},!1)}var a="_",b="mousedown mousemove mouseup mouseout touchstart touchmove touchend mouseover".split(" "),c=b.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType="Stage";Kinetic.Container.call(this,a);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=!1;Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},
setContainer:function(a){return"string"===typeof a&&(a=document.getElementById(a)),this._setAttr("container",a),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a,b=this.children,c=b.length;for(a=0;c>a;a++)b[a].clear();return this},
destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this);a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(j){var k=r[j].toDataURL(),u=new Image;u.onload=function(){l.drawImage(u,0,0);j<r.length-1?b(j+1):a.callback(n.toDataURL(c,d))};u.src=k}a=a||{};var c=a.mimeType||null,d=a.quality||null,
j=a.x||0,k=a.y||0,n=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),l=n.getContext()._context,r=this.children;(j||k)&&l.translate(-1*j,-1*k);b(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})};this.toDataURL(a)},getIntersection:function(a){var b,c,d=this.getChildren();for(b=d.length-1;0<=b;b--)if(c=d[b].getIntersection(a))return c;return null},_resizeDOM:function(){if(this.content){var a,
b,c=this.getWidth(),d=this.getHeight(),j=this.getChildren(),k=j.length;this.content.style.width=c+"px";this.content.style.height=d+"px";this.bufferCanvas.setSize(c,d);this.bufferHitCanvas.setSize(c,d);for(a=0;k>a;a++)b=j[a],b.getCanvas().setSize(c,d),b.hitCanvas.setSize(c,d),b.draw()}},add:function(a){return Kinetic.Container.prototype.add.call(this,a),a.canvas.setSize(this.attrs.width,this.attrs.height),a.hitCanvas.setSize(this.attrs.width,this.attrs.height),a.draw(),this.content.appendChild(a.canvas._canvas),
this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){var a;for(a=0;c>a;a++)d(this,b[a])},_mouseover:function(a){this._fire("contentMouseover",a)},_mouseout:function(a){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble("mouseout",a),b._fireAndBubble("mouseleave",a),this.targetShape=null);this.pointerPos=void 0;this._fire("contentMouseout",a)},_mousemove:function(a){this._setPointerPosition(a);
var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===c._id?c._fireAndBubble("mousemove",a):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",a,c),this.targetShape._fireAndBubble("mouseleave",a,c)),c._fireAndBubble("mouseover",a,this.targetShape),c._fireAndBubble("mouseenter",a,this.targetShape),this.targetShape=c):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble("mouseout",
a),this.targetShape._fireAndBubble("mouseleave",a),this.targetShape=null);this._fire("contentMousemove",a);b&&b._drag(a);a.preventDefault&&a.preventDefault()},_mousedown:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble("mousedown",a));this._fire("contentMousedown",a);a.preventDefault&&a.preventDefault()},_mouseup:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),
c=this.clickStartShape,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&b.isListening()&&(b._fireAndBubble("mouseup",a),Kinetic.listenClickTap&&c&&c._id===b._id&&(b._fireAndBubble("click",a),d&&b._fireAndBubble("dblclick",a)));this._fire("contentMouseup",a);Kinetic.listenClickTap&&(this._fire("contentClick",a),d&&this._fire("contentDblclick",a));Kinetic.listenClickTap=!1;a.preventDefault&&
a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble("touchstart",a),b.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchstart",a)},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());fireDblClick=!1;Kinetic.inDblClickWindow?(fireDblClick=!0,Kinetic.inDblClickWindow=
!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&b.isListening()&&(b._fireAndBubble("touchend",a),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble("tap",a),fireDblClick&&b._fireAndBubble("dbltap",a)),b.isListening()&&a.preventDefault&&a.preventDefault());Kinetic.listenClickTap&&(this._fire("contentTouchend",a),fireDblClick&&this._fire("contentDbltap",a));Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);
var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()&&(c._fireAndBubble("touchmove",a),c.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchmove",a);b&&b._drag(a)},_setPointerPosition:function(a){var b;a=a?a:window.event;var c=this._getContentPosition(),d=a.offsetX,j=a.clientX,k=null,n=null;void 0!==a.touches?1===a.touches.length&&(b=a.touches[0],k=b.clientX-c.left,n=b.clientY-c.top):void 0!==d?(k=d,n=a.offsetY):"mozilla"===Kinetic.UA.browser?
(k=a.layerX,n=a.layerY):void 0!==j&&c&&(k=j-c.left,n=a.clientY-c.top);null!==k&&null!==n&&(this.pointerPos={x:k,y:n})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();a.innerHTML="";this.content=document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";
this.content.setAttribute("role","presentation");a.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new Kinetic.HitCanvas;this._resizeDOM()},_onContent:function(a,b){var c,d,j=a.split(" "),k=j.length;for(c=0;k>c;c++)d=j[c],this.content.addEventListener(d,b,!1)}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}();
!function(){var d=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],a=d.length;Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(a){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;this.hitCanvas=new Kinetic.HitCanvas;Kinetic.Container.call(this,a)},_validateAdd:function(a){a=a.getType();"Group"!==a&&"Shape"!==a&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(b){var c,f,e,h;if(!this.isVisible())return null;
for(f=0;a>f;f++){if(e=d[f],c=this._getIntersection({x:b.x+e.x,y:b.y+e.y}),h=c.shape)return h;if(!c.antialiased)return null}},_getIntersection:function(a){var c,d;a=this.hitCanvas.context._context.getImageData(a.x,a.y,1,1).data;var e=a[3];return 255===e?(c=Kinetic.Util._rgbToHex(a[0],a[1],a[2]),d=Kinetic.shapes["#"+c],{shape:d}):0<e?{antialiased:!0}:{}},drawScene:function(a){var c=this.getLayer();a=a||c&&c.getCanvas();return this._fire("beforeDraw",{node:this}),this.getClearBeforeDraw()&&a.getContext().clear(),
Kinetic.Container.prototype.drawScene.call(this,a),this._fire("draw",{node:this}),this},drawHit:function(a){var c=this.getLayer();a=a||c&&c.hitCanvas;return c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,a),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){var c=this.getContext(),d=this.getHitCanvas().getContext();
return c.clear(a),d.clear(a),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(a){Kinetic.Node.prototype.setZIndex.call(this,a);var c=this.getStage();return c&&(c.content.removeChild(this.getCanvas()._canvas),a<c.getChildren().length-1?c.content.insertBefore(this.getCanvas()._canvas,
c.getChildren()[a+1].getCanvas()._canvas):c.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,
a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var c=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);a.content.insertBefore(this.getCanvas()._canvas,c[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var c=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);
a.content.insertBefore(this.getCanvas()._canvas,c[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getStage(),c=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),a&&c&&Kinetic.Util._isInDocument(c)&&a.content.removeChild(c),this},getStage:function(){return this.parent},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this}});Kinetic.Util.extend(Kinetic.Layer,
Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0);Kinetic.Collection.mapMethods(Kinetic.Layer)}();
!function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(d){this.nodeType="Group";Kinetic.Container.call(this,d)},_validateAdd:function(d){d=d.getType();"Group"!==d&&"Shape"!==d&&Kinetic.Util.error("You may only add groups and shapes to groups.")}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container);Kinetic.Collection.mapMethods(Kinetic.Group)}();
!function(){Kinetic.Rect=function(d){this.___init(d)};Kinetic.Rect.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var a=this.getCornerRadius(),b=this.getWidth(),c=this.getHeight();d.beginPath();a?(d.moveTo(a,0),d.lineTo(b-a,0),d.arc(b-a,a,a,3*Math.PI/2,0,!1),d.lineTo(b,c-a),d.arc(b-a,c-a,a,0,Math.PI/2,!1),d.lineTo(a,c),d.arc(a,c-a,a,Math.PI/2,Math.PI,!1),d.lineTo(0,a),d.arc(a,a,a,Math.PI,3*Math.PI/2,!1)):d.rect(0,
0,b,c);d.closePath();d.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Rect)}();
!function(){var d=2*Math.PI-1E-4;Kinetic.Circle=function(a){this.___init(a)};Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Circle";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getRadius(),0,d,!1);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,
a);this.setRadius(a/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0);Kinetic.Collection.mapMethods(Kinetic.Circle)}();
!function(){var d=2*Math.PI-1E-4;Kinetic.Ellipse=function(a){this.___init(a)};Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ellipse";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getRadius(),c=b.x,b=b.y;a.beginPath();a.save();c!==b&&a.scale(1,b/c);a.arc(0,0,c,0,d,!1);a.restore();a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,
a);this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setRadius({y:a/2})}};Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0);Kinetic.Collection.mapMethods(Kinetic.Ellipse)}();
!function(){var d=2*Math.PI-1E-4;Kinetic.Ring=function(a){this.___init(a)};Kinetic.Ring.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ring";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getInnerRadius(),0,d,!1);a.moveTo(this.getOuterRadius(),0);a.arc(0,0,this.getOuterRadius(),d,0,!0);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,
a);this.setOuterRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setOuterRadius(a/2)}};Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Ring)}();
!function(){Kinetic.Wedge=function(d){this.___init(d)};Kinetic.Wedge.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Wedge";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){d.beginPath();d.arc(0,0,this.getRadius(),0,this.getAngle()*Math.PI/180,this.getClockwise());d.lineTo(0,0);d.closePath();d.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,
"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1);Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});Kinetic.Collection.mapMethods(Kinetic.Wedge)}();
!function(){Kinetic.Arc=function(d){this.___init(d)};Kinetic.Arc.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Arc";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var a=this.angle()*Math.PI/180,b=this.clockwise();d.beginPath();d.arc(0,0,this.getOuterRadius(),0,a,b);d.arc(0,0,this.getInnerRadius(),a,0,!b);d.closePath();d.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,
"outerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1);Kinetic.Collection.mapMethods(Kinetic.Arc)}();
!function(){Kinetic.Image=function(d){this.___init(d)};Kinetic.Image.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Image";this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(d){var a,b,c,f,e=this.getWidth(),h=this.getHeight(),g=this.getImage();g&&(a=this.getCrop(),b=a.width,c=a.height,f=b&&c?[g,a.x,a.y,b,c,0,0,e,h]:[g,0,0,e,h]);d.beginPath();
d.rect(0,0,e,h);d.closePath();d.fillStrokeShape(this);g&&d.drawImage.apply(d,f)},_hitFunc:function(d){var a=this.getWidth(),b=this.getHeight();d.beginPath();d.rect(0,0,a,b);d.closePath();d.fillStrokeShape(this)},getWidth:function(){var d=this.getImage();return this.attrs.width||(d?d.width:0)},getHeight:function(){var d=this.getImage();return this.attrs.height||(d?d.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,
"crop",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0);Kinetic.Collection.mapMethods(Kinetic.Image)}();
!function(){function d(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}var b="fontFamily fontSize fontStyle padding align lineHeight text width height wrap".split(" "),c=b.length,f=document.createElement("canvas").getContext("2d");Kinetic.Text=function(a){this.___init(a)};Kinetic.Text.prototype={___init:function(e){void 0===e.width&&(e.width="auto");void 0===e.height&&(e.height="auto");Kinetic.Shape.call(this,e);this._fillFunc=d;this._strokeFunc=a;this.className=
"Text";for(e=0;c>e;e++)this.on(b[e]+"Change.kinetic",this._setTextData);this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b,c=this.getPadding();b=this.getTextHeight();var d=this.getLineHeight()*b,f=this.textArr,n=f.length,l=this.getWidth();a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();a.translate(c,0);a.translate(0,c+b/2);for(b=0;n>b;b++){var r=f[b],s=r.text,r=r.width;a.save();
"right"===this.getAlign()?a.translate(l-r-2*c,0):"center"===this.getAlign()&&a.translate((l-r-2*c)/2,0);this.partialText=s;a.fillStrokeShape(this);a.restore();a.translate(0,d)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath();a.rect(0,0,b,c);a.closePath();a.fillStrokeShape(this)},setText:function(a){a=Kinetic.Util._isString(a)?a:a.toString();return this._setAttr("text",a),this},getWidth:function(){return"auto"===this.attrs.width?this.getTextWidth()+2*this.getPadding():
this.attrs.width},getHeight:function(){return"auto"===this.attrs.height?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b,c=this.getFontSize();return f.save(),f.font=this._getContextFont(),b=f.measureText(a),f.restore(),{width:b.width,height:parseInt(c,10)}},_getContextFont:function(){return this.getFontStyle()+" "+this.getFontSize()+
"px "+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return f.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),c=0,d=this.getLineHeight()*b,k=this.attrs.width,n=this.attrs.height,l="auto"!==k,r="auto"!==n,s=this.getPadding(),k=k-2*s,n=n-2*s,s=0,p=this.getWrap(),u="none"!==p,p="char"!==p&&u;this.textArr=[];f.save();f.font=this.getFontStyle()+" "+b+"px "+this.getFontFamily();for(var q=
0,v=a.length;v>q;++q){var B=a[q],F=this._getTextWidth(B);if(l&&F>k)for(;0<B.length;){for(var x=0,G=B.length,E="",z=0;G>x;){var m=x+G>>>1,K=B.slice(0,m+1),C=this._getTextWidth(K);k>=C?(x=m+1,E=K,z=C):G=m}if(!E)break;p&&(G=Math.max(E.lastIndexOf(" "),E.lastIndexOf("-"))+1,0<G&&(x=G,E=E.slice(0,x),z=this._getTextWidth(E)));if(this._addTextLine(E,z),s+=d,!u||r&&s+d>n)break;if(B=B.slice(x),0<B.length&&(F=this._getTextWidth(B),k>=F)){this._addTextLine(B,F);s+=d;break}}else this._addTextLine(B,F),s+=d,c=
Math.max(c,F);if(r&&s+d>n)break}f.restore();this.textHeight=b;this.textWidth=c}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,"align","left");Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1);
Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap","word");Kinetic.Factory.addGetter(Kinetic.Text,"text","");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text");Kinetic.Collection.mapMethods(Kinetic.Text)}();
!function(){Kinetic.Line=function(d){this.___init(d)};Kinetic.Line.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Line";this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var a,b,c,f=this.getPoints(),e=f.length;a=this.getTension();var h=this.getClosed();if(d.beginPath(),d.moveTo(f[0],f[1]),0!==a&&4<e){a=this.getTensionPoints();b=a.length;c=h?0:4;
for(h||d.quadraticCurveTo(a[0],a[1],a[2],a[3]);b-2>c;)d.bezierCurveTo(a[c++],a[c++],a[c++],a[c++],a[c++],a[c++]);h||d.quadraticCurveTo(a[b-2],a[b-1],f[e-2],f[e-1])}else for(c=2;e>c;c+=2)d.lineTo(f[c],f[c+1]);h?(d.closePath(),d.fillStrokeShape(this)):d.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},
_getTensionPointsClosed:function(){var d=this.getPoints(),a=d.length,b=this.getTension(),c=Kinetic.Util,f=c._getControlPoints(d[a-2],d[a-1],d[0],d[1],d[2],d[3],b),c=c._getControlPoints(d[a-4],d[a-3],d[a-2],d[a-1],d[0],d[1],b),b=Kinetic.Util._expandPoints(d,b);return[f[2],f[3]].concat(b).concat([c[0],c[1],d[a-2],d[a-1],c[2],c[3],f[0],f[1],d[0],d[1]])}};Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1);Kinetic.Factory.addGetterSetter(Kinetic.Line,
"tension",0);Kinetic.Factory.addGetterSetter(Kinetic.Line,"points");Kinetic.Collection.mapMethods(Kinetic.Line)}();
!function(){Kinetic.Sprite=function(d){this.___init(d)};Kinetic.Sprite.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Sprite";this.anim=new Kinetic.Animation;this.on("animationChange.kinetic",function(){this.frameIndex(0)});this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(d){var a=this.getAnimation(),b=4*this.frameIndex(),c=this.getAnimations()[a],a=c[b+0],f=c[b+1],e=c[b+2],b=c[b+3];(c=this.getImage())&&d.drawImage(c,a,f,e,b,0,0,e,b)},_hitFunc:function(d){var a=
this.getAnimation(),b=4*this.frameIndex(),c=this.getAnimations()[a],a=c[b+2],b=c[b+3];d.beginPath();d.rect(0,0,a,b);d.closePath();d.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var d=this,a=this.getLayer();this.anim.setLayers(a);this.interval=setInterval(function(){d._updateIndex()},1E3/this.getFrameRate());this.anim.start()},stop:function(){this.anim.stop();clearInterval(this.interval)},_updateIndex:function(){var d=
this.frameIndex(),a=this.getAnimation();this.getAnimations()[a].length/4-1>d?this.frameIndex(d+1):this.frameIndex(0)}};Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17);Kinetic.Factory.backCompat(Kinetic.Sprite,
{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});Kinetic.Collection.mapMethods(Kinetic.Sprite)}();
!function(){Kinetic.Path=function(d){this.___init(d)};Kinetic.Path.prototype={___init:function(d){this.dataArray=[];var a=this;Kinetic.Shape.call(this,d);this.className="Path";this.dataArray=Kinetic.Path.parsePathData(this.getData());this.on("dataChange.kinetic",function(){a.dataArray=Kinetic.Path.parsePathData(this.getData())});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var a=this.dataArray,b=!1;d.beginPath();for(var c=0;c<a.length;c++){var f=a[c].points;switch(a[c].command){case "L":d.lineTo(f[0],
f[1]);break;case "M":d.moveTo(f[0],f[1]);break;case "C":d.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case "Q":d.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case "A":var e=f[0],h=f[1],g=f[2],j=f[3],k=f[4],n=f[5],l=f[6],f=f[7],r=g>j?g:j,s=g>j?1:g/j,g=g>j?j/g:1;d.translate(e,h);d.rotate(l);d.scale(s,g);d.arc(0,0,r,k,k+n,1-f);d.scale(1/s,1/g);d.rotate(-l);d.translate(-e,-h);break;case "z":d.closePath(),b=!0}}b?d.fillStrokeShape(this):d.strokeShape(this)}};Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape);
Kinetic.Path.getLineLength=function(d,a,b,c){return Math.sqrt((b-d)*(b-d)+(c-a)*(c-a))};Kinetic.Path.getPointOnLine=function(d,a,b,c,f,e,h){void 0===e&&(e=a);void 0===h&&(h=b);var g=(f-b)/(c-a+1E-8),j=Math.sqrt(d*d/(1+g*g));a>c&&(j*=-1);var k=g*j;if(c===a)a={x:e,y:h+k};else if((h-b)/(e-a+1E-8)===g)a={x:e+j,y:h+k};else{k=this.getLineLength(a,b,c,f);if(1E-8>k)return;j=((e-a)*(c-a)+(h-b)*(f-b))/(k*k);k=a+j*(c-a);b+=j*(f-b);e=this.getLineLength(e,h,k,b);d=Math.sqrt(d*d-e*e);j=Math.sqrt(d*d/(1+g*g));a>
c&&(j*=-1);a={x:k+j,y:b+g*j}}return a};Kinetic.Path.getPointOnCubicBezier=function(d,a,b,c,f,e,h,g,j){return{x:g*d*d*d+e*3*d*d*(1-d)+c*3*d*(1-d)*(1-d)+a*(1-d)*(1-d)*(1-d),y:j*d*d*d+h*3*d*d*(1-d)+f*3*d*(1-d)*(1-d)+b*(1-d)*(1-d)*(1-d)}};Kinetic.Path.getPointOnQuadraticBezier=function(d,a,b,c,f,e,h){return{x:e*d*d+c*2*d*(1-d)+a*(1-d)*(1-d),y:h*d*d+f*2*d*(1-d)+b*(1-d)*(1-d)}};Kinetic.Path.getPointOnEllipticalArc=function(d,a,b,c,f,e){var h=Math.cos(e);e=Math.sin(e);b*=Math.cos(f);c*=Math.sin(f);return{x:d+
(b*h-c*e),y:a+(b*e+c*h)}};Kinetic.Path.parsePathData=function(d){if(!d)return[];var a,b="mMlLvVhHzZcCqQtTsSaA".split("");a=d.replace(RegExp(" ","g"),",");for(d=0;d<b.length;d++)a=a.replace(RegExp(b[d],"g"),"|"+b[d]);b=a.split("|");a=[];var c=0,f=0;for(d=1;d<b.length;d++){var e=b[d],h=e.charAt(0),e=e.slice(1),e=e.replace(RegExp(",-","g"),"-"),e=e.replace(RegExp("-","g"),",-"),e=e.replace(RegExp("e,-","g"),"e-"),e=e.split(",");0<e.length&&""===e[0]&&e.shift();for(var g=0;g<e.length;g++)e[g]=parseFloat(e[g]);
for(;0<e.length&&!isNaN(e[0]);){var j,k,n,l,r,s,p,u;j=null;l=[];var g=c,q=f;switch(h){case "l":c+=e.shift();f+=e.shift();j="L";l.push(c,f);break;case "L":c=e.shift();f=e.shift();l.push(c,f);break;case "m":h=e.shift();k=e.shift();if(c+=h,f+=k,j="M",2<a.length&&"z"===a[a.length-1].command)for(n=a.length-2;0<=n;n--)if("M"===a[n].command){c=a[n].points[0]+h;f=a[n].points[1]+k;break}l.push(c,f);h="l";break;case "M":c=e.shift();f=e.shift();j="M";l.push(c,f);h="L";break;case "h":c+=e.shift();j="L";l.push(c,
f);break;case "H":c=e.shift();j="L";l.push(c,f);break;case "v":f+=e.shift();j="L";l.push(c,f);break;case "V":f=e.shift();j="L";l.push(c,f);break;case "C":l.push(e.shift(),e.shift(),e.shift(),e.shift());c=e.shift();f=e.shift();l.push(c,f);break;case "c":l.push(c+e.shift(),f+e.shift(),c+e.shift(),f+e.shift());c+=e.shift();f+=e.shift();j="C";l.push(c,f);break;case "S":k=c;n=f;j=a[a.length-1];"C"===j.command&&(k=c+(c-j.points[2]),n=f+(f-j.points[3]));l.push(k,n,e.shift(),e.shift());c=e.shift();f=e.shift();
j="C";l.push(c,f);break;case "s":k=c;n=f;j=a[a.length-1];"C"===j.command&&(k=c+(c-j.points[2]),n=f+(f-j.points[3]));l.push(k,n,c+e.shift(),f+e.shift());c+=e.shift();f+=e.shift();j="C";l.push(c,f);break;case "Q":l.push(e.shift(),e.shift());c=e.shift();f=e.shift();l.push(c,f);break;case "q":l.push(c+e.shift(),f+e.shift());c+=e.shift();f+=e.shift();j="Q";l.push(c,f);break;case "T":k=c;n=f;j=a[a.length-1];"Q"===j.command&&(k=c+(c-j.points[0]),n=f+(f-j.points[1]));c=e.shift();f=e.shift();j="Q";l.push(k,
n,c,f);break;case "t":k=c;n=f;j=a[a.length-1];"Q"===j.command&&(k=c+(c-j.points[0]),n=f+(f-j.points[1]));c+=e.shift();f+=e.shift();j="Q";l.push(k,n,c,f);break;case "A":l=e.shift();k=e.shift();n=e.shift();r=e.shift();s=e.shift();p=c;u=f;c=e.shift();f=e.shift();j="A";l=this.convertEndpointToCenterParameterization(p,u,c,f,r,s,l,k,n);break;case "a":l=e.shift(),k=e.shift(),n=e.shift(),r=e.shift(),s=e.shift(),p=c,u=f,c+=e.shift(),f+=e.shift(),j="A",l=this.convertEndpointToCenterParameterization(p,u,c,f,
r,s,l,k,n)}a.push({command:j||h,points:l,start:{x:g,y:q},pathLength:this.calcLength(g,q,j||h,l)})}("z"===h||"Z"===h)&&a.push({command:"z",points:[],start:void 0,pathLength:0})}return a};Kinetic.Path.calcLength=function(d,a,b,c){var f,e,h=Kinetic.Path;switch(b){case "L":return h.getLineLength(d,a,c[0],c[1]);case "C":b=0;f=h.getPointOnCubicBezier(0,d,a,c[0],c[1],c[2],c[3],c[4],c[5]);for(t=0.01;1>=t;t+=0.01)e=h.getPointOnCubicBezier(t,d,a,c[0],c[1],c[2],c[3],c[4],c[5]),b+=h.getLineLength(f.x,f.y,e.x,
e.y),f=e;return b;case "Q":b=0;f=h.getPointOnQuadraticBezier(0,d,a,c[0],c[1],c[2],c[3]);for(t=0.01;1>=t;t+=0.01)e=h.getPointOnQuadraticBezier(t,d,a,c[0],c[1],c[2],c[3]),b+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;return b;case "A":b=0;d=c[4];a=c[5];var g=c[4]+a,j=Math.PI/180;if(Math.abs(d-g)<j&&(j=Math.abs(d-g)),f=h.getPointOnEllipticalArc(c[0],c[1],c[2],c[3],d,0),0>a)for(t=d-j;t>g;t-=j)e=h.getPointOnEllipticalArc(c[0],c[1],c[2],c[3],t,0),b+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;else for(t=d+j;g>t;t+=
j)e=h.getPointOnEllipticalArc(c[0],c[1],c[2],c[3],t,0),b+=h.getLineLength(f.x,f.y,e.x,e.y),f=e;return e=h.getPointOnEllipticalArc(c[0],c[1],c[2],c[3],g,0),b+h.getLineLength(f.x,f.y,e.x,e.y)}return 0};Kinetic.Path.convertEndpointToCenterParameterization=function(d,a,b,c,f,e,h,g,j){j*=Math.PI/180;var k=Math.cos(j)*(d-b)/2+Math.sin(j)*(a-c)/2,n=-1*Math.sin(j)*(d-b)/2+Math.cos(j)*(a-c)/2,l=k*k/(h*h)+n*n/(g*g);1<l&&(h*=Math.sqrt(l),g*=Math.sqrt(l));l=Math.sqrt((h*h*g*g-h*h*n*n-g*g*k*k)/(h*h*n*n+g*g*k*
k));f==e&&(l*=-1);isNaN(l)&&(l=0);f=l*h*n/g;l=l*-g*k/h;d=(d+b)/2+Math.cos(j)*f-Math.sin(j)*l;a=(a+c)/2+Math.sin(j)*f+Math.cos(j)*l;var r=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.sqrt(b[0]*b[0]+b[1]*b[1]))},s=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(r(a,b))};c=s([1,0],[(k-f)/h,(n-l)/g]);b=[(k-f)/h,(n-l)/g];k=[(-1*k-f)/h,(-1*n-l)/g];n=s(b,k);return-1>=r(b,k)&&(n=Math.PI),1<=r(b,k)&&(n=0),0===e&&0<n&&(n-=2*Math.PI),1==e&&0>n&&(n+=2*Math.PI),[d,a,
h,g,c,n,j,e]};Kinetic.Factory.addGetterSetter(Kinetic.Path,"data");Kinetic.Collection.mapMethods(Kinetic.Path)}();
!function(){function d(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}Kinetic.TextPath=function(a){this.___init(a)};Kinetic.TextPath.prototype={___init:function(b){var c=this;this.dummyCanvas=document.createElement("canvas");this.dataArray=[];Kinetic.Shape.call(this,b);this._fillFunc=d;this._strokeFunc=a;this._fillFuncHit=d;this._strokeFuncHit=a;this.className="TextPath";this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange.kinetic",function(){c.dataArray=
Kinetic.Path.parsePathData(this.attrs.data)});this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",c._setTextData);c._setTextData();this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();for(var c=this.glyphInfo,d=0;d<c.length;d++){a.save();var e=c[d].p0;a.translate(e.x,e.y);a.rotate(c[d].rotation);this.partialText=c[d].text;a.fillStrokeShape(this);a.restore()}a.restore()},
getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var c=this.dummyCanvas.getContext("2d");c.save();c.font=this._getContextFont();a=c.measureText(a);return c.restore(),{width:a.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,c=this._getTextSize(this.attrs.text);this.textWidth=c.width;this.textHeight=c.height;this.glyphInfo=[];for(var d,
e,h,c=this.attrs.text.split(""),g=-1,j=0,k=function(c){c=a._getTextSize(c).width;var k=0,l=0;for(e=void 0;0.01<Math.abs(c-k)/c&&25>l;){l++;for(var q=k;void 0===h;){var v;a:{j=0;v=a.dataArray;for(var n=g+1;n<v.length;n++){if(0<v[n].pathLength){v=(g=n,v[n]);break a}"M"==v[n].command&&(d={x:v[n].points[0],y:v[n].points[1]})}v={}}(h=v)&&q+h.pathLength<c&&(q+=h.pathLength,h=void 0)}if(h==={}||void 0===d)break;q=!1;switch(h.command){case "L":Kinetic.Path.getLineLength(d.x,d.y,h.points[0],h.points[1])>c?
e=Kinetic.Path.getPointOnLine(c,d.x,d.y,h.points[0],h.points[1],d.x,d.y):h=void 0;break;case "A":v=h.points[4];var n=h.points[5],r=h.points[4]+n;0===j?j=v+1E-8:c>k?j+=Math.PI/180*n/Math.abs(n):j-=Math.PI/360*n/Math.abs(n);(0>n&&r>j||0<=n&&j>r)&&(j=r,q=!0);e=Kinetic.Path.getPointOnEllipticalArc(h.points[0],h.points[1],h.points[2],h.points[3],j,h.points[6]);break;case "C":0===j?j=c>h.pathLength?1E-8:c/h.pathLength:c>k?j+=(c-k)/h.pathLength:j-=(k-c)/h.pathLength;1<j&&(j=1,q=!0);e=Kinetic.Path.getPointOnCubicBezier(j,
h.start.x,h.start.y,h.points[0],h.points[1],h.points[2],h.points[3],h.points[4],h.points[5]);break;case "Q":0===j?j=c/h.pathLength:c>k?j+=(c-k)/h.pathLength:j-=(k-c)/h.pathLength,1<j&&(j=1,q=!0),e=Kinetic.Path.getPointOnQuadraticBezier(j,h.start.x,h.start.y,h.points[0],h.points[1],h.points[2],h.points[3])}void 0!==e&&(k=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y));q&&(h=void 0)}},n=0;n<c.length&&(k(c[n]),void 0!==d&&void 0!==e);n++){var l=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y),l=Kinetic.Path.getPointOnLine(0+
l/2,d.x,d.y,e.x,e.y),r=Math.atan2(e.y-d.y,e.x-d.x);this.glyphInfo.push({transposeX:l.x,transposeY:l.y,text:c[n],rotation:r,p0:d,p1:e});d=e}}};Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont;Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle","normal");Kinetic.Factory.addGetter(Kinetic.TextPath,
"text","");Kinetic.Collection.mapMethods(Kinetic.TextPath)}();
!function(){Kinetic.RegularPolygon=function(d){this.___init(d)};Kinetic.RegularPolygon.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var a,b,c,f=this.attrs.sides,e=this.attrs.radius;d.beginPath();d.moveTo(0,0-e);for(a=1;f>a;a++)b=e*Math.sin(2*a*Math.PI/f),c=-1*e*Math.cos(2*a*Math.PI/f),d.lineTo(b,c);d.closePath();d.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,
"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0);Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}();
!function(){Kinetic.Star=function(d){this.___init(d)};Kinetic.Star.prototype={___init:function(d){Kinetic.Shape.call(this,d);this.className="Star";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(d){var a=this.innerRadius(),b=this.outerRadius(),c=this.numPoints();d.beginPath();d.moveTo(0,0-b);for(var f=1;2*c>f;f++){var e=0===f%2?b:a,h=e*Math.sin(f*Math.PI/c),e=-1*e*Math.cos(f*Math.PI/c);d.lineTo(h,e)}d.closePath();d.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Star,
"numPoints",5);Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Star)}();
!function(){var d="fontFamily fontSize fontStyle padding lineHeight text".split(" "),a=d.length;Kinetic.Label=function(a){this.____init(a)};Kinetic.Label.prototype={____init:function(a){var c=this;this.className="Label";Kinetic.Group.call(this,a);this.on("add.kinetic",function(a){c._addListeners(a.child);c._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(b){var c,f=this,e=function(){f._sync()};for(c=0;a>c;c++)b.on(d[c]+
"Change.kinetic",e)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a,c,d,e,h,g,j=this.getText(),k=this.getTag();if(j&&k){switch(a=j.getWidth(),c=j.getHeight(),d=k.getPointerDirection(),e=k.getPointerWidth(),pointerHeight=k.getPointerHeight(),h=0,g=0,d){case "up":h=a/2;g=-1*pointerHeight;break;case "right":h=a+e;g=c/2;break;case "down":h=a/2;g=c+pointerHeight;break;case "left":h=-1*e,g=c/2}k.setAttrs({x:-1*h,y:-1*
g,width:a,height:c});j.setAttrs({x:-1*h,y:-1*g})}}};Kinetic.Util.extend(Kinetic.Label,Kinetic.Group);Kinetic.Collection.mapMethods(Kinetic.Label);Kinetic.Tag=function(a){this.___init(a)};Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Tag";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var c=this.getWidth(),d=this.getHeight(),e=this.getPointerDirection(),h=this.getPointerWidth(),g=this.getPointerHeight();this.getCornerRadius();a.beginPath();a.moveTo(0,
0);"up"===e&&(a.lineTo((c-h)/2,0),a.lineTo(c/2,-1*g),a.lineTo((c+h)/2,0));a.lineTo(c,0);"right"===e&&(a.lineTo(c,(d-g)/2),a.lineTo(c+h,d/2),a.lineTo(c,(d+g)/2));a.lineTo(c,d);"down"===e&&(a.lineTo((c+h)/2,d),a.lineTo(c/2,d+g),a.lineTo((c-h)/2,d));a.lineTo(0,d);"left"===e&&(a.lineTo(0,(d+g)/2),a.lineTo(-1*h,d/2),a.lineTo(0,(d-g)/2));a.closePath();a.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection","none");Kinetic.Factory.addGetterSetter(Kinetic.Tag,
"pointerWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Tag)}();
window.Modernizr=function(d,a,b){var c={},f=a.documentElement,e=a.createElement("modernizr"),e=e.style,h=" -webkit- -moz- -o- -ms- ".split(" "),g={},j=[],k=j.slice,n,l=function(b,c,d,e){var g,h,q,j,k=a.createElement("div"),v=a.body,l=v||a.createElement("body");if(parseInt(d,10))for(;d--;)q=a.createElement("div"),q.id=e?e[d]:"modernizr"+(d+1),k.appendChild(q);return g=['&#173;<style id="smodernizr">',b,"</style>"].join(""),k.id="modernizr",(v?k:l).innerHTML+=g,l.appendChild(k),v||(l.style.background=
"",l.style.overflow="hidden",j=f.style.overflow,f.style.overflow="hidden",f.appendChild(l)),h=c(k,b),v?k.parentNode.removeChild(k):(l.parentNode.removeChild(l),f.style.overflow=j),!!h},r={}.hasOwnProperty,s,p;s="undefined"!==typeof r&&"undefined"!==typeof r.call?function(a,b){return r.call(a,b)}:function(a,b){return b in a&&"undefined"===typeof a.constructor.prototype[b]};Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c,d;if("function"!=typeof b)throw new TypeError;return c=
k.call(arguments,1),d=function(){var e,f,g;return this instanceof d?(e=function(){},e.prototype=b.prototype,f=new e,g=b.apply(f,c.concat(k.call(arguments))),Object(g)===g?g:f):b.apply(a,c.concat(k.call(arguments)))},d});g.canvas=function(){var b=a.createElement("canvas");return!!b.getContext&&!!b.getContext("2d")};g.canvastext=function(){var b;if(b=!!c.canvas)b="function"===typeof a.createElement("canvas").getContext("2d").fillText;return b};g.touch=function(){var b;return"ontouchstart"in d||d.DocumentTouch&&
a instanceof DocumentTouch?b=!0:l(["@media (",h.join("touch-enabled),("),"modernizr){#modernizr{top:9px;position:absolute}}"].join(""),function(a){b=9===a.offsetTop}),b};g.fontface=function(){var b;return l('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=a.getElementById("smodernizr"),e=(e=e.sheet||e.styleSheet)?e.cssRules&&e.cssRules[0]?e.cssRules[0].cssText:e.cssText||"":"";b=/src/i.test(e)&&0===e.indexOf(d.split(" ")[0])}),b};g.localstorage=function(){try{return localStorage.setItem("modernizr",
"modernizr"),localStorage.removeItem("modernizr"),!0}catch(a){return!1}};for(p in g)s(g,p)&&(n=p.toLowerCase(),c[n]=g[p](),j.push((c[n]?"":"no-")+n));c.addTest=function(a,d){if("object"==typeof a)for(var e in a)s(a,e)&&c.addTest(e,a[e]);else{if(a=a.toLowerCase(),c[a]!==b)return c;d="function"==typeof d?d():d;"undefined"!=typeof enableClasses&&enableClasses&&(f.className+=" "+(d?"":"no-")+a);c[a]=d}return c};e.cssText="";var e=null,u=function(){var a=K.elements;return"string"==typeof a?a.split(" "):
a},q=function(a){var b=z[a[G]];return b||(b={},E++,a[G]=E,z[E]=b),b},v=function(b,c,d){if(c||(c=a),m)return c.createElement(b);d||(d=q(c));var e;return e=d.cache[b]?d.cache[b].cloneNode():F.test(b)?(d.cache[b]=d.createElem(b)).cloneNode():d.createElem(b),e.canHaveChildren&&!B.test(b)?d.frag.appendChild(e):e};n=function(b){b||(b=a);var c=q(b);if(K.shivCSS&&!x&&!c.hasCSS){var d,e=b;d=e.createElement("p");e=e.getElementsByTagName("head")[0]||e.documentElement;d=(d.innerHTML="x<style>article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}</style>",
e.insertBefore(d.lastChild,e.firstChild));c.hasCSS=!!d}if(!m){var f=b;c.cache||(c.cache={},c.createElem=f.createElement,c.createFrag=f.createDocumentFragment,c.frag=c.createFrag());f.createElement=function(a){return K.shivMethods?v(a,f,c):c.createElem(a)};f.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+u().join().replace(/\w+/g,function(a){return c.createElem(a),c.frag.createElement(a),'c("'+a+'")'})+");return n}")(K,c.frag)}return b};
p=this.html5||{};var B=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,F=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,x,G="_html5shiv",E=0,z={},m,K;try{var C=a.createElement("a");C.innerHTML="<xyz></xyz>";x="hidden"in C;var y;if(!(y=1==C.childNodes.length)){a.createElement("a");var D=a.createDocumentFragment();y="undefined"==typeof D.cloneNode||"undefined"==typeof D.createDocumentFragment||"undefined"==typeof D.createElement}m=
y}catch(J){m=x=!0}this.html5=K={elements:p.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:!1!==p.shivCSS,supportsUnknownElements:m,shivMethods:!1!==p.shivMethods,type:"default",shivDocument:n,createElement:v,createDocumentFragment:function(b,c){if(b||(b=a),m)return b.createDocumentFragment();c=c||q(b);for(var d=c.frag.cloneNode(),e=0,f=u(),g=f.length;e<g;e++)d.createElement(f[e]);
return d}};n(a);return c._version="2.6.2",c._prefixes=h,c.testStyles=l,c}(this,this.document);
(function(d){d.Jcrop=function(a,b){function c(a){return Math.round(a)+"px"}function f(a){a=d(a).offset();return[a.left,a.top]}function e(a){return[a.pageX-K[0],a.pageY-K[1]]}function h(a){"object"!==typeof a&&(a={});m=d.extend(m,a);d.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!==typeof m[b]&&(m[b]=function(){})})}function g(a,b,c){K=f(I);da.setCursor("move"===a?a:a+"-resize");if("move"===a)return da.activateHandlers(k(b),p,c);b=W.getFixed();var d=n(a),e=W.getCorner(n(d));
W.setPressed(W.getCorner(d));W.setCurrent(e);da.activateHandlers(j(a,b),p,c)}function j(a,b){return function(c){if(m.aspectRatio)switch(a){case "e":c[1]=b.y+1;break;case "w":c[1]=b.y+1;break;case "n":c[0]=b.x+1;break;case "s":c[0]=b.x+1}else switch(a){case "e":c[1]=b.y2;break;case "w":c[1]=b.y2;break;case "n":c[0]=b.x2;break;case "s":c[0]=b.x2}W.setCurrent(c);S.update()}}function k(a){var b=a;ua.watchKeys();return function(a){W.moveOffset([a[0]-b[0],a[1]-b[1]]);b=a;S.update()}}function n(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function l(a){return function(b){if(m.disabled||"move"===a&&!m.allowMove)return!1;K=f(I);Ma=!0;g(a,e(b));b.stopPropagation();b.preventDefault();return!1}}function r(a,b,c){var d=a.width(),e=a.height();d>b&&0<b&&(d=b,e=b/a.width()*a.height());e>c&&0<c&&(e=c,d=c/a.height()*a.width());ba=a.width()/d;ca=a.height()/e;a.width(d).height(e)}function s(a){return{x:a.x*
ba,y:a.y*ca,x2:a.x2*ba,y2:a.y2*ca,w:a.w*ba,h:a.h*ca}}function p(){var a=W.getFixed();a.w>m.minSelect[0]&&a.h>m.minSelect[1]?(S.enableHandles(),S.done()):S.release();da.setCursor(m.allowSelect?"crosshair":"default")}function u(a){if(m.disabled||!m.allowSelect)return!1;Ma=!0;K=f(I);S.disableHandles();da.setCursor("crosshair");var b=e(a);W.setPressed(b);S.update();da.activateHandlers(q,p,"touch"===a.type.substring(0,5));ua.watchKeys();a.stopPropagation();a.preventDefault();return!1}function q(a){W.setCurrent(a);
S.update()}function v(){var a=d("<div></div>").addClass(m.baseClass+"-tracker");y&&a.css({opacity:0,backgroundColor:"white"});return a}function B(a){F([a[0]/ba,a[1]/ca,a[2]/ba,a[3]/ca]);m.onSelect.call(oa,s(W.getFixed()));S.enableHandles()}function F(a){W.setPressed([a[0],a[1]]);W.setCurrent([a[2],a[3]]);S.update()}function x(){m.disabled=!0;S.disableHandles();S.setCursor("default");da.setCursor("default")}function G(){m.disabled=!1;z()}function E(a,b,c){b=b||m.bgColor;m.bgFade&&d.fx.step.hasOwnProperty("backgroundColor")&&
m.fadeTime&&!c?a.animate({backgroundColor:b},{queue:!1,duration:m.fadeTime}):a.css("backgroundColor",b)}function z(a){m.allowResize?a?S.enableOnly():S.enableHandles():S.disableHandles();da.setCursor(m.allowSelect?"crosshair":"default");S.setCursor(m.allowMove?"move":"default");m.hasOwnProperty("trueSize")&&(ba=m.trueSize[0]/R,ca=m.trueSize[1]/H);m.hasOwnProperty("setSelect")&&(B(m.setSelect),S.done(),delete m.setSelect);fa.refresh();m.bgColor!=gb&&(E(m.shade?fa.getShades():L,m.shade?m.shadeColor||
m.bgColor:m.bgColor),gb=m.bgColor);Pa!=m.bgOpacity&&(Pa=m.bgOpacity,m.shade?fa.refresh():S.setBgOpacity(Pa));Qa=m.maxSize[0]||0;Ra=m.maxSize[1]||0;Sa=m.minSize[0]||0;Ta=m.minSize[1]||0;m.hasOwnProperty("outerImage")&&(I.attr("src",m.outerImage),delete m.outerImage);S.refresh()}var m=d.extend({},d.Jcrop.defaults),K,C=navigator.userAgent.toLowerCase(),y=/msie/.test(C),D=/msie [1-6]\./.test(C);"object"!==typeof a&&(a=d(a)[0]);"object"!==typeof b&&(b={});h(b);var J={border:"none",visibility:"visible",
margin:0,padding:0,position:"absolute",top:0,left:0},A=d(a),M=!0;if("IMG"==a.tagName){if(0!=A[0].width&&0!=A[0].height)A.width(A[0].width),A.height(A[0].height);else{var O=new Image;O.src=A[0].src;A.width(O.width);A.height(O.height)}var I=A.clone().removeAttr("id").css(J).show();I.width(A.width());I.height(A.height());A.after(I).hide()}else I=A.css(J).show(),M=!1,null===m.shade&&(m.shade=!0);r(I,m.boxWidth,m.boxHeight);var R=I.width(),H=I.height(),L=d("<div />").width(R).height(H).addClass(m.baseClass+
"-holder").css({position:"relative",backgroundColor:m.bgColor}).insertAfter(A).append(I);m.addClass&&L.addClass(m.addClass);var N=d("<div />"),w=d("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),Ja=d("<div />").width("100%").height("100%").css("zIndex",320),Ka=d("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=W.getFixed();m.onDblClick.call(oa,a)}).insertBefore(I).append(w,Ja);M&&(N=d("<img />").attr("src",I.attr("src")).css(J).width(R).height(H),
w.append(N));D&&Ka.css({overflowY:"hidden"});var La=m.boundary,Ba=v().width(R+2*La).height(H+2*La).css({position:"absolute",top:c(-La),left:c(-La),zIndex:290}).mousedown(u),gb=m.bgColor,Pa=m.bgOpacity,Qa,Ra,Sa,Ta,ba,ca,Ma,eb,mb;K=f(I);var ia,hb=function(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var e=b[d],e="on"+e,f=e in c;f||(c.setAttribute(e,"return;"),f="function"==typeof c[e]);a[b[d]]=f}return a.touchstart&&a.touchend&&a.touchmove}catch(g){return!1}};
ia={createDragger:function(a){return function(b){if(m.disabled||"move"===a&&!m.allowMove)return!1;K=f(I);Ma=!0;g(a,e(ia.cfilter(b)),!0);b.stopPropagation();b.preventDefault();return!1}},newSelection:function(a){return u(ia.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:hb,support:!0===m.touchSupport||!1===m.touchSupport?m.touchSupport:hb()};var W,ib=function(){if(!m.aspectRatio){var a=X-Q,b=V-P;
Qa&&Math.abs(a)>Qa&&(X=0<a?Q+Qa:Q-Qa);Ra&&Math.abs(b)>Ra&&(V=0<b?P+Ra:P-Ra);Ta/ca&&Math.abs(b)<Ta/ca&&(V=0<b?P+Ta/ca:P-Ta/ca);Sa/ba&&Math.abs(a)<Sa/ba&&(X=0<a?Q+Sa/ba:Q-Sa/ba);0>Q&&(X-=Q,Q-=Q);0>P&&(V-=P,P-=P);0>X&&(Q-=X,X-=X);0>V&&(P-=V,V-=V);X>R&&(a=X-R,Q-=a,X-=a);V>H&&(a=V-H,P-=a,V-=a);Q>R&&(a=Q-H,V-=a,P-=a);P>H&&(a=P-H,V-=a,P-=a);return kb(fb(Q,P,X,V))}var a=m.aspectRatio,b=m.minSize[0]/ba,c=m.maxSize[0]/ba,d=X-Q,e=V-P,f=Math.abs(d),g=Math.abs(e);0===c&&(c=10*R);f/g<a?(f=V,g*=a,g=0>d?Q-g:g+Q,
0>g?(g=0,f=Math.abs((g-Q)/a),f=0>e?P-f:f+P):g>R&&(g=R,f=Math.abs((g-Q)/a),f=0>e?P-f:f+P)):(g=X,f/=a,f=0>e?P-f:P+f,0>f?(f=0,g=Math.abs((f-P)*a),g=0>d?Q-g:g+Q):f>H&&(f=H,g=Math.abs(f-P)*a,g=0>d?Q-g:g+Q));g>Q?(g-Q<b?g=Q+b:g-Q>c&&(g=Q+c),f=f>P?P+(g-Q)/a:P-(g-Q)/a):g<Q&&(Q-g<b?g=Q-b:Q-g>c&&(g=Q-c),f=f>P?P+(Q-g)/a:P-(Q-g)/a);0>g?(Q-=g,g=0):g>R&&(Q-=g-R,g=R);0>f?(P-=f,f=0):f>H&&(P-=f-H,f=H);return kb(fb(Q,P,g,f))},jb=function(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>R&&(a[0]=R);a[1]>H&&(a[1]=H);return[Math.round(a[0]),
Math.round(a[1])]},fb=function(a,b,c,d){var e=a,f=c,g=b,q=d;c<a&&(e=c,f=a);d<b&&(g=d,q=b);return[e,g,f,q]},kb=function(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}},Q=0,P=0,X=0,V=0,Na,bb;W={flipCoords:fb,setPressed:function(a){a=jb(a);X=Q=a[0];V=P=a[1]},setCurrent:function(a){a=jb(a);Na=a[0]-X;bb=a[1]-V;X=a[0];V=a[1]},getOffset:function(){return[Na,bb]},moveOffset:function(a){var b=a[0];a=a[1];0>Q+b&&(b-=b+Q);0>P+a&&(a-=a+P);H<V+a&&(a+=H-(V+a));R<X+b&&(b+=R-(X+b));Q+=b;X+=b;P+=
a;V+=a},getCorner:function(a){var b=ib();switch(a){case "ne":return[b.x2,b.y];case "nw":return[b.x,b.y];case "se":return[b.x2,b.y2];case "sw":return[b.x,b.y2]}},getFixed:ib};var fa,sa=function(){return ta(W.getFixed())},ta=function(a){ja.top.css({left:c(a.x),width:c(a.w),height:c(a.y)});ja.bottom.css({top:c(a.y2),left:c(a.x),width:c(a.w),height:c(H-a.y2)});ja.right.css({left:c(a.x2),width:c(R-a.x2)});ja.left.css({width:c(a.x)})},ga=function(){return d("<div />").css({position:"absolute",backgroundColor:m.shadeColor||
m.bgColor}).appendTo(ka)},na=function(){Y||(Y=!0,ka.insertBefore(I),sa(),S.setBgOpacity(1,0,1),N.hide(),Ca(m.shadeColor||m.bgColor,1),S.isAwake()?U(m.bgOpacity,1):U(1,1))},Ca=function(a,b){E($(),a,b)},Z=function(){Y&&(ka.remove(),N.show(),Y=!1,S.isAwake()?S.setBgOpacity(m.bgOpacity,1,1):(S.setBgOpacity(1,1,1),S.disableHandles()),E(L,0,1))},U=function(a,b){Y&&(m.bgFade&&!b?ka.animate({opacity:1-a},{queue:!1,duration:m.fadeTime}):ka.css({opacity:1-a}))},$=function(){return ka.children()},Y=!1,ka=d("<div />").css({position:"absolute",
zIndex:240,opacity:0}),ja={top:ga(),left:ga().height(H),right:ga().height(H),bottom:ga()};fa={update:sa,updateRaw:ta,getShades:$,setBgColor:Ca,enable:na,disable:Z,resize:function(a,b){ja.left.css({height:c(b)});ja.right.css({height:c(b)})},refresh:function(){m.shade?na():Z();S.isAwake()&&U(m.bgOpacity)},opacity:U};var S,Da=function(a,b){var c=d("<div />").mousedown(l(a)).css({cursor:a+"-resize",position:"absolute",zIndex:b}).addClass("ord-"+a);ia.support&&c.bind("touchstart.jcrop",ia.createDragger(a));
Ja.append(c);return c},la=function(){var a=W.getFixed();W.setPressed([a.x,a.y]);W.setCurrent([a.x2,a.y2]);cb()},cb=function(a){if(ma)return Ua(a)},Ua=function(a){var b=W.getFixed(),d=b.h;Ka.width(Math.round(b.w)).height(Math.round(d));var d=b.x,e=b.y;m.shade||N.css({top:c(-e),left:c(-d)});Ka.css({top:c(e),left:c(d)});m.shade&&fa.updateRaw(b);ma||(Ka.show(),m.shade?fa.opacity(Pa):Ea(Pa,!0),ma=!0);a?m.onSelect.call(oa,s(b)):m.onChange.call(oa,s(b))},Ea=function(a,b,c){if(ma||b)m.bgFade&&!c?I.animate({opacity:a},
{queue:!1,duration:m.fadeTime}):I.css("opacity",a)},aa=function(){va=!0;if(m.allowResize)return Ja.show(),!0},wa=function(){va=!1;Ja.hide()},T=function(a){a?(eb=!0,wa()):(eb=!1,aa())},ma,Va=370,va=!1;if(m.dragEdges&&d.isArray(m.createDragbars)){var Wa=m.createDragbars,pa;for(pa=0;pa<Wa.length;pa++)Da(Wa[pa],Va++).addClass("jcrop-dragbar")}if(d.isArray(m.createHandles)){var Xa=m.createHandles,Fa;for(Fa=0;Fa<Xa.length;Fa++){var ha=m.handleSize,db=Da(Xa[Fa],Va++).css({opacity:m.handleOpacity}).addClass(m.baseClass+
"-handle");ha&&db.width(ha).height(ha)}}if(m.drawBorders&&d.isArray(m.createBorders)){var Ya=m.createBorders,xa,ya;for(ya=0;ya<Ya.length;ya++){switch(Ya[ya]){case "n":xa="hline";break;case "s":xa="hline bottom";break;case "e":xa="vline right";break;case "w":xa="vline"}var Za=xa,za=d("<div />").css({position:"absolute",opacity:m.borderOpacity}).addClass(m.baseClass+"-"+Za);w.append(za)}}d(document).bind("touchstart.jcrop-ios",function(a){d(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});
var qa=v().mousedown(l("move")).css({cursor:"move",position:"absolute",zIndex:360});ia.support&&qa.bind("touchstart.jcrop",ia.createDragger("move"));w.append(qa);wa();S={updateVisible:cb,update:Ua,release:function(){wa();Ka.hide();m.shade?fa.opacity(1):Ea(1);ma=!1;m.onRelease.call(oa)},refresh:la,isAwake:function(){return ma},setCursor:function(a){qa.css("cursor",a)},enableHandles:aa,enableOnly:function(){va=!0},showHandles:function(){va&&Ja.show()},disableHandles:wa,animMode:T,setBgOpacity:Ea,done:function(){T(!1);
la()}};var da,Ga=function(a){Oa(e(a));return!1},ea=function(a){a.preventDefault();a.stopPropagation();Ma&&(Ma=!1,ra(e(a)),S.isAwake()&&m.onSelect.call(oa,s(W.getFixed())),Ba.css({zIndex:290}),d(document).unbind(".jcrop"),Oa=function(){},ra=function(){});return!1},$a=function(a){Oa(e(ia.cfilter(a)));return!1},Ha=function(a){return ea(ia.cfilter(a))},Oa=function(){},ra=function(){},Ia=m.trackDocument;Ia||Ba.mousemove(Ga).mouseup(ea).mouseout(ea);I.before(Ba);da={activateHandlers:function(a,b,c){Ma=
!0;Oa=a;ra=b;Ba.css({zIndex:450});c?d(document).bind("touchmove.jcrop",$a).bind("touchend.jcrop",Ha):Ia&&d(document).bind("mousemove.jcrop",Ga).bind("mouseup.jcrop",ea);return!1},setCursor:function(a){Ba.css("cursor",a)}};var ua,lb=function(){Aa.hide()},ab=function(a,b,c){m.allowMove&&(W.moveOffset([b,c]),S.updateVisible(!0));a.preventDefault();a.stopPropagation()},nb=function(a){if(a.ctrlKey||a.metaKey)return!0;var b=(mb=a.shiftKey?!0:!1)?10:1;switch(a.keyCode){case 37:ab(a,-b,0);break;case 39:ab(a,
b,0);break;case 38:ab(a,0,-b);break;case 40:ab(a,0,b);break;case 27:m.allowSelect&&S.release();break;case 9:return!0}return!1},Aa=d('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),ob=d("<div />").css({position:"absolute",overflow:"hidden"}).append(Aa);m.keySupport&&(Aa.keydown(nb).blur(lb),D||!m.fixedSupport?(Aa.css({position:"absolute",left:"-20px"}),ob.append(Aa).insertBefore(I)):Aa.insertBefore(I));ua={watchKeys:function(){m.keySupport&&(Aa.show(),
Aa.focus())}};ia.support&&Ba.bind("touchstart.jcrop",ia.newSelection);Ja.hide();z(!0);var oa={setImage:function(a,b){S.release();x();var c=new Image;c.onload=function(){var d=c.height,e=m.boxWidth,f=m.boxHeight;I.width(c.width).height(d);I.attr("src",a);N.attr("src",a);r(I,e,f);R=I.width();H=I.height();N.width(R).height(H);Ba.width(R+2*La).height(H+2*La);L.width(R).height(H);fa.resize(R,H);G();"function"===typeof b&&b.call(oa)};c.src=a},animateTo:function(a,b){var c=a[0]/ba,d=a[1]/ca,e=a[2]/ba,f=
a[3]/ca;if(!eb){var g=W.flipCoords(c,d,e,f),q=W.getFixed(),h=[q.x,q.y,q.x2,q.y2],j=m.animationDelay,k=g[0]-h[0],v=g[1]-h[1],l=g[2]-h[2],n=g[3]-h[3],w=0,p=m.swingSpeed,c=h[0],d=h[1],e=h[2],f=h[3];S.animMode(!0);var B=function(){w+=(100-w)/p;h[0]=Math.round(c+w/100*k);h[1]=Math.round(d+w/100*v);h[2]=Math.round(e+w/100*l);h[3]=Math.round(f+w/100*n);99.8<=w&&(w=100);100>w?(F(h),window.setTimeout(B,j)):(S.done(),S.animMode(!1),"function"===typeof b&&b.call(oa))};window.setTimeout(B,j)}},setSelect:B,setOptions:function(a){h(a);
z()},tellSelect:function(){return s(W.getFixed())},tellScaled:function(){return W.getFixed()},setClass:function(a){L.removeClass().addClass(m.baseClass+"-holder").addClass(a)},disable:x,enable:G,cancel:function(){S.done();da.activateHandlers(null,null)},release:S.release,destroy:function(){L.remove();A.show();A.css("visibility","visible");d(a).removeData("Jcrop")},focus:ua.watchKeys,getBounds:function(){return[R*ba,H*ca]},getWidgetSize:function(){return[R,H]},getScaleFactor:function(){return[ba,ca]},
getOptions:function(){return m},ui:{holder:L,selection:Ka}};y&&L.bind("selectstart",function(){return!1});A.data("Jcrop",oa);return oa};d.fn.Jcrop=function(a,b){var c;this.each(function(){if(d(this).data("Jcrop")){if("api"===a)return d(this).data("Jcrop");d(this).data("Jcrop").setOptions(a)}else"IMG"==this.tagName?d.Jcrop.Loader(this,function(){d(this).css({display:"block",visibility:"hidden"});c=d.Jcrop(this,a);d.isFunction(b)&&b.call(c)}):(d(this).css({display:"block",visibility:"hidden"}),c=d.Jcrop(this,
a),d.isFunction(b)&&b.call(c))});return this};d.Jcrop.Loader=function(a,b,c){function f(){h.complete?(e.unbind(".jcloader"),d.isFunction(b)&&b.call(h)):window.setTimeout(f,50)}var e=d(a),h=e[0];e.bind("load.jcloader",f).bind("error.jcloader",function(){e.unbind(".jcloader");d.isFunction(c)&&c.call(h)});h.complete&&d.isFunction(b)&&(e.unbind(".jcloader"),b.call(h))};d.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"transparent",bgOpacity:0.6,
bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
(function(d){function a(a,c){this.$element=d(a);this.options=c;this.enabled=!0;this.fixTitle()}a.prototype={show:function(){var a=this.getTitle();if(a&&this.enabled){var c=this.tip();c.find(".tipsy-inner")[this.options.html?"html":"text"](a);c[0].className="tipsy";c.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var a=d.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),f=c[0].offsetWidth,e=c[0].offsetHeight,
h="function"==typeof this.options.gravity?this.options.gravity.call(this.$element[0]):this.options.gravity,g;switch(h.charAt(0)){case "n":g={top:a.top+a.height+this.options.offset,left:a.left+a.width/2-f/2};break;case "s":g={top:a.top-e-this.options.offset,left:a.left+a.width/2-f/2};break;case "e":g={top:a.top+a.height/2-e/2,left:a.left-f-this.options.offset};break;case "w":g={top:a.top+a.height/2-e/2,left:a.left+a.width+this.options.offset}}2==h.length&&(g.left="w"==h.charAt(1)?a.left+a.width/2-
15:a.left+a.width/2-f+15);c.css(g).addClass("tipsy-"+h);c.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+h.charAt(0);this.options.className&&c.addClass("function"==typeof this.options.className?this.options.className.call(this.$element[0]):this.options.className);this.options.fade?c.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):c.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){d(this).remove()}):
this.tip().remove()},fixTitle:function(){var a=this.$element;if(a.attr("title")||"string"!=typeof a.attr("original-title"))a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var a,c=this.$element,d=this.options;this.fixTitle();d=this.options;"string"==typeof d.title?a=c.attr("title"==d.title?"original-title":d.title):"function"==typeof d.title&&(a=d.title.call(c[0]));return(a=(""+a).replace(/(^\s*|\s*$)/,""))||d.fallback},tip:function(){this.$tip||(this.$tip=d('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),
this.$tip.data("tipsy-pointee",this.$element[0]));return this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.options=this.$element=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}};d.fn.tipsy=function(b){function c(c){var e=d.data(c,"tipsy");e||(e=new a(c,d.fn.tipsy.elementOptions(c,b)),d.data(c,"tipsy",e));return e}function f(){var a=c(this);a.hoverState="in";0==b.delayIn?a.show():(a.fixTitle(),
setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function e(){var a=c(this);a.hoverState="out";0==b.delayOut?a.hide():setTimeout(function(){"out"==a.hoverState&&a.hide()},b.delayOut)}if(!0===b)return this.data("tipsy");if("string"==typeof b){var h=this.data("tipsy");if(h)h[b]();return this}b=d.extend({},d.fn.tipsy.defaults,b);b.live||this.each(function(){c(this)});if("manual"!=b.trigger){var h=b.live?"on":"bind",g="hover"==b.trigger?"mouseleave":"blur";this[h]("hover"==b.trigger?"mouseenter":
"focus",f)[h](g,e)}return this};d.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:0.8,title:"title",trigger:"hover"};d.fn.tipsy.revalidate=function(){d(".tipsy").each(function(){var a=d.data(this,"tipsy-pointee"),c;if(!(c=!a)){a:{for(;a=a.parentNode;)if(a==document){a=!0;break a}a=!1}c=!a}c&&d(this).remove()})};d.fn.tipsy.elementOptions=function(a,c){return d.metadata?d.extend({},c,d(a).metadata()):c};d.fn.tipsy.autoNS=function(){return d(this).offset().top>
d(document).scrollTop()+d(window).height()/2?"s":"n"};d.fn.tipsy.autoWE=function(){return d(this).offset().left>d(document).scrollLeft()+d(window).width()/2?"e":"w"};d.fn.tipsy.autoBounds=function(a,c){return function(){var f=c[0],e=1<c.length?c[1]:!1,h=d(document).scrollTop()+a,g=d(document).scrollLeft()+a,j=d(this);j.offset().top<h&&(f="n");j.offset().left<g&&(e="w");d(window).width()+d(document).scrollLeft()-j.offset().left<a&&(e="e");d(window).height()+d(document).scrollTop()-j.offset().top<a&&
(f="s");return f+(e?e:"")}}})(jQuery);
!function(d,a,b,c){var f=d(a);d.fn.lazyload=function(e){function h(){var a=0;j.each(function(){var b=d(this);if((!k.skip_invisible||b.is(":visible"))&&!d.abovethetop(this,k)&&!d.leftofbegin(this,k))if(d.belowthefold(this,k)||d.rightoffold(this,k)){if(++a>k.failure_limit)return!1}else b.trigger("appear"),a=0})}var g,j=this,k={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:a,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return e&&
(c!==e.failurelimit&&(e.failure_limit=e.failurelimit,delete e.failurelimit),c!==e.effectspeed&&(e.effect_speed=e.effectspeed,delete e.effectspeed),d.extend(k,e)),g=k.container===c||k.container===a?f:d(k.container),0===k.event.indexOf("scroll")&&g.bind(k.event,function(){return h()}),this.each(function(){var a=this,b=d(a);a.loaded=!1;(b.attr("src")===c||!1===b.attr("src"))&&b.is("img")&&b.attr("src",k.placeholder);b.one("appear",function(){this.loaded||(k.appear&&k.appear.call(a,j.length,k),d("<img />").bind("load",
function(){var c=b.attr("data-"+k.data_attribute);b.hide();b.is("img")?b.attr("src",c):b.css("background-image","url('"+c+"')");b[k.effect](k.effect_speed);a.loaded=!0;c=d.grep(j,function(a){return!a.loaded});(j=d(c),k.load)&&k.load.call(a,j.length,k)}).attr("src",b.attr("data-"+k.data_attribute)))});0!==k.event.indexOf("scroll")&&b.bind(k.event,function(){a.loaded||b.trigger("appear")})}),f.bind("resize",function(){h()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&f.bind("pageshow",
function(a){a.originalEvent&&a.originalEvent.persisted&&j.each(function(){d(this).trigger("appear")})}),d(b).ready(function(){h()}),this};d.belowthefold=function(b,h){var g;return g=h.container===c||h.container===a?(a.innerHeight?a.innerHeight:f.height())+f.scrollTop():d(h.container).offset().top+d(h.container).height(),g<=d(b).offset().top-h.threshold};d.rightoffold=function(b,h){var g;return g=h.container===c||h.container===a?f.width()+f.scrollLeft():d(h.container).offset().left+d(h.container).width(),
g<=d(b).offset().left-h.threshold};d.abovethetop=function(b,h){var g;return g=h.container===c||h.container===a?f.scrollTop():d(h.container).offset().top,g>=d(b).offset().top+h.threshold+d(b).height()};d.leftofbegin=function(b,h){var g;return g=h.container===c||h.container===a?f.scrollLeft():d(h.container).offset().left,g>=d(b).offset().left+h.threshold+d(b).width()};d.inviewport=function(a,b){return!(d.rightoffold(a,b)||d.leftofbegin(a,b)||d.belowthefold(a,b)||d.abovethetop(a,b))};d.extend(d.expr[":"],
{"below-the-fold":function(a){return d.belowthefold(a,{threshold:0})},"above-the-top":function(a){return!d.belowthefold(a,{threshold:0})},"right-of-screen":function(a){return d.rightoffold(a,{threshold:0})},"left-of-screen":function(a){return!d.rightoffold(a,{threshold:0})},"in-viewport":function(a){return d.inviewport(a,{threshold:0})},"above-the-fold":function(a){return!d.belowthefold(a,{threshold:0})},"right-of-fold":function(a){return d.rightoffold(a,{threshold:0})},"left-of-fold":function(a){return!d.rightoffold(a,
{threshold:0})}})}(jQuery,window,document);
(function(d){d.ClassyNotty=function(a){function b(a){var b=[[2,"One second","1 second from now"],[60,"seconds",1],[120,"One minute","1 minute from now"],[3600,"minutes",60],[7200,"One hour","1 hour from now"],[86400,"hours",3600],[172800,"One day","tomorrow"],[604800,"days",86400],[1209600,"One week","next week"],[2419200,"weeks",604800],[4838400,"One month","next month"],[29030400,"months",2419200],[58060800,"One year","next year"],[290304E4,"years",29030400],[580608E4,"One century","next century"],
[580608E5,"centuries",290304E4]],c=(new Date-a)/1E3,d=1;0>c&&(c=Math.abs(c),d=1);for(var e=0,f;f=b[e++];)if(c<f[0])return"string"==typeof f[2]?f[d]:Math.floor(c/f[2])+" "+f[1];return a}var c,f,e,h,g,j,k;a=d.extend({title:void 0,content:void 0,timeout:0,error:!1,img:"images/info.png",showTime:!1,click:void 0},a);c=d("#nottys");c.length||(c=d("<div>",{id:"nottys"}).appendTo(document.body));f=d("<div>");f.addClass("notty");!0===a.error&&f.addClass("error");e=d("<div>",{click:function(){d(this).parent().delay(300).queue(function(){d(this).clearQueue();
d(this).remove()})},touchstart:function(){d(this).parent().delay(300).queue(function(){d(this).clearQueue();d(this).remove()})}});e.addClass("hide");e.html("Hide");if(void 0!=a.img){h=d("<div>",{style:"background: url('"+a.img+"')"});h.addClass("img");j=d("<div class='left'>");g=d("<div class='right'>");k=void 0!=a.title?"<h2>"+a.title+"</h2>":"";var n=void 0!=a.content?a.content:"";k=d("<div>",{html:k+n});k.addClass("inner");k.appendTo(g);h.appendTo(j);j.appendTo(f);g.appendTo(f)}else k=void 0!=
a.title?"<h2>"+a.title+"</h2>":"",n=void 0!=a.content?a.content:"",f.html(k+n);e.appendTo(f);!1!=a.showTime&&(h=Number(new Date),timeHTML=d("<div>",{html:"<strong>"+b(h)+"</strong> ago"}),timeHTML.addClass("time").attr("title",h),void 0!=a.img?timeHTML.appendTo(g):timeHTML.appendTo(f),setInterval(function(){d(".time").each(function(){var a=d(this).attr("title");d(this).html("<strong>"+b(a)+"</strong> ago")})},4E3));f.hover(function(){e.show()},function(){e.hide()});f.prependTo(c);f.show();a.timeout&&
setTimeout(function(){f.delay(300).queue(function(){d(this).clearQueue();d(this).remove()})},a.timeout);void 0!=a.click&&(f.addClass("click"),f.click(function(b){d(b.target).is(".hide")||a.click.call(this)}));return this}})(jQuery);
(function(d,a,b){function c(a,b,c){for(var d=[],e,f,g,h=0;h<a.length;h++)e=tinycolor(a[h]),f=0.5>e.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",f+=tinycolor.equals(b,a[h])?" sp-thumb-active":"",g=r?"background-color:"+e.toRgbString():"filter:"+e.toFilter(),d.push('<span title="'+e.toRgbString()+'" data-color="'+e.toRgbString()+'" class="'+f+'"><span class="sp-thumb-inner" style="'+g+';" /></span>');return"<div class='sp-cf "+c+"'>"+d.join("")+"</div>"}function f(b,c){var d=b.outerWidth(),
e=b.outerHeight(),f=c.outerHeight(),g=b[0].ownerDocument,h=g.documentElement,q=h.clientWidth+a(g).scrollLeft(),g=h.clientHeight+a(g).scrollTop(),h=c.offset();return h.top+=f,h.left-=Math.min(h.left,h.left+d>q&&q>d?Math.abs(h.left+d-q):0),h.top-=Math.min(h.top,h.top+e>g&&g>e?Math.abs(e+f-0):0),h}function e(){}function h(a){a.stopPropagation()}function g(a,b){var c=Array.prototype.slice,d=c.call(arguments,2);return function(){return a.apply(b,d.concat(c.call(arguments)))}}function j(b,c,e,f){function g(a){a.stopPropagation&&
a.stopPropagation();a.preventDefault&&a.preventDefault();a.returnValue=!1}function h(a){if(k){if(l&&9>document.documentMode&&!a.button)return q();var d=a.originalEvent.touches,e=d?d[0].pageY:a.pageY,d=Math.max(0,Math.min((d?d[0].pageX:a.pageX)-v.left,n)),e=Math.max(0,Math.min(e-v.top,m));p&&g(a);c.apply(b,[d,e,a])}}function q(){k&&(a(j).unbind(B),a(j.body).removeClass("sp-dragging"),f.apply(b,arguments));k=!1}c=c||function(){};e=e||function(){};f=f||function(){};var j=b.ownerDocument||document,k=
!1,v={},m=0,n=0,p="ontouchstart"in d,B={};B.selectstart=g;B.dragstart=g;B[p?"touchmove":"mousemove"]=h;B[p?"touchend":"mouseup"]=q;a(b).bind(p?"touchstart":"mousedown",function(c){(c.which?3==c.which:2==c.button)||k||!1!==e.apply(b,arguments)&&(k=!0,m=a(b).height(),n=a(b).width(),v=a(b).offset(),a(j).bind(B),a(j.body).addClass("sp-dragging"),p||h(c),g(c))})}var k={beforeShow:e,move:e,change:e,show:e,hide:e,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,
showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},n=[],l=!!/msie/i.exec(d.navigator.userAgent),r,s=document.createElement("div").style;r=(s.cssText="background-color:rgba(0,0,0,.5)",!!~(""+s.backgroundColor).indexOf("rgba")||!!~(""+s.backgroundColor).indexOf("hsla"));var p,s="",u;if(l)for(u=1;6>=
u;u++)s+="<div class='sp-"+u+"'></div>";p=["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-hue'><div class='sp-slider'></div>",s,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button class='sp-choose'></button></div></div></div>"].join("");
a.fn.spectrum=function(e){if("string"==typeof e){var q=this,v=Array.prototype.slice.call(arguments,1);return this.each(function(){var b=n[a(this).data("spectrum.id")],c;if(b){if(c=b[e],!c)throw Error("Spectrum: no such method: '"+e+"'");"get"==e?q=b.get():"container"==e?q=b.container:"option"==e?q=b.option.apply(b,v):"destroy"==e?(b.destroy(),a(this).removeData("spectrum.id")):c.apply(b,v)}}),q}return this.spectrum("destroy").each(function(){var q,v=function(){T.toggleClass("sp-flat",M);T.toggleClass("sp-input-disabled",
!A.showInput);T.toggleClass("sp-alpha-enabled",A.showAlpha);T.toggleClass("sp-buttons-disabled",!A.showButtons||M);T.toggleClass("sp-palette-disabled",!A.showPalette);T.toggleClass("sp-palette-only",A.showPaletteOnly);T.toggleClass("sp-initial-disabled",!A.showInitial);T.addClass(A.className);J()},m=function(b){if(Q){b=tinycolor(b).toRgbString();if(-1===a.inArray(b,la))for(la.push(b);la.length>cb;)la.shift();if(P&&d.localStorage)try{d.localStorage[P]=la.join(";")}catch(c){}}},w=function(){var a=[],
b=la,c={},d,e,f;if(A.showPalette){for(e=0;e<Da.length;e++)for(f=0;f<Da[e].length;f++)d=tinycolor(Da[e][f]).toRgbString(),c[d]=!0;for(e=0;e<b.length;e++)d=tinycolor(b[e]).toRgbString(),c.hasOwnProperty(d)||(a.push(b[e]),c[d]=!0)}return a.reverse().slice(0,A.maxSelectionSize)},B=function(){var b=N(),d=a.map(Da,function(a,d){return c(a,b,"sp-palette-row sp-palette-row-"+d)});la&&d.push(c(w(),b,"sp-palette-row sp-palette-row-selection"));db.html(d.join(""))},x=function(){if(A.showInitial){var a=ea,b=
N();Ya.html(c([a,b],b,"sp-palette-row-initial"))}},F=function(){(0>=ga||0>=ta||0>=Ca)&&J();T.addClass(Ua)},s=function(){T.removeClass(Ua)},G=function(){var a=tinycolor(ha.val());a.ok?E(a):ha.addClass("sp-validation-error")},u=function(){sa?z():y()},y=function(){var b=a.Event("beforeShow.spectrum");if(sa)J();else if(!(aa.trigger(b,[N()]),!1===R.beforeShow(N())||b.isDefaultPrevented())){for(b=0;b<n.length;b++)n[b]&&n[b].hide();sa=!0;a(Ea).bind("click.spectrum",z);a(d).bind("resize.spectrum",Na);za.addClass("sp-active");
T.removeClass("sp-hidden");A.showPalette&&B();J();D();ea=N();x();R.show(ea);aa.trigger("show.spectrum",[ea])}},z=function(b){if((!b||"click"!=b.type||2!=b.button)&&sa&&!M)sa=!1,a(Ea).unbind("click.spectrum",z),a(d).unbind("resize.spectrum",Na),za.removeClass("sp-active"),T.addClass("sp-hidden"),tinycolor.equals(N(),ea)||(Oa&&"cancel"!==b?K(!0):E(ea,!0)),R.hide(N()),aa.trigger("hide.spectrum",[N()])},E=function(a,b){if(!tinycolor.equals(a,N())){var c=tinycolor(a),d=c.toHsv();Y=d.h;ka=d.s;ja=d.v;S=
d.a;D();c.ok&&!b&&(Ha=$a||c.format)}},N=function(a){return a=a||{},tinycolor.fromRatio({h:Y,s:ka,v:ja,a:Math.round(100*S)/100},{format:a.format||Ha})},C=function(){D();R.move(N());aa.trigger("move.spectrum",[N()])},D=function(){var a,b,c,d;ha.removeClass("sp-validation-error");I();a=tinycolor.fromRatio({h:Y,s:1,v:1});ma.css("background-color",a.toHexString());a=Ha;1>S&&("hex"===a||"hex3"===a||"hex6"===a||"name"===a)&&(a="rgb");var e=N({format:a}),f=e.toHexString(),g=e.toRgbString();r||1===e.alpha?
da.css("background-color",g):(da.css("background-color","transparent"),da.css("filter",e.toFilter()));A.showAlpha&&(b=e.toRgb(),b.a=0,c=tinycolor(b).toRgbString(),d="linear-gradient(left, "+c+", "+f+")",l?pa.css("filter",tinycolor(c).toFilter({gradientType:1},f)):(pa.css("background","-webkit-"+d),pa.css("background","-moz-"+d),pa.css("background","-ms-"+d),pa.css("background",d)));A.showInput&&ha.val(e.toString(a));A.showPalette&&B();x()},I=function(){var a=ka*ta,b=ga-ja*ga,a=Math.max(-na,Math.min(ta-
na,a-na)),b=Math.max(-na,Math.min(ga-na,b-na));Va.css({top:b,left:a});Fa.css({left:S*Z-U/2});Wa.css({top:Y*Ca-$})},K=function(a){var b=N(),c;ya&&aa.val(b.toString(Ha)).change();c=!tinycolor.equals(b,ea);ea=b;m(b);a&&c&&(R.change(b),aa.trigger("change.spectrum",[b]))},J=function(){ta=ma.width();ga=ma.height();na=Va.height();va.width();Ca=va.height();$=Wa.height();Z=Xa.width();U=Fa.width();M||(T.css("position","absolute"),T.offset(f(T,qa)));I()};q=function(){z();wa=!0;aa.attr("disabled",!0);qa.addClass("sp-disabled")};
var A,H=a.extend({},k,e);A=(H.callbacks={move:g(H.move,this),change:g(H.change,this),show:g(H.show,this),hide:g(H.hide,this),beforeShow:g(H.beforeShow,this)},H);var M=A.flat,Q=A.showSelectionPalette,P=A.localStorageKey,O=A.theme,R=A.callbacks,Na,bb=J,fa;Na=function(){var a=this,b=arguments;!fa&&(fa=setTimeout(function(){fa=null;bb.apply(a,b)},10))};var sa=!1,ta=0,ga=0,na=0,Ca=0,Z=0,U=0,$=0,Y=0,ka=0,ja=0,S=1,H=A.palette.slice(0),Da=a.isArray(H[0])?H:[H],la=A.selectionPalette.slice(0),cb=A.maxSelectionSize,
Ua="sp-dragging",Ea=this.ownerDocument,aa=a(this),wa=!1,T=a(p,Ea).addClass(O),ma=T.find(".sp-color"),Va=T.find(".sp-dragger"),va=T.find(".sp-hue"),Wa=T.find(".sp-slider"),pa=T.find(".sp-alpha-inner"),Xa=T.find(".sp-alpha"),Fa=T.find(".sp-alpha-handle"),ha=T.find(".sp-input"),db=T.find(".sp-palette"),Ya=T.find(".sp-initial"),H=T.find(".sp-cancel"),xa=T.find(".sp-choose"),ya=aa.is("input"),Za=ya&&!M,za=Za?a("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(O).addClass(A.className):
a([]),qa=Za?za:aa,da=za.find(".sp-preview-inner"),Ga=A.color||ya&&aa.val(),ea=!1,$a=A.preferredFormat,Ha=$a,Oa=!A.showButtons||A.clickoutFiresChange,ra,O=function(b){return b.data&&b.data.ignore?(E(a(this).data("color")),C()):(E(a(this).data("color")),K(!0),C(),z()),!1},Ia,ua;if(l&&T.find("*:not(input)").attr("unselectable","on"),v(),Za&&aa.after(za).hide(),M?aa.after(T).hide():(Ia="parent"===A.appendTo?aa.parent():a(A.appendTo),1!==Ia.length&&(Ia=a("body")),Ia.append(T)),P&&d.localStorage){try{ua=
d.localStorage[P].split(",#"),1<ua.length&&(delete d.localStorage[P],a.each(ua,function(a,b){m(b)}))}catch(lb){}try{la=d.localStorage[P].split(";")}catch(ab){}}qa.bind("click.spectrum touchstart.spectrum",function(b){wa||u();b.stopPropagation();a(b.target).is("input")||b.preventDefault()});(aa.is(":disabled")||!0===A.disabled)&&q();T.click(h);ha.change(G);ha.bind("paste",function(){setTimeout(G,1)});ha.keydown(function(a){13==a.keyCode&&G()});H.text(A.cancelText);H.bind("click.spectrum",function(a){a.stopPropagation();
a.preventDefault();z("cancel")});xa.text(A.chooseText);xa.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();!ha.hasClass("sp-validation-error")&&(K(!0),z())});j(Xa,function(a,b,c){S=a/Z;c.shiftKey&&(S=Math.round(10*S)/10);C()});j(va,function(a,b){Y=parseFloat(b/Ca);C()},F,s);j(ma,function(a,b){ka=parseFloat(a/ta);ja=parseFloat((ga-b)/ga);C()},F,s);Ga?(E(Ga),D(),Ha=$a||tinycolor(Ga).format,m(Ga)):D();M&&y();F=l?"mousedown.spectrum":"click.spectrum touchstart.spectrum";db.delegate(".sp-thumb-el",
F,O);Ya.delegate(".sp-thumb-el:nth-child(1)",F,{ignore:!0},O);q=(ra={show:y,hide:z,toggle:u,reflow:J,option:function(c,d){if(c===b)return a.extend({},A);if(d===b)return A[c];A[c]=d;v()},enable:function(){wa=!1;aa.attr("disabled",!1);qa.removeClass("sp-disabled")},disable:q,set:function(a){E(a);K()},get:N,destroy:function(){aa.show();qa.unbind("click.spectrum touchstart.spectrum");T.remove();za.remove();n[ra.id]=null},container:T},ra.id=n.push(ra)-1,ra);a(this).data("spectrum.id",q.id)})};a.fn.spectrum.load=
!0;a.fn.spectrum.loadOpts={};a.fn.spectrum.draggable=j;a.fn.spectrum.defaults=k;a.spectrum={};a.spectrum.localization={};a.spectrum.palettes={};a.fn.spectrum.processNativeColorInputs=function(){var b=a("<input type='color' value='!' />")[0];"color"===b.type&&"!"!=b.value||a("input[type=color]").spectrum({preferredFormat:"hex6"})};var q=function(a,b){if(a=a?a:"",b=b||{},"object"==typeof a&&a.hasOwnProperty("_tc_id"))return a;var c;c=a;var d={r:0,g:0,b:0},e=1,f=!1,g=!1;if("string"==typeof c)a:{var h,
j;if(c=c.replace(z,"").replace(m,"").toLowerCase(),h=!1,M[c])c=M[c],h=!0;else if("transparent"==c){c={r:0,g:0,b:0,a:0};break a}c=(j=I.rgb.exec(c))?{r:j[1],g:j[2],b:j[3]}:(j=I.rgba.exec(c))?{r:j[1],g:j[2],b:j[3],a:j[4]}:(j=I.hsl.exec(c))?{h:j[1],s:j[2],l:j[3]}:(j=I.hsla.exec(c))?{h:j[1],s:j[2],l:j[3],a:j[4]}:(j=I.hsv.exec(c))?{h:j[1],s:j[2],v:j[3]}:(j=I.hex6.exec(c))?{r:parseInt(j[1],16),g:parseInt(j[2],16),b:parseInt(j[3],16),format:h?"name":"hex"}:(j=I.hex3.exec(c))?{r:parseInt(j[1]+""+j[1],16),
g:parseInt(j[2]+""+j[2],16),b:parseInt(j[3]+""+j[3],16),format:h?"name":"hex"}:!1}if("object"==typeof c){if(c.hasOwnProperty("r")&&c.hasOwnProperty("g")&&c.hasOwnProperty("b"))d={r:255*x(c.r,255),g:255*x(c.g,255),b:255*x(c.b,255)},f=!0,g="%"===String(c.r).substr(-1)?"prgb":"rgb";else if(c.hasOwnProperty("h")&&c.hasOwnProperty("s")&&c.hasOwnProperty("v")){c.s=E(c.s);c.v=E(c.v);var k=c.h,l=c.s,n=c.v,k=6*x(k,360),l=x(l,100),n=x(n,100),p=C.floor(k),d=k-p,k=n*(1-l),r=n*(1-d*l),l=n*(1-(1-d)*l),p=p%6,d=
{r:255*[n,r,k,k,l,n][p],g:255*[l,n,n,r,k,k][p],b:255*[k,k,l,n,n,r][p]},f=!0,g="hsv"}else c.hasOwnProperty("h")&&(c.hasOwnProperty("s")&&c.hasOwnProperty("l"))&&(c.s=E(c.s),c.l=E(c.l),f=c.h,g=c.s,j=c.l,d=function(a,b,c){return(0>c&&(c+=1),1<c&&(c-=1),c<1/6)?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},d=(f=x(f,360),g=x(g,100),j=x(j,100),0===g?n=p=k=j:(r=0.5>j?j*(1+g):j+g-j*g,l=2*j-r,n=d(l,r,f+1/3),p=d(l,r,f),k=d(l,r,f-1/3)),{r:255*n,g:255*p,b:255*k}),f=!0,g="hsl");c.hasOwnProperty("a")&&(e=c.a)}c=
(e=parseFloat(e),(isNaN(e)||0>e||1<e)&&(e=1),{ok:f,format:c.format||g,r:D(255,J(d.r,0)),g:D(255,J(d.g,0)),b:D(255,J(d.b,0)),a:e});var s=c.r,u=c.g,A=c.b,H=c.a,R=y(100*H)/100,e=b.format||c.format;return 1>s&&(s=y(s)),1>u&&(u=y(u)),1>A&&(A=y(A)),{ok:c.ok,format:e,_tc_id:K++,alpha:H,toHsv:function(){var a=B(s,u,A);return{h:360*a.h,s:a.s,v:a.v,a:H}},toHsvString:function(){var a=B(s,u,A),b=y(360*a.h),c=y(100*a.s),a=y(100*a.v);return 1==H?"hsv("+b+", "+c+"%, "+a+"%)":"hsva("+b+", "+c+"%, "+a+"%, "+R+")"},
toHsl:function(){var a=v(s,u,A);return{h:360*a.h,s:a.s,l:a.l,a:H}},toHslString:function(){var a=v(s,u,A),b=y(360*a.h),c=y(100*a.s),a=y(100*a.l);return 1==H?"hsl("+b+", "+c+"%, "+a+"%)":"hsla("+b+", "+c+"%, "+a+"%, "+R+")"},toHex:function(a){return F(s,u,A,a)},toHexString:function(a){return"#"+F(s,u,A,a)},toRgb:function(){return{r:y(s),g:y(u),b:y(A),a:H}},toRgbString:function(){return 1==H?"rgb("+y(s)+", "+y(u)+", "+y(A)+")":"rgba("+y(s)+", "+y(u)+", "+y(A)+", "+R+")"},toPercentageRgb:function(){return{r:y(100*
x(s,255))+"%",g:y(100*x(u,255))+"%",b:y(100*x(A,255))+"%",a:H}},toPercentageRgbString:function(){return 1==H?"rgb("+y(100*x(s,255))+"%, "+y(100*x(u,255))+"%, "+y(100*x(A,255))+"%)":"rgba("+y(100*x(s,255))+"%, "+y(100*x(u,255))+"%, "+y(100*x(A,255))+"%, "+R+")"},toName:function(){return O[F(s,u,A,!0)]||!1},toFilter:function(a){var c=F(s,u,A),d=c,e=Math.round(255*parseFloat(H)).toString(16),f=e,g=b&&b.gradientType?"GradientType = 1, ":"",h;return a&&(h=q(a),d=h.toHex(),f=Math.round(255*parseFloat(h.alpha)).toString(16)),
"progid:DXImageTransform.Microsoft.gradient("+g+"startColorstr=#"+G(e)+c+",endColorstr=#"+G(f)+d+")"},toString:function(a){a=a||this.format;var b=!1;return"rgb"===a&&(b=this.toRgbString()),"prgb"===a&&(b=this.toPercentageRgbString()),("hex"===a||"hex6"===a)&&(b=this.toHexString()),"hex3"===a&&(b=this.toHexString(!0)),"name"===a&&(b=this.toName()),"hsl"===a&&(b=this.toHslString()),"hsv"===a&&(b=this.toHsvString()),b||this.toHexString()}}},v=function(a,b,c){var d;a=x(a,255);b=x(b,255);c=x(c,255);var e=
J(a,b,c),f=D(a,b,c),g,h=(e+f)/2;if(e==f)g=f=0;else{d=e-f;f=0.5<h?d/(2-e-f):d/(e+f);switch(e){case a:g=(b-c)/d+(b<c?6:0);break;case b:g=(c-a)/d+2;break;case c:g=(a-b)/d+4}g/=6}return{h:g,s:f,l:h}},B=function(a,b,c){a=x(a,255);b=x(b,255);c=x(c,255);var d=J(a,b,c),e=D(a,b,c),f,g,h=d-e;if(g=0===d?0:h/d,d==e)f=0;else{switch(d){case a:f=(b-c)/h+(b<c?6:0);break;case b:f=(c-a)/h+2;break;case c:f=(a-b)/h+4}f/=6}return{h:f,s:g,v:d}},F=function(a,b,c,d){a=[G(y(a).toString(16)),G(y(b).toString(16)),G(y(c).toString(16))];
return d&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")},x=function(a,b){"string"==typeof a&&(-1!=a.indexOf(".")&&1===parseFloat(a))&&(a="100%");var c="string"==typeof a&&-1!=a.indexOf("%");return(a=D(b,J(0,parseFloat(a))),c&&(a=parseInt(a*b,10)/100),1E-6>C.abs(a-b))?1:a%b/parseFloat(b)},G=function(a){return 1==a.length?"0"+a:""+a},E=function(a){return 1>=a&&(a=100*a+"%"),a},z=/^[\s,#]+/,m=/\s+$/,
K=0,C=Math,y=C.round,D=C.min,J=C.max,A=C.random,M,O,I;q.fromRatio=function(a,b){var c,d;if("object"==typeof a){c={};for(d in a)a.hasOwnProperty(d)&&(c[d]="a"===d?a[d]:E(a[d]));a=c}return q(a,b)};q.equals=function(a,b){return!a||!b?!1:q(a).toRgbString()==q(b).toRgbString()};q.random=function(){return q.fromRatio({r:A(),g:A(),b:A()})};q.desaturate=function(a,b){var c=q(a).toHsl();return c.s-=(b||10)/100,c.s=D(1,J(0,c.s)),q(c)};q.saturate=function(a,b){var c=q(a).toHsl();return c.s+=(b||10)/100,c.s=
D(1,J(0,c.s)),q(c)};q.greyscale=function(a){return q.desaturate(a,100)};q.lighten=function(a,b){var c=q(a).toHsl();return c.l+=(b||10)/100,c.l=D(1,J(0,c.l)),q(c)};q.darken=function(a,b){var c=q(a).toHsl();return c.l-=(b||10)/100,c.l=D(1,J(0,c.l)),q(c)};q.complement=function(a){a=q(a).toHsl();return a.h=(a.h+180)%360,q(a)};q.triad=function(a){var b=q(a).toHsl(),c=b.h;return[q(a),q({h:(c+120)%360,s:b.s,l:b.l}),q({h:(c+240)%360,s:b.s,l:b.l})]};q.tetrad=function(a){var b=q(a).toHsl(),c=b.h;return[q(a),
q({h:(c+90)%360,s:b.s,l:b.l}),q({h:(c+180)%360,s:b.s,l:b.l}),q({h:(c+270)%360,s:b.s,l:b.l})]};q.splitcomplement=function(a){var b=q(a).toHsl(),c=b.h;return[q(a),q({h:(c+72)%360,s:b.s,l:b.l}),q({h:(c+216)%360,s:b.s,l:b.l})]};q.analogous=function(a,b,c){b=b||6;c=c||30;var d=q(a).toHsl();c=360/c;a=[q(a)];for(d.h=(d.h-(c*b>>1)+720)%360;--b;)d.h=(d.h+c)%360,a.push(q(d));return a};q.monochromatic=function(a,b){b=b||6;for(var c=q(a).toHsv(),d=c.h,e=c.s,c=c.v,f=[],g=1/b;b--;)f.push(q({h:d,s:e,v:c})),c=(c+
g)%1;return f};q.readability=function(a,b){var c=q(a).toRgb(),d=q(b).toRgb(),e=(299*c.r+587*c.g+114*c.b)/1E3,f=(299*d.r+587*d.g+114*d.b)/1E3,c=Math.max(c.r,d.r)-Math.min(c.r,d.r)+Math.max(c.g,d.g)-Math.min(c.g,d.g)+Math.max(c.b,d.b)-Math.min(c.b,d.b);return{brightness:Math.abs(e-f),color:c}};q.readable=function(a,b){var c=q.readability(a,b);return 125<c.brightness&&500<c.color};q.mostReadable=function(a,b){for(var c=null,d=0,e=!1,f=0;f<b.length;f++){var g=q.readability(a,b[f]),h=125<g.brightness&&
500<g.color,g=3*(g.brightness/125)+g.color/500;(h&&!e||h&&e&&g>d||!h&&!e&&g>d)&&(e=h,d=g,c=q(b[f]))}return c};M=q.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",
darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",
floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",
lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",
mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",
seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};s=q;u=M;var R={},H;for(H in u)u.hasOwnProperty(H)&&(R[u[H]]=H);O=s.hexNames=R;I={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};this.tinycolor=q;a(function(){a.fn.spectrum.load&&a.fn.spectrum.processNativeColorInputs()})})(window,jQuery);
(function(d){function a(a){if("string"===typeof a.data){var c=a.handler,f=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var b="keypress"!==a.type&&d.hotkeys.specialKeys[a.which],g=String.fromCharCode(a.which).toLowerCase(),j="",k={};a.altKey&&"alt"!==b&&(j+="alt+");a.ctrlKey&&"ctrl"!==b&&(j+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==b)&&(j+="meta+");a.shiftKey&&"shift"!==b&&(j+="shift+");b?k[j+b]=
!0:(k[j+g]=!0,k[j+d.hotkeys.shiftNums[g]]=!0,"shift+"===j&&(k[d.hotkeys.shiftNums[g]]=!0));b=0;for(g=f.length;b<g;b++)if(k[f[b]])return k=c.apply(this,arguments),a.preventDefault(),k}}}}d.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",
105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",219:"[",221:"]",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"}};d.each(["keydown","keyup","keypress"],function(){d.event.special[this]={add:a}})})(jQuery);
(function(d,a,b){function c(b,c){this.wrapper="string"==typeof b?a.querySelector(b):b;this.scroller=this.wrapper.children[0];this.scrollerStyle=this.scroller.style;this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:0.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var d in c)this.options[d]=
c[d];this.translateZ=this.options.HWCompositing&&g.hasPerspective?" translateZ(0)":"";this.options.useTransition=g.hasTransition&&this.options.useTransition;this.options.useTransform=g.hasTransform&&this.options.useTransform;this.options.eventPassthrough=!0===this.options.eventPassthrough?"vertical":this.options.eventPassthrough;this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault;this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY;
this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX;this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough;this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold;this.options.bounceEasing="string"==typeof this.options.bounceEasing?g.ease[this.options.bounceEasing]||g.ease.circular:this.options.bounceEasing;this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling;
!0===this.options.tap&&(this.options.tap="tap");"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1);this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1;this.directionY=this.directionX=this.y=this.x=0;this._events={};this._init();this.refresh();this.scrollTo(this.options.startX,this.options.startY);this.enable()}function f(b,c,d){var e=a.createElement("div"),f=a.createElement("div");!0===d&&(e.style.cssText="position:absolute;z-index:9999",f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px");
f.className="iScrollIndicator";"h"==b?(!0===d&&(e.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",f.style.height="100%"),e.className="iScrollHorizontalScrollbar"):(!0===d&&(e.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",f.style.width="100%"),e.className="iScrollVerticalScrollbar");e.style.cssText+=";overflow:hidden";c||(e.style.pointerEvents="none");e.appendChild(f);return e}function e(b,c){this.wrapper="string"==typeof c.el?a.querySelector(c.el):c.el;this.wrapperStyle=this.wrapper.style;
this.indicator=this.wrapper.children[0];this.indicatorStyle=this.indicator.style;this.scroller=b;this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var e in c)this.options[e]=c[e];this.sizeRatioY=this.sizeRatioX=1;this.maxPosY=this.maxPosX=0;this.options.interactive&&(this.options.disableTouch||(g.addEvent(this.indicator,"touchstart",this),g.addEvent(d,"touchend",this)),this.options.disablePointer||(g.addEvent(this.indicator,
"MSPointerDown",this),g.addEvent(d,"MSPointerUp",this)),this.options.disableMouse||(g.addEvent(this.indicator,"mousedown",this),g.addEvent(d,"mouseup",this)));this.options.fade&&(this.wrapperStyle[g.style.transform]=this.scroller.translateZ,this.wrapperStyle[g.style.transitionDuration]=g.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var h=d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame||function(a){d.setTimeout(a,
1E3/60)},g,j=function(a){return!1===l?!1:""===l?a:l+a.charAt(0).toUpperCase()+a.substr(1)},k={},n=a.createElement("div").style,l;a:{for(var r=["t","webkitT","MozT","msT","OT"],s,p=0,u=r.length;p<u;p++)if(s=r[p]+"ransform",s in n){l=r[p].substr(0,r[p].length-1);break a}l=!1}k.getTime=Date.now||function(){return(new Date).getTime()};k.extend=function(a,b){for(var c in b)a[c]=b[c]};k.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)};k.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)};
k.momentum=function(a,c,d,e,f,g){c=a-c;d=b.abs(c)/d;var h;g=void 0===g?6E-4:g;h=a+d*d/(2*g)*(0>c?-1:1);g=d/g;h<e?(h=f?e-f/2.5*(d/8):e,c=b.abs(h-a),g=c/d):0<h&&(h=f?f/2.5*(d/8):0,c=b.abs(a)+h,g=c/d);return{destination:b.round(h),duration:g}};r=j("transform");k.extend(k,{hasTransform:!1!==r,hasPerspective:j("perspective")in n,hasTouch:"ontouchstart"in d,hasPointer:navigator.msPointerEnabled,hasTransition:j("transition")in n});k.isBadAndroid=/Android /.test(d.navigator.appVersion)&&!/Chrome\/\d/.test(d.navigator.appVersion);
k.extend(k.style={},{transform:r,transitionTimingFunction:j("transitionTimingFunction"),transitionDuration:j("transitionDuration"),transitionDelay:j("transitionDelay"),transformOrigin:j("transformOrigin")});k.hasClass=function(a,b){return RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)};k.addClass=function(a,b){if(!k.hasClass(a,b)){var c=a.className.split(" ");c.push(b);a.className=c.join(" ")}};k.removeClass=function(a,b){k.hasClass(a,b)&&(a.className=a.className.replace(RegExp("(^|\\s)"+b+"(\\s|$)",
"g")," "))};k.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}};k.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1};k.extend(k.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3});k.extend(k.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",
fn:function(a){return b.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){return(a-=1)*a*(5*a+4)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375}},elastic:{style:"",fn:function(a){return 0===a?0:1==a?1:0.4*b.pow(2,-10*a)*b.sin((a-0.055)*2*b.PI/0.22)+1}}});k.tap=function(b,c){var d=a.createEvent("Event");d.initEvent(c,!0,!0);d.pageX=
b.pageX;d.pageY=b.pageY;b.target.dispatchEvent(d)};k.click=function(b){var c=b.target,d;/(SELECT|INPUT|TEXTAREA)/i.test(c.tagName)||(d=a.createEvent("MouseEvents"),d.initMouseEvent("click",!0,!0,b.view,1,c.screenX,c.screenY,c.clientX,c.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,0,null),d._constructed=!0,c.dispatchEvent(d))};g=k;c.prototype={version:"5.1.1",_init:function(){this._initEvents();(this.options.scrollbars||this.options.indicators)&&this._initIndicators();this.options.mouseWheel&&this._initWheel();
this.options.snap&&this._initSnap();this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0);this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if(!(1!=g.eventType[a.type]&&0!==a.button)&&this.enabled&&!(this.initiated&&g.eventType[a.type]!==this.initiated)){this.options.preventDefault&&
(!g.isBadAndroid&&!g.preventDefaultException(a.target,this.options.preventDefaultException))&&a.preventDefault();var c=a.touches?a.touches[0]:a;this.initiated=g.eventType[a.type];this.moved=!1;this.directionLocked=this.directionY=this.directionX=this.distY=this.distX=0;this._transitionTime();this.startTime=g.getTime();this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,a=this.getComputedPosition(),this._translate(b.round(a.x),b.round(a.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&
this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd"));this.startX=this.x;this.startY=this.y;this.absStartX=this.x;this.absStartY=this.y;this.pointX=c.pageX;this.pointY=c.pageY;this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&g.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var c=a.touches?a.touches[0]:a,d=c.pageX-this.pointX,e=c.pageY-this.pointY,f=g.getTime(),h;this.pointX=c.pageX;this.pointY=c.pageY;this.distX+=d;this.distY+=
e;c=b.abs(this.distX);h=b.abs(this.distY);if(!(300<f-this.endTime&&10>c&&10>h)){!this.directionLocked&&!this.options.freeScroll&&(this.directionLocked=c>h+this.options.directionLockThreshold?"h":h>=c+this.options.directionLockThreshold?"v":"n");if("h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough){this.initiated=!1;return}e=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();
else if("vertical"==this.options.eventPassthrough){this.initiated=!1;return}d=0}d=this.hasHorizontalScroll?d:0;e=this.hasVerticalScroll?e:0;a=this.x+d;c=this.y+e;if(0<a||a<this.maxScrollX)a=this.options.bounce?this.x+d/3:0<a?0:this.maxScrollX;if(0<c||c<this.maxScrollY)c=this.options.bounce?this.y+e/3:0<c?0:this.maxScrollY;this.directionX=0<d?-1:0>d?1:0;this.directionY=0<e?-1:0>e?1:0;this.moved||this._execEvent("scrollStart");this.moved=!0;this._translate(a,c);300<f-this.startTime&&(this.startTime=
f,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&g.eventType[a.type]===this.initiated){this.options.preventDefault&&!g.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var c,d;d=g.getTime()-this.startTime;var e=b.round(this.x),f=b.round(this.y),h=b.abs(e-this.startX),j=b.abs(f-this.startY);c=0;var k="";this.initiated=this.isInTransition=0;this.endTime=g.getTime();if(!this.resetPosition(this.options.bounceTime))if(this.scrollTo(e,
f),this.moved)if(this._events.flick&&200>d&&100>h&&100>j)this._execEvent("flick");else if(this.options.momentum&&300>d&&(c=this.hasHorizontalScroll?g.momentum(this.x,this.startX,d,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:e,duration:0},d=this.hasVerticalScroll?g.momentum(this.y,this.startY,d,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:f,duration:0},e=c.destination,f=d.destination,c=b.max(c.duration,
d.duration),this.isInTransition=1),this.options.snap&&(this.currentPage=k=this._nearestSnap(e,f),c=this.options.snapSpeed||b.max(b.max(b.min(b.abs(e-k.x),1E3),b.min(b.abs(f-k.y),1E3)),300),e=k.x,f=k.y,this.directionY=this.directionX=0,k=this.options.bounceEasing),e!=this.x||f!=this.y){if(0<e||e<this.maxScrollX||0<f||f<this.maxScrollY)k=g.ease.quadratic;this.scrollTo(e,f,c,k)}else this._execEvent("scrollEnd");else this.options.tap&&g.tap(a,this.options.tap),this.options.click&&g.click(a),this._execEvent("scrollCancel")}},
_resize:function(){var a=this;clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;!this.hasHorizontalScroll||0<this.x?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX);!this.hasVerticalScroll||0<this.y?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY);if(b==this.x&&c==this.y)return!1;this.scrollTo(b,c,a||0,this.options.bounceEasing);return!0},disable:function(){this.enabled=!1},enable:function(){this.enabled=
!0},refresh:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;this.scrollerWidth=this.scroller.offsetWidth;this.scrollerHeight=this.scroller.offsetHeight;this.maxScrollX=this.wrapperWidth-this.scrollerWidth;this.maxScrollY=this.wrapperHeight-this.scrollerHeight;this.hasHorizontalScroll=this.options.scrollX&&0>this.maxScrollX;this.hasVerticalScroll=this.options.scrollY&&0>this.maxScrollY;this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=
this.wrapperWidth);this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight);this.directionY=this.directionX=this.endTime=0;this.wrapperOffset=g.offset(this.wrapper);this._execEvent("refresh");this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]);this._events[a].push(b)},off:function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);-1<c&&this._events[a].splice(c,1)}},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;
if(c)for(;b<c;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,c,d){a=this.x+a;b=this.y+b;this.scrollTo(a,b,c||0,d)},scrollTo:function(a,b,c,d){d=d||g.ease.circular;this.isInTransition=this.options.useTransition&&0<c;!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,c,d,e,f){if(a=a.nodeType?a:this.scroller.querySelector(a)){var h=g.offset(a);
h.left-=this.wrapperOffset.left;h.top-=this.wrapperOffset.top;!0===d&&(d=b.round(a.offsetWidth/2-this.wrapper.offsetWidth/2));!0===e&&(e=b.round(a.offsetHeight/2-this.wrapper.offsetHeight/2));h.left-=d||0;h.top-=e||0;h.left=0<h.left?0:h.left<this.maxScrollX?this.maxScrollX:h.left;h.top=0<h.top?0:h.top<this.maxScrollY?this.maxScrollY:h.top;c=void 0===c||null===c||"auto"===c?b.max(b.abs(this.x-h.left),b.abs(this.y-h.top)):c;this.scrollTo(h.left,h.top,c,f)}},_transitionTime:function(a){a=a||0;this.scrollerStyle[g.style.transitionDuration]=
a+"ms";!a&&g.isBadAndroid&&(this.scrollerStyle[g.style.transitionDuration]="0.001s");if(this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTime(a)},_transitionTimingFunction:function(a){this.scrollerStyle[g.style.transitionTimingFunction]=a;if(this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTimingFunction(a)},_translate:function(a,c){this.options.useTransform?this.scrollerStyle[g.style.transform]="translate("+a+"px,"+c+"px)"+this.translateZ:
(a=b.round(a),c=b.round(c),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=c+"px");this.x=a;this.y=c;if(this.indicators)for(var d=this.indicators.length;d--;)this.indicators[d].updatePosition()},_initEvents:function(a){a=a?g.removeEvent:g.addEvent;var b=this.options.bindToWrapper?this.wrapper:d;a(d,"orientationchange",this);a(d,"resize",this);this.options.click&&a(this.wrapper,"click",this,!0);this.options.disableMouse||(a(this.wrapper,"mousedown",this),a(b,"mousemove",this),a(b,"mousecancel",
this),a(b,"mouseup",this));g.hasPointer&&!this.options.disablePointer&&(a(this.wrapper,"MSPointerDown",this),a(b,"MSPointerMove",this),a(b,"MSPointerCancel",this),a(b,"MSPointerUp",this));g.hasTouch&&!this.options.disableTouch&&(a(this.wrapper,"touchstart",this),a(b,"touchmove",this),a(b,"touchcancel",this),a(b,"touchend",this));a(this.scroller,"transitionend",this);a(this.scroller,"webkitTransitionEnd",this);a(this.scroller,"oTransitionEnd",this);a(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var a=
d.getComputedStyle(this.scroller,null),b;this.options.useTransform?(a=a[g.style.transform].split(")")[0].split(", "),b=+(a[12]||a[4]),a=+(a[13]||a[5])):(b=+a.left.replace(/[^-\d.]/g,""),a=+a.top.replace(/[^-\d.]/g,""));return{x:b,y:a}},_initIndicators:function(){function a(b){for(var c=h.indicators.length;c--;)b.call(h.indicators[c])}var b=this.options.interactiveScrollbars,c="string"!=typeof this.options.scrollbars,d=[],g,h=this;this.indicators=[];this.options.scrollbars&&(this.options.scrollY&&
(g={el:f("v",b,this.options.scrollbars),interactive:b,defaultScrollbars:!0,customStyle:c,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(g.el),d.push(g)),this.options.scrollX&&(g={el:f("h",b,this.options.scrollbars),interactive:b,defaultScrollbars:!0,customStyle:c,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(g.el),
d.push(g)));this.options.indicators&&(d=d.concat(this.options.indicators));for(b=d.length;b--;)this.indicators.push(new e(this,d[b]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})}));this.on("refresh",function(){a(function(){this.refresh()})});this.on("destroy",
function(){a(function(){this.destroy()});delete this.indicators})},_initWheel:function(){g.addEvent(this.wrapper,"wheel",this);g.addEvent(this.wrapper,"mousewheel",this);g.addEvent(this.wrapper,"DOMMouseScroll",this);this.on("destroy",function(){g.removeEvent(this.wrapper,"wheel",this);g.removeEvent(this.wrapper,"mousewheel",this);g.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault();a.stopPropagation();var c,d,e,f=this;void 0===this.wheelTimeout&&
f._execEvent("scrollStart");clearTimeout(this.wheelTimeout);this.wheelTimeout=setTimeout(function(){f._execEvent("scrollEnd");f.wheelTimeout=void 0},400);if("deltaX"in a)c=-a.deltaX,a=-a.deltaY;else if("wheelDeltaX"in a)c=a.wheelDeltaX/120*this.options.mouseWheelSpeed,a=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)c=a=a.wheelDelta/120*this.options.mouseWheelSpeed;else if("detail"in a)c=a=-a.detail/3*this.options.mouseWheelSpeed;else return;c*=this.options.invertWheelDirection;
a*=this.options.invertWheelDirection;this.hasVerticalScroll||(c=a,a=0);this.options.snap?(d=this.currentPage.pageX,e=this.currentPage.pageY,0<c?d--:0>c&&d++,0<a?e--:0>a&&e++,this.goToPage(d,e)):(d=this.x+b.round(this.hasHorizontalScroll?c:0),e=this.y+b.round(this.hasVerticalScroll?a:0),0<d?d=0:d<this.maxScrollX&&(d=this.maxScrollX),0<e?e=0:e<this.maxScrollY&&(e=this.maxScrollY),this.scrollTo(d,e,0))}},_initSnap:function(){this.currentPage={};"string"==typeof this.options.snap&&(this.options.snap=
this.scroller.querySelectorAll(this.options.snap));this.on("refresh",function(){var a=0,c,d=0,e,f,g,h=0,j;e=this.options.snapStepX||this.wrapperWidth;var k=this.options.snapStepY||this.wrapperHeight;this.pages=[];if(this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(!0===this.options.snap){f=b.round(e/2);for(g=b.round(k/2);h>-this.scrollerWidth;){this.pages[a]=[];for(j=c=0;j>-this.scrollerHeight;)this.pages[a][c]={x:b.max(h,this.maxScrollX),y:b.max(j,this.maxScrollY),
width:e,height:k,cx:h-f,cy:j-g},j-=k,c++;h-=e;a++}}else{k=this.options.snap;c=k.length;for(e=-1;a<c;a++){if(0===a||k[a].offsetLeft<=k[a-1].offsetLeft)d=0,e++;this.pages[d]||(this.pages[d]=[]);h=b.max(-k[a].offsetLeft,this.maxScrollX);j=b.max(-k[a].offsetTop,this.maxScrollY);f=h-b.round(k[a].offsetWidth/2);g=j-b.round(k[a].offsetHeight/2);this.pages[d][e]={x:h,y:j,width:k[a].offsetWidth,height:k[a].offsetHeight,cx:f,cy:g};h>this.maxScrollX&&d++}}this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||
0,0);0===this.options.snapThreshold%1?this.snapThresholdY=this.snapThresholdX=this.options.snapThreshold:(this.snapThresholdX=b.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=b.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}});this.on("flick",function(){var a=this.options.snapSpeed||b.max(b.max(b.min(b.abs(this.x-this.startX),1E3),b.min(b.abs(this.y-this.startY),1E3)),300);
this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,c){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var d=0,e=this.pages.length,f=0;if(b.abs(a-this.absStartX)<this.snapThresholdX&&b.abs(c-this.absStartY)<this.snapThresholdY)return this.currentPage;0<a?a=0:a<this.maxScrollX&&(a=this.maxScrollX);0<c?c=0:c<this.maxScrollY&&(c=this.maxScrollY);for(;d<e;d++)if(a>=this.pages[d][0].cx){a=this.pages[d][0].x;break}for(e=this.pages[d].length;f<
e;f++)if(c>=this.pages[0][f].cy){c=this.pages[0][f].y;break}d==this.currentPage.pageX&&(d+=this.directionX,0>d?d=0:d>=this.pages.length&&(d=this.pages.length-1),a=this.pages[d][0].x);f==this.currentPage.pageY&&(f+=this.directionY,0>f?f=0:f>=this.pages[0].length&&(f=this.pages[0].length-1),c=this.pages[0][f].y);return{x:a,y:c,pageX:d,pageY:f}},goToPage:function(a,c,d,e){e=e||this.options.bounceEasing;a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0);c>=this.pages[a].length?c=this.pages[a].length-
1:0>c&&(c=0);var f=this.pages[a][c].x,g=this.pages[a][c].y;d=void 0===d?this.options.snapSpeed||b.max(b.max(b.min(b.abs(f-this.x),1E3),b.min(b.abs(g-this.y),1E3)),300):d;this.currentPage={x:f,y:g,pageX:a,pageY:c};this.scrollTo(f,g,d,e)},next:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c++;c>=this.pages.length&&this.hasVerticalScroll&&(c=0,d++);this.goToPage(c,d,a,b)},prev:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c--;0>c&&this.hasVerticalScroll&&(c=
0,d--);this.goToPage(c,d,a,b)},_initKeys:function(){var a={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40},b;if("object"==typeof this.options.keyBindings)for(b in this.options.keyBindings)"string"==typeof this.options.keyBindings[b]&&(this.options.keyBindings[b]=this.options.keyBindings[b].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(b in a)this.options.keyBindings[b]=this.options.keyBindings[b]||a[b];g.addEvent(d,"keydown",this);this.on("destroy",function(){g.removeEvent(d,
"keydown",this)})},_key:function(a){if(this.enabled){var c=this.options.snap,d=c?this.currentPage.pageX:this.x,e=c?this.currentPage.pageY:this.y,f=g.getTime(),h=this.keyTime||0,j;this.options.useTransition&&this.isInTransition&&(j=this.getComputedPosition(),this._translate(b.round(j.x),b.round(j.y)),this.isInTransition=!1);this.keyAcceleration=200>f-h?b.min(this.keyAcceleration+0.25,50):0;switch(a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?d+=c?
1:this.wrapperWidth:e+=c?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?d-=c?1:this.wrapperWidth:e-=c?1:this.wrapperHeight;break;case this.options.keyBindings.end:d=c?this.pages.length-1:this.maxScrollX;e=c?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:e=d=0;break;case this.options.keyBindings.left:d+=c?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:e+=c?1:5+this.keyAcceleration>>
0;break;case this.options.keyBindings.right:d-=c?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:e-=c?1:5+this.keyAcceleration>>0;break;default:return}c?this.goToPage(d,e):(0<d?this.keyAcceleration=d=0:d<this.maxScrollX&&(d=this.maxScrollX,this.keyAcceleration=0),0<e?this.keyAcceleration=e=0:e<this.maxScrollY&&(e=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(d,e,0),this.keyTime=f)}},_animate:function(a,b,c,d){function e(){var p=g.getTime(),r;p>=n?(f.isAnimating=!1,f._translate(a,
b),f.resetPosition(f.options.bounceTime)||f._execEvent("scrollEnd")):(p=(p-l)/c,r=d(p),p=(a-j)*r+j,r=(b-k)*r+k,f._translate(p,r),f.isAnimating&&h(e))}var f=this,j=this.x,k=this.y,l=g.getTime(),n=l+c;this.isAnimating=!0;e()},handleEvent:function(a){switch(a.type){case "touchstart":case "MSPointerDown":case "mousedown":this._start(a);break;case "touchmove":case "MSPointerMove":case "mousemove":this._move(a);break;case "touchend":case "MSPointerUp":case "mouseup":case "touchcancel":case "MSPointerCancel":case "mousecancel":this._end(a);
break;case "orientationchange":case "resize":this._resize();break;case "transitionend":case "webkitTransitionEnd":case "oTransitionEnd":case "MSTransitionEnd":this._transitionEnd(a);break;case "wheel":case "DOMMouseScroll":case "mousewheel":this._wheel(a);break;case "keydown":this._key(a);break;case "click":a._constructed||(a.preventDefault(),a.stopPropagation())}}};e.prototype={handleEvent:function(a){switch(a.type){case "touchstart":case "MSPointerDown":case "mousedown":this._start(a);break;case "touchmove":case "MSPointerMove":case "mousemove":this._move(a);
break;case "touchend":case "MSPointerUp":case "mouseup":case "touchcancel":case "MSPointerCancel":case "mousecancel":this._end(a)}},destroy:function(){this.options.interactive&&(g.removeEvent(this.indicator,"touchstart",this),g.removeEvent(this.indicator,"MSPointerDown",this),g.removeEvent(this.indicator,"mousedown",this),g.removeEvent(d,"touchmove",this),g.removeEvent(d,"MSPointerMove",this),g.removeEvent(d,"mousemove",this),g.removeEvent(d,"touchend",this),g.removeEvent(d,"MSPointerUp",this),g.removeEvent(d,
"mouseup",this));this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(a){var b=a.touches?a.touches[0]:a;a.preventDefault();a.stopPropagation();this.transitionTime();this.initiated=!0;this.moved=!1;this.lastPointX=b.pageX;this.lastPointY=b.pageY;this.startTime=g.getTime();this.options.disableTouch||g.addEvent(d,"touchmove",this);this.options.disablePointer||g.addEvent(d,"MSPointerMove",this);this.options.disableMouse||g.addEvent(d,"mousemove",this);this.scroller._execEvent("beforeScrollStart")},
_move:function(a){var b=a.touches?a.touches[0]:a,c,d;g.getTime();this.moved||this.scroller._execEvent("scrollStart");this.moved=!0;c=b.pageX-this.lastPointX;this.lastPointX=b.pageX;d=b.pageY-this.lastPointY;this.lastPointY=b.pageY;this._pos(this.x+c,this.y+d);a.preventDefault();a.stopPropagation()},_end:function(a){if(this.initiated){this.initiated=!1;a.preventDefault();a.stopPropagation();g.removeEvent(d,"touchmove",this);g.removeEvent(d,"MSPointerMove",this);g.removeEvent(d,"mousemove",this);if(this.scroller.options.snap){a=
this.scroller._nearestSnap(this.scroller.x,this.scroller.y);var c=this.options.snapSpeed||b.max(b.max(b.min(b.abs(this.scroller.x-a.x),1E3),b.min(b.abs(this.scroller.y-a.y),1E3)),300);if(this.scroller.x!=a.x||this.scroller.y!=a.y)this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=a,this.scroller.scrollTo(a.x,a.y,c,this.scroller.options.bounceEasing)}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(a){a=a||0;this.indicatorStyle[g.style.transitionDuration]=
a+"ms";!a&&g.isBadAndroid&&(this.indicatorStyle[g.style.transitionDuration]="0.001s")},transitionTimingFunction:function(a){this.indicatorStyle[g.style.transitionTimingFunction]=a},refresh:function(){this.transitionTime();this.indicatorStyle.display=this.options.listenX&&!this.options.listenY?this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.scroller.hasVerticalScroll?"block":"none":this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?
"block":"none";this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(g.addClass(this.wrapper,"iScrollBothScrollbars"),g.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(g.removeClass(this.wrapper,"iScrollBothScrollbars"),g.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?
this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=b.max(b.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=
this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX);this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=b.max(b.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,
this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY);this.updatePosition()},updatePosition:function(){var a=this.options.listenX&&b.round(this.sizeRatioX*this.scroller.x)||0,c=this.options.listenY&&
b.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(a<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=b.max(this.indicatorWidth+a,8),this.indicatorStyle.width=this.width+"px"),a=this.minBoundaryX):a>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=b.max(this.indicatorWidth-(a-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",a=this.maxPosX+this.indicatorWidth-this.width):a=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&
(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),c<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=b.max(this.indicatorHeight+3*c,8),this.indicatorStyle.height=this.height+"px"),c=this.minBoundaryY):c>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=b.max(this.indicatorHeight-3*(c-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",c=this.maxPosY+this.indicatorHeight-this.height):c=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=
this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px"));this.x=a;this.y=c;this.scroller.options.useTransform?this.indicatorStyle[g.style.transform]="translate("+a+"px,"+c+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=a+"px",this.indicatorStyle.top=c+"px")},_pos:function(a,c){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX);0>c?c=0:c>this.maxPosY&&(c=this.maxPosY);a=this.options.listenX?b.round(a/this.sizeRatioX):this.scroller.x;c=this.options.listenY?
b.round(c/this.sizeRatioY):this.scroller.y;this.scroller.scrollTo(a,c)},fade:function(a,b){if(!b||this.visible){clearTimeout(this.fadeTimeout);this.fadeTimeout=null;var c=a?250:500,d=a?0:300;this.wrapperStyle[g.style.transitionDuration]=c+"ms";this.fadeTimeout=setTimeout(function(a){this.wrapperStyle.opacity=a;this.visible=+a}.bind(this,a?"1":"0"),d)}}};c.utils=g;"undefined"!=typeof module&&module.exports?module.exports=c:d.IScroll=c})(window,document,Math);
(function(d){d.fn.noUiSlider=function(a,b){function c(a,b,c){var d=b.data("setup"),e=d.handles;return b=d.settings,d=d.pos,a=0>a?0:100<a?100:a,2==b.handles&&(c.is(":first-child")?(c=parseFloat(e[1][0].style[d])-b.margin,a=a>c?c:a):(c=parseFloat(e[0][0].style[d])+b.margin,a=a<c?c:a)),b.step&&(c=h.from(b.range,b.step),a=Math.round(a/c)*c),a}function f(a){try{return[a.clientX||a.originalEvent.clientX||a.originalEvent.touches[0].clientX,a.clientY||a.originalEvent.clientY||a.originalEvent.touches[0].clientY]}catch(b){return["x",
"y"]}}var e=window.navigator.msPointerEnabled?2:"ontouchend"in document?3:1,h,g,j;return window.debug&&console&&console.log(e),h={to:function(a,b){return b=0>a[0]?b+Math.abs(a[0]):b-a[0],100*b/this._length(a)},from:function(a,b){return 100*b/this._length(a)},is:function(a,b){return b*this._length(a)/100+a[0]},_length:function(a){return a[0]>a[1]?a[0]-a[1]:a[1]-a[0]}},g={handles:2,serialization:{to:["",""],resolution:0.01}},methods={create:function(){return this.each(function(){var b=d.extend(g,a),
j=d(this).data("_isnS_",!0),l=[],r,s,p="",u=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},q=(b.serialization.resolution=b.serialization.resolution||0.01).toString().split("."),v=1==q[0]?0:q[1].length;b.start=u(b.start)?[b.start,0]:b.start;d.each(b,function(a,c){u(c)?b[a]=parseFloat(c):"object"==typeof c&&u(c[0])&&(c[0]=parseFloat(c[0]),u(c[1])&&(c[1]=parseFloat(c[1])));var d=!1;c="undefined"==typeof c?"x":c;switch(a){case "range":case "start":d=2!=c.length||!u(c[0])||!u(c[1]);break;case "handles":d=
1>c||2<c||!u(c);break;case "connect":d="lower"!=c&&"upper"!=c&&"boolean"!=typeof c;break;case "orientation":d="vertical"!=c&&"horizontal"!=c;break;case "margin":case "step":d="undefined"!=typeof c&&!u(c);break;case "serialization":d="object"!=typeof c||!u(c.resolution)||"object"==typeof c.to&&c.to.length<b.handles;break;case "slide":d="function"!=typeof c}d&&console&&console.error("Bad input for "+a+" on slider:",j)});b.margin=b.margin?h.from(b.range,b.margin):0;(b.serialization.to instanceof jQuery||
"string"==typeof b.serialization.to||!1===b.serialization.to)&&(b.serialization.to=[b.serialization.to]);"vertical"==b.orientation?(p+="vertical",r="top",s=1):(p+="horizontal",r="left",s=0);p+=b.connect?"lower"==b.connect?" connect lower":" connect":"";j.addClass(p);for(p=0;p<b.handles;p++){l[p]=j.append("<a><div></div></a>").children(":last");q=h.to(b.range,b.start[p]);l[p].css(r,q+"%");100==q&&l[p].is(":first-child")&&l[p].css("z-index",2);var q=(1===e?"mousedown":2===e?"MSPointerDown":"touchstart")+
".noUiSliderX",B=(1===e?"mousemove":2===e?"MSPointerMove":"touchmove")+".noUiSlider",F=(1===e?"mouseup":2===e?"MSPointerUp":"touchend")+".noUiSlider";l[p].find("div").on(q,function(a){if(d("body").bind("selectstart.noUiSlider",function(){return!1}),!j.hasClass("disabled")){d("body").addClass("TOUCH");var e=d(this).addClass("active").parent(),g=e.add(d(document)).add("body"),p=parseFloat(e[0].style[r]),m=f(a),q=m,u=!1;d(document).on(B,function(a){var d,g;if(a.preventDefault(),a=f(a),"x"!=a[0]){a[0]-=
m[0];a[1]-=m[1];d=[q[0]!=a[0],q[1]!=a[1]];var x=p+100*a[s]/(s?j.height():j.width()),x=c(x,j,e);d[s]&&x!=u&&(e.css(r,x+"%").data("input").val(h.is(b.range,x).toFixed(v)),d=b.slide,g=j.data("_n",!0),"function"==typeof d&&d.call(g,void 0),u=x,e.css("z-index",2==l.length&&100==x&&e.is(":first-child")?2:1));q=a}}).on(F,function(){g.off(".noUiSlider");d("body").removeClass("TOUCH");j.find(".active").removeClass("active").end().data("_n")&&j.data("_n",!1).change()})}}).on("click",function(a){a.stopPropagation()})}if(1==
e)j.on("click",function(a){if(!j.hasClass("disabled")){var d=f(a);a=100*(d[s]-j.offset()[r])/(s?j.height():j.width());d=1<l.length?d[s]<(l[0].offset()[r]+l[1].offset()[r])/2?l[0]:l[1]:l[0];a=c(a,j,d);d.css(r,a+"%").data("input").val(h.is(b.range,a).toFixed(v));a=b.slide;"function"==typeof a&&a.call(j,void 0);j.change()}});for(p=0;p<l.length;p++)q=h.is(b.range,parseFloat(l[p][0].style[r])).toFixed(v),"string"==typeof b.serialization.to[p]?l[p].data("input",j.append('<input type="hidden" name="'+b.serialization.to[p]+
'">').find("input:last").val(q).change(function(a){a.stopPropagation()})):!1==b.serialization.to[p]?l[p].data("input",{val:function(a){if("undefined"!=typeof a)this.handle.data("noUiVal",a);else return this.handle.data("noUiVal")},handle:l[p]}):l[p].data("input",b.serialization.to[p].data("handleNR",p).val(q).change(function(){var a=[null,null];a[d(this).data("handleNR")]=d(this).val();j.val(a)}));d(this).data("setup",{settings:b,handles:l,pos:r,res:v})})},val:function(a){var b,e,f;if("undefined"!=
typeof a)return b="number"==typeof a?[a]:a,this.each(function(){for(var a,e=d(this).data("setup"),f=0;f<e.handles.length;f++)null!=b[f]&&(a=c(h.to(e.settings.range,b[f]),d(this),e.handles[f]),e.handles[f].css(e.pos,a+"%").data("input").val(h.is(e.settings.range,a).toFixed(e.res)))});a=d(this).data("setup").handles;e=[];for(f=0;f<a.length;f++)e.push(parseFloat(a[f].data("input").val()));return 1==e.length?e[0]:e},disabled:function(){return b?d(this).addClass("disabled"):d(this).removeClass("disabled")}},
j=jQuery.fn.val,jQuery.fn.val=function(){return this.data("_isnS_")?methods.val.apply(this,arguments):j.apply(this,arguments)},"disabled"==a?methods.disabled.apply(this):methods.create.apply(this)}})(jQuery);
